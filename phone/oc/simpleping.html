<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>simpleping | MZ's 技术指南</title>
    <meta name="description" content="MZ的技术指南, 记录学习及日常使用">
    <link rel="preload stylesheet" href="/assets/style.52b03b96.css" as="style">
    
    <script type="module" src="/assets/app.c7ccc2ec.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.28451963.js">
    <link rel="modulepreload" href="/assets/chunks/theme.2cf3bf03.js">
    <link rel="modulepreload" href="/assets/phone_oc_simpleping.md.cf9f3d5e.lean.js">
    <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-c6746956><!--[--><!--]--><!--[--><span tabindex="-1" data-v-70eb73e3></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-70eb73e3> Skip to content </a><!--]--><!----><header class="VPNav" data-v-c6746956 data-v-5de1d602><div class="VPNavBar has-sidebar" data-v-5de1d602 data-v-af9ac95e><div class="container" data-v-af9ac95e><div class="title" data-v-af9ac95e><div class="VPNavBarTitle has-sidebar" data-v-af9ac95e data-v-ab859657><a class="title" href="/" data-v-ab859657><!--[--><!--]--><!--[--><img class="VPImage logo" src="/logo.png" alt data-v-1b586486><!--]--><!--[-->MZ&#39;s 技术指南<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-af9ac95e><div class="curtain" data-v-af9ac95e></div><div class="content-body" data-v-af9ac95e><!--[--><!--]--><div class="VPNavBarSearch search" style="--vp-meta-key:&#39;Meta&#39;;" data-v-af9ac95e><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-af9ac95e data-v-8f5725aa><span id="main-nav-aria-label" class="visually-hidden" data-v-8f5725aa>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-8f5725aa data-v-d8d99116><!--[--><span data-v-d8d99116>首页</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-8f5725aa data-v-6b143405><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6b143405><span class="text" data-v-6b143405><!----><span data-v-6b143405>AI</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6b143405><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6b143405><div class="VPMenu" data-v-6b143405 data-v-3795249a><div class="items" data-v-3795249a><!--[--><!--[--><div class="VPMenuGroup" data-v-3795249a data-v-f066b2dc><p class="title" data-v-f066b2dc>免费AI平台</p><!--[--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/ai/%E5%85%8D%E8%B4%B9%E5%8F%AF%E7%94%A8AI%E5%B7%A5%E5%85%B7" data-v-94ec0290><!--[-->免费可用AI工具<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-3795249a data-v-f066b2dc><p class="title" data-v-f066b2dc>AI机器学习</p><!--[--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/ai/AI%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0" data-v-94ec0290><!--[-->AI机器学习<!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup active" data-v-8f5725aa data-v-6b143405><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6b143405><span class="text" data-v-6b143405><!----><span data-v-6b143405>移动端</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6b143405><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6b143405><div class="VPMenu" data-v-6b143405 data-v-3795249a><div class="items" data-v-3795249a><!--[--><!--[--><div class="VPMenuGroup" data-v-3795249a data-v-f066b2dc><p class="title" data-v-f066b2dc>Objective-C/C++</p><!--[--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/phone/oc/" data-v-94ec0290><!--[-->Objective-C<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-3795249a data-v-f066b2dc><p class="title" data-v-f066b2dc>Swift</p><!--[--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/phone/swift/" data-v-94ec0290><!--[-->Swift<!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-8f5725aa data-v-6b143405><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6b143405><span class="text" data-v-6b143405><!----><span data-v-6b143405>前端</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6b143405><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6b143405><div class="VPMenu" data-v-6b143405 data-v-3795249a><div class="items" data-v-3795249a><!--[--><!--[--><div class="VPMenuGroup" data-v-3795249a data-v-f066b2dc><p class="title" data-v-f066b2dc>前端基础</p><!--[--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/f2e/html/" data-v-94ec0290><!--[-->HTML/HTML5<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/f2e/css/" data-v-94ec0290><!--[-->CSS/CSS3<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/f2e/script/js/" data-v-94ec0290><!--[-->JavaScript/TypeScript<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-3795249a data-v-f066b2dc><p class="title" data-v-f066b2dc>前端框架</p><!--[--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/f2e/vue/vue3/vue3%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86" data-v-94ec0290><!--[-->Vue2/Vue3<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/f2e/vue/nuxt/nuxt3%E7%AE%80%E4%BB%8B" data-v-94ec0290><!--[-->Nuxt3<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/f2e/react/" data-v-94ec0290><!--[-->React<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/f2e/svelte/" data-v-94ec0290><!--[-->Svelte<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/f2e/solid/" data-v-94ec0290><!--[-->Solid<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/f2e/wechat/" data-v-94ec0290><!--[-->微信小程序<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/f2e/harmonyOS/" data-v-94ec0290><!--[-->鸿蒙系统<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-3795249a data-v-f066b2dc><p class="title" data-v-f066b2dc>打包工具</p><!--[--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/f2e/bundle/unbuild%E6%89%93%E5%8C%85" data-v-94ec0290><!--[-->unbuild<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/f2e/bundle/tsup%E6%89%93%E5%8C%85" data-v-94ec0290><!--[-->tsup<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/f2e/bundle/vite%E7%AE%80%E4%BB%8B" data-v-94ec0290><!--[-->Vite<!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-8f5725aa data-v-6b143405><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6b143405><span class="text" data-v-6b143405><!----><span data-v-6b143405>后端</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6b143405><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6b143405><div class="VPMenu" data-v-6b143405 data-v-3795249a><div class="items" data-v-3795249a><!--[--><!--[--><div class="VPMenuGroup" data-v-3795249a data-v-f066b2dc><p class="title" data-v-f066b2dc>NodeJS</p><!--[--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/backend/nodejs/nodejs%E7%AE%80%E4%BB%8B" data-v-94ec0290><!--[-->NodeJS<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/backend/express/express%E7%AE%80%E4%BB%8B" data-v-94ec0290><!--[-->Express<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-3795249a data-v-f066b2dc><p class="title" data-v-f066b2dc>Python</p><!--[--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link vp-external-link-icon" href="https://gitee.com/geeksdidi" target="_blank" rel="noreferrer" data-v-94ec0290><!--[-->Python2/Python3<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-3795249a data-v-f066b2dc><p class="title" data-v-f066b2dc>Golang</p><!--[--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link vp-external-link-icon" href="https://gitee.com/geeksdidi" target="_blank" rel="noreferrer" data-v-94ec0290><!--[-->Gitee<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-3795249a data-v-f066b2dc><p class="title" data-v-f066b2dc>Rust</p><!--[--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/backend/rust/rust%E7%AE%80%E4%BB%8B" data-v-94ec0290><!--[-->Rust<!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-8f5725aa data-v-6b143405><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6b143405><span class="text" data-v-6b143405><!----><span data-v-6b143405>云服务</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6b143405><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6b143405><div class="VPMenu" data-v-6b143405 data-v-3795249a><div class="items" data-v-3795249a><!--[--><!--[--><div class="VPMenuGroup" data-v-3795249a data-v-f066b2dc><p class="title" data-v-f066b2dc>云计算</p><!--[--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/serverless/service/%E4%BA%91%E8%AE%A1%E7%AE%97%E7%AE%80%E4%BB%8B" data-v-94ec0290><!--[-->云计算简介<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/serverless/service/%E4%BA%91%E5%87%BD%E6%95%B0%E7%AE%80%E4%BB%8B" data-v-94ec0290><!--[-->其他<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-3795249a data-v-f066b2dc><p class="title" data-v-f066b2dc>云部署</p><!--[--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/serverless/deploy/Vercel%E7%AE%80%E4%BB%8B" data-v-94ec0290><!--[-->Vercel<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/serverless/deploy/cloudflare%E7%AE%80%E4%BB%8B" data-v-94ec0290><!--[-->Cloudflare<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/serverless/deploy/Replit%E7%AE%80%E4%BB%8B" data-v-94ec0290><!--[-->其他<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-3795249a data-v-f066b2dc><p class="title" data-v-f066b2dc>操作系统|服务器|容器</p><!--[--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/serverless/system/linux%E7%AE%80%E4%BB%8B" data-v-94ec0290><!--[-->Linux<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/serverless/system/nginx%E7%AE%80%E4%BB%8B" data-v-94ec0290><!--[-->Nginx<!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-8f5725aa data-v-6b143405><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6b143405><span class="text" data-v-6b143405><!----><span data-v-6b143405>软件工具</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6b143405><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6b143405><div class="VPMenu" data-v-6b143405 data-v-3795249a><div class="items" data-v-3795249a><!--[--><!--[--><div class="VPMenuGroup" data-v-3795249a data-v-f066b2dc><p class="title" data-v-f066b2dc>网站导航</p><!--[--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/tool/site/" data-v-94ec0290><!--[-->网站导航<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-3795249a data-v-f066b2dc><p class="title" data-v-f066b2dc>编程软件</p><!--[--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/tool/vscode/" data-v-94ec0290><!--[-->VSCode<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-3795249a data-v-f066b2dc><p class="title" data-v-f066b2dc>效率提升</p><!--[--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/tool/efficiency/pnp%E7%AE%80%E4%BB%8B" data-v-94ec0290><!--[-->pnpm<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/tool/efficiency/nvm%E7%AE%80%E4%BB%8B" data-v-94ec0290><!--[-->nvm<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/tool/efficiency/nrm%E7%AE%80%E4%BB%8B" data-v-94ec0290><!--[-->nrm<!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-af9ac95e data-v-7b9909ce><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-7b9909ce data-v-171c4c48 data-v-9b981539><span class="check" data-v-9b981539><span class="icon" data-v-9b981539><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-171c4c48><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-171c4c48><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-af9ac95e data-v-25c50213 data-v-d0e9c8ad><!--[--><a class="VPSocialLink no-icon" href="https://github.com/misterZhouZhou" aria-label="github" target="_blank" rel="noopener" data-v-d0e9c8ad data-v-1ec1e892><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-af9ac95e data-v-e97fd28e data-v-6b143405><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-6b143405><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-6b143405><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-6b143405><div class="VPMenu" data-v-6b143405 data-v-3795249a><!----><!--[--><!--[--><!----><div class="group" data-v-e97fd28e><div class="item appearance" data-v-e97fd28e><p class="label" data-v-e97fd28e>Appearance</p><div class="appearance-action" data-v-e97fd28e><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-e97fd28e data-v-171c4c48 data-v-9b981539><span class="check" data-v-9b981539><span class="icon" data-v-9b981539><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-171c4c48><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-171c4c48><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-e97fd28e><div class="item social-links" data-v-e97fd28e><div class="VPSocialLinks social-links-list" data-v-e97fd28e data-v-d0e9c8ad><!--[--><a class="VPSocialLink no-icon" href="https://github.com/misterZhouZhou" aria-label="github" target="_blank" rel="noopener" data-v-d0e9c8ad data-v-1ec1e892><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-af9ac95e data-v-241ee4cf><span class="container" data-v-241ee4cf><span class="top" data-v-241ee4cf></span><span class="middle" data-v-241ee4cf></span><span class="bottom" data-v-241ee4cf></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav reached-top" data-v-c6746956 data-v-5a57d31a><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-5a57d31a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-5a57d31a><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-5a57d31a>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-5a57d31a data-v-ad7d5a57><button data-v-ad7d5a57>Return to top</button><!----></div></div><aside class="VPSidebar" data-v-c6746956 data-v-aadd12fc><div class="curtain" data-v-aadd12fc></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-aadd12fc><span class="visually-hidden" id="sidebar-aria-label" data-v-aadd12fc> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-aadd12fc><section class="VPSidebarItem level-0 collapsible has-active" data-v-aadd12fc data-v-d3a879f1><div class="item" role="button" tabindex="0" data-v-d3a879f1><div class="indicator" data-v-d3a879f1></div><h2 class="text" data-v-d3a879f1>移动端/Objective-C</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-d3a879f1><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-d3a879f1><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-d3a879f1><!--[--><div class="VPSidebarItem level-1 is-link" data-v-d3a879f1 data-v-d3a879f1><div class="item" data-v-d3a879f1><div class="indicator" data-v-d3a879f1></div><a class="VPLink link link" href="/phone/oc/" data-v-d3a879f1><!--[--><p class="text" data-v-d3a879f1>1、Objective-C/C++简介</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d3a879f1 data-v-d3a879f1><div class="item" data-v-d3a879f1><div class="indicator" data-v-d3a879f1></div><a class="VPLink link link" href="/phone/oc/wkwebview" data-v-d3a879f1><!--[--><p class="text" data-v-d3a879f1>2、WKWebView简介</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d3a879f1 data-v-d3a879f1><div class="item" data-v-d3a879f1><div class="indicator" data-v-d3a879f1></div><a class="VPLink link link" href="/phone/oc/%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7" data-v-d3a879f1><!--[--><p class="text" data-v-d3a879f1>3、开发实用技巧</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d3a879f1 data-v-d3a879f1><div class="item" data-v-d3a879f1><div class="indicator" data-v-d3a879f1></div><a class="VPLink link link" href="/phone/oc/simpleping" data-v-d3a879f1><!--[--><p class="text" data-v-d3a879f1>4、SimplePing</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-aadd12fc><section class="VPSidebarItem level-0 collapsible" data-v-aadd12fc data-v-d3a879f1><div class="item" role="button" tabindex="0" data-v-d3a879f1><div class="indicator" data-v-d3a879f1></div><h2 class="text" data-v-d3a879f1>移动端/Swift</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-d3a879f1><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-d3a879f1><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-d3a879f1><!--[--><div class="VPSidebarItem level-1 is-link" data-v-d3a879f1 data-v-d3a879f1><div class="item" data-v-d3a879f1><div class="indicator" data-v-d3a879f1></div><a class="VPLink link link" href="/phone/swift/" data-v-d3a879f1><!--[--><p class="text" data-v-d3a879f1>Swift</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-c6746956 data-v-b368e0f1><div class="VPDoc has-sidebar has-aside" data-v-b368e0f1 data-v-42804bdd><!--[--><!--]--><div class="container" data-v-42804bdd><div class="aside" data-v-42804bdd><div class="aside-curtain" data-v-42804bdd></div><div class="aside-container" data-v-42804bdd><div class="aside-content" data-v-42804bdd><div class="VPDocAside" data-v-42804bdd data-v-a99f0056><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-a99f0056 data-v-82b0686e><div class="content" data-v-82b0686e><div class="outline-marker" data-v-82b0686e></div><div class="outline-title" data-v-82b0686e>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-82b0686e><span class="visually-hidden" id="doc-outline-aria-label" data-v-82b0686e> Table of Contents for current page </span><ul class="root" data-v-82b0686e data-v-6fa36fb1><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-a99f0056></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-42804bdd><div class="content-container" data-v-42804bdd><!--[--><!--]--><!----><main class="main" data-v-42804bdd><div style="position:relative;" class="vp-doc _phone_oc_simpleping" data-v-42804bdd><div><h1 id="simpleping" tabindex="-1">simpleping <a class="header-anchor" href="#simpleping" aria-label="Permalink to &quot;simpleping&quot;">​</a></h1><h2 id="简介" tabindex="-1">简介 <a class="header-anchor" href="#简介" aria-label="Permalink to &quot;简介&quot;">​</a></h2><p>PING （Packet Internet Groper），因特网 包探索器，用于测试网络连接量的程序。Ping是工作在 TCP/IP 网络体系结构中应用层的一个服务命令， 主要是向特定的目的主机发送 ICMP （Internet Control Message Protocol 因特网报文控制协议） Echo 请求报文，测试目的站是否可达及了解其有关状态。 Apple 的 SimplePing 封装了 ping 的功能，提供了简单的 API，以编程的方式对没有管理员权限的远程主机执行 ping 操作，支持 IPv4 和 IPv6。</p><h2 id="使用方式" tabindex="-1">使用方式 <a class="header-anchor" href="#使用方式" aria-label="Permalink to &quot;使用方式&quot;">​</a></h2><p>要在自己的项目中使用<a href="https://developer.apple.com/library/archive/samplecode/SimplePing/Introduction/Intro.html#//apple_ref/doc/uid/DTS10000716" target="_blank" rel="noreferrer">SimplePing</a>，需要先下载 SimplePing 文件，并添加到项目中。</p><p>参考项目： <a href="https://github.com/lovesunstar/STPingTest/" target="_blank" rel="noreferrer">https://github.com/lovesunstar/STPingTest/</a></p><h2 id="simpleping-h" tabindex="-1">SimplePing.h <a class="header-anchor" href="#simpleping-h" aria-label="Permalink to &quot;SimplePing.h&quot;">​</a></h2><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">/*</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    Copyright (C) 2016 Apple Inc. All Rights Reserved.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    See LICENSE.txt for this sample’s licensing information</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    Abstract:</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    An object wrapper around the low-level BSD Sockets ping function.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">import Foundation</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#include </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">AssertMacros</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">h</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">           </span><span style="color:#676E95;font-style:italic;">// for __Check_Compile_Time</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">NS_ASSUME_NONNULL_BEGIN</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">protocol SimplePingDelegate</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! Controls the IP address version used by SimplePing instances.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">typedef </span><span style="color:#82AAFF;">NS_ENUM</span><span style="color:#A6ACCD;">(NSInteger</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> SimplePingAddressStyle) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">SimplePingAddressStyleAny</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;">          </span><span style="color:#676E95;font-style:italic;">///&lt; Use the first IPv4 or IPv6 address found; the default.</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">SimplePingAddressStyleICMPv4</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;">       </span><span style="color:#676E95;font-style:italic;">///&lt; Use the first IPv4 address found.</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">SimplePingAddressStyleICMPv6</span><span style="color:#F07178;">        </span><span style="color:#676E95;font-style:italic;">///&lt; Use the first IPv6 address found.</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! An object wrapper around the low-level BSD Sockets ping function.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \details To use the class create an instance, set the delegate and call `-start` </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      to start the instance on the current run loop.  If things go well you&#39;ll soon get the </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      `-simplePing:didStartWithAddress:` delegate callback.  From there you can can call </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      `-sendPingWithData:` to send a ping and you&#39;ll receive the </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      `-simplePing:didReceivePingResponsePacket:sequenceNumber:` and </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      `-simplePing:didReceiveUnexpectedPacket:` delegate callbacks as ICMP packets arrive.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      The class can be used from any thread but the use of any single instance must be </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      confined to a specific thread and that thread must run its run loop.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">interface </span><span style="color:#FFCB6B;">SimplePing</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> NSObject</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (instancetype)init NS_UNAVAILABLE</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! Initialise the object to ping the specified host.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param hostName The DNS name of the host to ping; an IPv4 or IPv6 address in string form will </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      work here.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \returns The initialised object.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (instancetype)</span><span style="color:#FFCB6B;">initWithHostName</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(NSString </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)hostName NS_DESIGNATED_INITIALIZER</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! A copy of the value passed to `-initWithHostName:`.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">property</span><span style="color:#A6ACCD;"> (nonatomic</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> copy</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> readonly) NSString </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> hostName</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! The delegate for this object.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \details Delegate callbacks are schedule in the default run loop mode of the run loop of the </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      thread that calls `-start`.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">property</span><span style="color:#A6ACCD;"> (nonatomic</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> weak</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> readwrite</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> nullable) id</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">SimplePingDelegate</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> delegate</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! Controls the IP address version used by the object.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \details You should set this value before starting the object.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">property</span><span style="color:#A6ACCD;"> (nonatomic</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> assign</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> readwrite) SimplePingAddressStyle addressStyle</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! The address being pinged.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \details The contents of the NSData is a (struct sockaddr) of some form.  The </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      value is nil while the object is stopped and remains nil on start until </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      `-simplePing:didStartWithAddress:` is called.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">property</span><span style="color:#A6ACCD;"> (nonatomic</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> copy</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> readonly</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> nullable) NSData </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> hostAddress</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">property</span><span style="color:#A6ACCD;"> (nonatomic</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> copy</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> readonly</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> nullable) NSString </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">IPAddress</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! The address family for `hostAddress`, or `AF_UNSPEC` if that&#39;s nil.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">property</span><span style="color:#A6ACCD;"> (nonatomic</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> assign</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> readonly) sa_family_t hostAddressFamily</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! The identifier used by pings by this object.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \details When you create an instance of this object it generates a random identifier </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      that it uses to identify its own pings.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">property</span><span style="color:#A6ACCD;"> (nonatomic</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> assign</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> readonly) uint16_t identifier</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! The next sequence number to be used by this object.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \details This value starts at zero and increments each time you send a ping (safely </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      wrapping back to zero if necessary).  The sequence number is included in the ping, </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      allowing you to match up requests and responses, and thus calculate ping times and </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      so on.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">property</span><span style="color:#A6ACCD;"> (nonatomic</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> assign</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> readonly) uint16_t nextSequenceNumber</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! Starts the object.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \details You should set up the delegate and any ping parameters before calling this.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      If things go well you&#39;ll soon get the `-simplePing:didStartWithAddress:` delegate </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      callback, at which point you can start sending pings (via `-sendPingWithData:`) and </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      will start receiving ICMP packets (either ping responses, via the </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      `-simplePing:didReceivePingResponsePacket:sequenceNumber:` delegate callback, or </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      unsolicited ICMP packets, via the `-simplePing:didReceiveUnexpectedPacket:` delegate </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      callback).</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      If the object fails to start, typically because `hostName` doesn&#39;t resolve, you&#39;ll get </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      the `-simplePing:didFailWithError:` delegate callback.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      It is not correct to start an already started object.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;">)start</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! Sends a ping packet containing the specified data.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \details Sends an actual ping.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      The object must be started when you call this method and, on starting the object, you must </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      wait for the `-simplePing:didStartWithAddress:` delegate callback before calling it.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param data Some data to include in the ping packet, after the ICMP header, or nil if you </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      want the packet to include a standard 56 byte payload (resulting in a standard 64 byte </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      ping).</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;">)</span><span style="color:#FFCB6B;">sendPingWithData</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(nullable NSData </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)data</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! Stops the object.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \details You should call this when you&#39;re done pinging.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      It&#39;s safe to call this on an object that&#39;s stopped.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;">)stop</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! A delegate protocol for the SimplePing class.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">protocol SimplePingDelegate </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">NSObject</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">optional</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! A SimplePing delegate callback, called once the object has started up.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \details This is called shortly after you start the object to tell you that the </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      object has successfully started.  On receiving this callback, you can call </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      `-sendPingWithData:` to send pings.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      If the object didn&#39;t start, `-simplePing:didFailWithError:` is called instead.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param pinger The object issuing the callback.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param address The address that&#39;s being pinged; at the time this delegate callback </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      is made, this will have the same value as the `hostAddress` property.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;">)</span><span style="color:#FFCB6B;">simplePing</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(SimplePing </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)pinger </span><span style="color:#FFCB6B;">didStartWithAddress</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(NSData </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)address</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! A SimplePing delegate callback, called if the object fails to start up.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \details This is called shortly after you start the object to tell you that the </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      object has failed to start.  The most likely cause of failure is a problem </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      resolving `hostName`.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      By the time this callback is called, the object has stopped (that is, you don&#39;t </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      need to call `-stop` yourself).</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param pinger The object issuing the callback.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param error Describes the failure.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;">)</span><span style="color:#FFCB6B;">simplePing</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(SimplePing </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)pinger </span><span style="color:#FFCB6B;">didFailWithError</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(NSError </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)error</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! A SimplePing delegate callback, called when the object has successfully sent a ping packet. </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \details Each call to `-sendPingWithData:` will result in either a </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      `-simplePing:didSendPacket:sequenceNumber:` delegate callback or a </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      `-simplePing:didFailToSendPacket:sequenceNumber:error:` delegate callback (unless you </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      stop the object before you get the callback).  These callbacks are currently delivered </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      synchronously from within `-sendPingWithData:`, but this synchronous behaviour is not </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      considered API.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param pinger The object issuing the callback.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param packet The packet that was sent; this includes the ICMP header (`ICMPHeader`) and the </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      data you passed to `-sendPingWithData:` but does not include any IP-level headers.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param sequenceNumber The ICMP sequence number of that packet.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;">)</span><span style="color:#FFCB6B;">simplePing</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(SimplePing </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)pinger </span><span style="color:#FFCB6B;">didSendPacket</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(NSData </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)packet </span><span style="color:#FFCB6B;">sequenceNumber</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(uint16_t)sequenceNumber</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! A SimplePing delegate callback, called when the object fails to send a ping packet. </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \details Each call to `-sendPingWithData:` will result in either a </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      `-simplePing:didSendPacket:sequenceNumber:` delegate callback or a </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      `-simplePing:didFailToSendPacket:sequenceNumber:error:` delegate callback (unless you </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      stop the object before you get the callback).  These callbacks are currently delivered </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      synchronously from within `-sendPingWithData:`, but this synchronous behaviour is not </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      considered API.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param pinger The object issuing the callback.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param packet The packet that was not sent; see `-simplePing:didSendPacket:sequenceNumber:` </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      for details.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param sequenceNumber The ICMP sequence number of that packet.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param error Describes the failure.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;">)</span><span style="color:#FFCB6B;">simplePing</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(SimplePing </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)pinger </span><span style="color:#FFCB6B;">didFailToSendPacket</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(NSData </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)packet </span><span style="color:#FFCB6B;">sequenceNumber</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(uint16_t)sequenceNumber </span><span style="color:#FFCB6B;">error</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(NSError </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)error</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! A SimplePing delegate callback, called when the object receives a ping response.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \details If the object receives an ping response that matches a ping request that it </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      sent, it informs the delegate via this callback.  Matching is primarily done based on </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      the ICMP identifier, although other criteria are used as well.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param pinger The object issuing the callback.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param packet The packet received; this includes the ICMP header (`ICMPHeader`) and any data that </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      follows that in the ICMP message but does not include any IP-level headers.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param sequenceNumber The ICMP sequence number of that packet.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;">)</span><span style="color:#FFCB6B;">simplePing</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(SimplePing </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)pinger </span><span style="color:#FFCB6B;">didReceivePingResponsePacket</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(NSData </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)packet </span><span style="color:#FFCB6B;">sequenceNumber</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(uint16_t)sequenceNumber</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! A SimplePing delegate callback, called when the object receives an unmatched ICMP message.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \details If the object receives an ICMP message that does not match a ping request that it </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      sent, it informs the delegate via this callback.  The nature of ICMP handling in a </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      BSD kernel makes this a common event because, when an ICMP message arrives, it is </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      delivered to all ICMP sockets.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      IMPORTANT: This callback is especially common when using IPv6 because IPv6 uses ICMP </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      for important network management functions.  For example, IPv6 routers periodically </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      send out Router Advertisement (RA) packets via Neighbor Discovery Protocol (NDP), which </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      is implemented on top of ICMP.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      For more on matching, see the discussion associated with </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      `-simplePing:didReceivePingResponsePacket:sequenceNumber:`.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param pinger The object issuing the callback.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param packet The packet received; this includes the ICMP header (`ICMPHeader`) and any data that </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      follows that in the ICMP message but does not include any IP-level headers.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;">)</span><span style="color:#FFCB6B;">simplePing</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(SimplePing </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)pinger </span><span style="color:#FFCB6B;">didReceiveUnexpectedPacket</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(NSData </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)packet</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#pragma mark </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> ICMP On</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">The</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">Wire Format</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! Describes the on-the-wire header format for an ICMP ping.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \details This defines the header structure of ping packets on the wire.  Both IPv4 and </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      IPv6 use the same basic structure.  </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      This is declared in the header because clients of SimplePing might want to use </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      it parse received ping packets.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">struct ICMPHeader </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">uint8_t</span><span style="color:#F07178;">     </span><span style="color:#A6ACCD;">type</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">uint8_t</span><span style="color:#F07178;">     </span><span style="color:#A6ACCD;">code</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">uint16_t</span><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">checksum</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">uint16_t</span><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">identifier</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">uint16_t</span><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">sequenceNumber</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// data...</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#A6ACCD;">typedef struct ICMPHeader ICMPHeader</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">__Check_Compile_Time</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">sizeof</span><span style="color:#A6ACCD;">(ICMPHeader) </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">8</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">__Check_Compile_Time</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">offsetof</span><span style="color:#A6ACCD;">(ICMPHeader</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> type) </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">__Check_Compile_Time</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">offsetof</span><span style="color:#A6ACCD;">(ICMPHeader</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> code) </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">__Check_Compile_Time</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">offsetof</span><span style="color:#A6ACCD;">(ICMPHeader</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> checksum) </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">__Check_Compile_Time</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">offsetof</span><span style="color:#A6ACCD;">(ICMPHeader</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> identifier) </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">__Check_Compile_Time</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">offsetof</span><span style="color:#A6ACCD;">(ICMPHeader</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> sequenceNumber) </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">6</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">enum </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">ICMPv4TypeEchoRequest</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">8</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;">          </span><span style="color:#676E95;font-style:italic;">///&lt; The ICMP `type` for a ping request; in this case `code` is always 0.</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">ICMPv4TypeEchoReply</span><span style="color:#F07178;">   </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">           </span><span style="color:#676E95;font-style:italic;">///&lt; The ICMP `type` for a ping response; in this case `code` is always 0.</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">enum </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">ICMPv6TypeEchoRequest</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">128</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;">        </span><span style="color:#676E95;font-style:italic;">///&lt; The ICMP `type` for a ping request; in this case `code` is always 0.</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">ICMPv6TypeEchoReply</span><span style="color:#F07178;">   </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">129</span><span style="color:#F07178;">         </span><span style="color:#676E95;font-style:italic;">///&lt; The ICMP `type` for a ping response; in this case `code` is always 0.</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">NS_ASSUME_NONNULL_END</span></span></code></pre></div><h2 id="simpleping-m" tabindex="-1">SimplePing.m <a class="header-anchor" href="#simpleping-m" aria-label="Permalink to &quot;SimplePing.m&quot;">​</a></h2><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line"><span style="color:#676E95;font-style:italic;">/*</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    Copyright (C) 2016 Apple Inc. All Rights Reserved.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    See LICENSE.txt for this sample’s licensing information</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    Abstract:</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    An object wrapper around the low-level BSD Sockets ping function.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#</span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">SimplePing.h</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#include </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">sys</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">socket</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">h</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">#include </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">netinet</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">in</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">h</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">#include </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">errno</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">h</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">#include </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">arpa</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">inet</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">h</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">#include </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">arpa</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">inet</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">h</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#pragma mark </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> IPv4 and ICMPv4 On</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">The</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">Wire Format</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! Describes the on-the-wire header format for an IPv4 packet.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \details This defines the header structure of IPv4 packets on the wire.  We need </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      this in order to skip this header in the IPv4 case, where the kernel passes </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      it to us for no obvious reason.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">struct IPv4Header </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">uint8_t</span><span style="color:#F07178;">     </span><span style="color:#A6ACCD;">versionAndHeaderLength</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">uint8_t</span><span style="color:#F07178;">     </span><span style="color:#A6ACCD;">differentiatedServices</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">uint16_t</span><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">totalLength</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">uint16_t</span><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">identification</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">uint16_t</span><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">flagsAndFragmentOffset</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">uint8_t</span><span style="color:#F07178;">     </span><span style="color:#A6ACCD;">timeToLive</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">uint8_t</span><span style="color:#F07178;">     </span><span style="color:#A6ACCD;">protocol</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">uint16_t</span><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">headerChecksum</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">uint8_t</span><span style="color:#F07178;">     </span><span style="color:#A6ACCD;">sourceAddress</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">4</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">uint8_t</span><span style="color:#F07178;">     </span><span style="color:#A6ACCD;">destinationAddress</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">4</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// options...</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// data...</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#A6ACCD;">typedef struct IPv4Header IPv4Header</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">__Check_Compile_Time</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">sizeof</span><span style="color:#A6ACCD;">(IPv4Header) </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">20</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">__Check_Compile_Time</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">offsetof</span><span style="color:#A6ACCD;">(IPv4Header</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> versionAndHeaderLength) </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">__Check_Compile_Time</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">offsetof</span><span style="color:#A6ACCD;">(IPv4Header</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> differentiatedServices) </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">__Check_Compile_Time</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">offsetof</span><span style="color:#A6ACCD;">(IPv4Header</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> totalLength) </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">__Check_Compile_Time</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">offsetof</span><span style="color:#A6ACCD;">(IPv4Header</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> identification) </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">__Check_Compile_Time</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">offsetof</span><span style="color:#A6ACCD;">(IPv4Header</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> flagsAndFragmentOffset) </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">6</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">__Check_Compile_Time</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">offsetof</span><span style="color:#A6ACCD;">(IPv4Header</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> timeToLive) </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">8</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">__Check_Compile_Time</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">offsetof</span><span style="color:#A6ACCD;">(IPv4Header</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> protocol) </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">9</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">__Check_Compile_Time</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">offsetof</span><span style="color:#A6ACCD;">(IPv4Header</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> headerChecksum) </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">__Check_Compile_Time</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">offsetof</span><span style="color:#A6ACCD;">(IPv4Header</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> sourceAddress) </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">12</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">__Check_Compile_Time</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">offsetof</span><span style="color:#A6ACCD;">(IPv4Header</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> destinationAddress) </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">16</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! Calculates an IP checksum.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \details This is the standard BSD checksum code, modified to use modern types.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param buffer A pointer to the data to checksum.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param bufferLen The length of that data.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \returns The checksum value, in network byte order.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">static uint16_t </span><span style="color:#82AAFF;">in_cksum</span><span style="color:#A6ACCD;">(const </span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">buffer</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> size_t bufferLen) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// </span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">size_t</span><span style="color:#F07178;">              </span><span style="color:#A6ACCD;">bytesLeft</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">int32_t</span><span style="color:#F07178;">             </span><span style="color:#A6ACCD;">sum</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">uint16_t</span><span style="color:#F07178;"> *    cursor</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">union</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">uint16_t</span><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">us</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">uint8_t</span><span style="color:#F07178;">         </span><span style="color:#A6ACCD;">uc</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">2</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">last</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">uint16_t</span><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">answer</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">bytesLeft</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">bufferLen</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">sum</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">cursor</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">buffer</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#676E95;font-style:italic;">/*</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	 * Our algorithm is simple, using a 32 bit accumulator (sum), we add</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	 * sequential 16 bit words to it, and at the end, fold back all the</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	 * carry bits from the top 16 bits into the lower 16 bits.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	 */</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">bytesLeft</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">sum</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">cursor</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">cursor</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">bytesLeft</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">-=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#676E95;font-style:italic;">/* mop up an odd byte, if necessary */</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">bytesLeft</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">last</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">uc</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">uint8_t</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">) </span><span style="color:#A6ACCD;">cursor</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">last</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">uc</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">sum</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">last</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">us</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#676E95;font-style:italic;">/* add back carry outs from top 16 bits to low 16 bits */</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">sum</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">sum</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&gt;&gt;</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">16</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">sum</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0xffff</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;">	</span><span style="color:#676E95;font-style:italic;">/* add hi 16 to low 16 */</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">sum</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+=</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">sum</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&gt;&gt;</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">16</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;">			</span><span style="color:#676E95;font-style:italic;">/* add carry */</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">answer</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">uint16_t</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;">sum</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;">   </span><span style="color:#676E95;font-style:italic;">/* truncate to 16 bits */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">answer</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#pragma mark </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> SimplePing</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">interface </span><span style="color:#82AAFF;">SimplePing</span><span style="color:#A6ACCD;"> ()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// read/write versions of public properties</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">property</span><span style="color:#A6ACCD;"> (nonatomic</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> copy</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">   readwrite</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> nullable) NSData </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">     hostAddress</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">property</span><span style="color:#A6ACCD;"> (nonatomic</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> copy</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> readwrite</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> nullable) NSString </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">IPAddress</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">property</span><span style="color:#A6ACCD;"> (nonatomic</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> assign</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> readwrite          ) uint16_t     nextSequenceNumber</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// private properties</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! True if nextSequenceNumber has wrapped from 65535 to 0.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">property</span><span style="color:#A6ACCD;"> (nonatomic</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> assign</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> readwrite)           BOOL         nextSequenceNumberHasWrapped</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! A host object for name-to-address resolution.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">property</span><span style="color:#A6ACCD;"> (nonatomic</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> strong</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> readwrite</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> nullable) CFHostRef host </span><span style="color:#82AAFF;">__attribute__</span><span style="color:#A6ACCD;"> ((NSObject))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! A socket object for ICMP send and receive.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">property</span><span style="color:#A6ACCD;"> (nonatomic</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> strong</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> readwrite</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> nullable) CFSocketRef socket </span><span style="color:#82AAFF;">__attribute__</span><span style="color:#A6ACCD;"> ((NSObject))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">implementation SimplePing</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (instancetype)</span><span style="color:#FFCB6B;">initWithHostName</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(NSString </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)hostName </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">NSParameterAssert</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">hostName</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">nil</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">super</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">init</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">nil</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;">_hostName</span><span style="color:#F07178;">   </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">hostName</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">copy</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;">_identifier</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">uint16_t</span><span style="color:#F07178;">) </span><span style="color:#82AAFF;">arc4random</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;">)dealloc </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    [</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">stop</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// Double check that -stop took care of _host and _socket.</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">assert</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;">_host</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NULL</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">assert</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;">_socket</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NULL</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (sa_family_t)hostAddressFamily </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">sa_family_t</span><span style="color:#F07178;">     </span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">AF_UNSPEC</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> ( (</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hostAddress</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">nil</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hostAddress</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&gt;=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">sizeof</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">struct</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sockaddr</span><span style="color:#F07178;">)) ) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> ((</span><span style="color:#A6ACCD;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">struct</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sockaddr</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">) </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hostAddress</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">bytes</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;">sa_family</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! Shuts down the pinger object and tell the delegate about the error.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param error Describes the failure.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;">)</span><span style="color:#FFCB6B;">didFailWithError</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(NSError </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)error </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">SimplePingDelegate</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">strongDelegate</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">assert</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">error</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">nil</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// We retain ourselves temporarily because it&#39;s common for the delegate method </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// to release its last reference to us, which causes -dealloc to be called here. </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// If we then reference self on the return path, things go badly.  I don&#39;t think </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// that happens currently, but I&#39;ve got into the habit of doing this as a </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// defensive measure.</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">CFAutorelease</span><span style="color:#F07178;">( </span><span style="color:#82AAFF;">CFBridgingRetain</span><span style="color:#F07178;">( </span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> ))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    [</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">stop</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">strongDelegate</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">delegate</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> ( (</span><span style="color:#A6ACCD;">strongDelegate</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">nil</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">strongDelegate</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">respondsToSelector</span><span style="color:#F07178;">:@</span><span style="color:#82AAFF;">selector</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">simplePing</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">didFailWithError</span><span style="color:#F07178;">:)] ) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        [</span><span style="color:#A6ACCD;">strongDelegate</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">simplePing</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">didFailWithError</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">error</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! Shuts down the pinger object and tell the delegate about the error.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \details This converts the CFStreamError to an NSError and then call through to </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      -didFailWithError: to do the real work.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param streamError Describes the failure.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;">)</span><span style="color:#FFCB6B;">didFailWithHostStreamError</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(CFStreamError)streamError </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">NSDictionary</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">userInfo</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">NSError</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">       </span><span style="color:#A6ACCD;">error</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">streamError</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">domain</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">kCFStreamErrorDomainNetDB</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">userInfo</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">@{</span><span style="color:#F07178;">(id) kCFGetAddrInfoFailureKey</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> @(</span><span style="color:#A6ACCD;">streamError</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">error</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">userInfo</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">nil</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">error</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">NSError</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">errorWithDomain</span><span style="color:#F07178;">:(</span><span style="color:#A6ACCD;">NSString</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">) </span><span style="color:#A6ACCD;">kCFErrorDomainCFNetwork</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">code</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">kCFHostErrorUnknown</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">userInfo</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">userInfo</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    [</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">didFailWithError</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">error</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! Builds a ping packet from the supplied parameters.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param type The packet type, which is different for IPv4 and IPv6.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param payload Data to place after the ICMP header.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param requiresChecksum Determines whether a checksum is calculated (IPv4) or not (IPv6).</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \returns A ping packet suitable to be passed to the kernel.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (NSData </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)</span><span style="color:#FFCB6B;">pingPacketWithType</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(uint8_t)</span><span style="color:#C792EA;">type</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">payload</span><span style="color:#A6ACCD;">:(NSData *)payload requiresChecksum:(BOOL)requiresChecksum {</span></span>
<span class="line"><span style="color:#A6ACCD;">    NSMutableData *         packet</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    ICMPHeader </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">            icmpPtr</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    packet </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [NSMutableData dataWithLength:</span><span style="color:#82AAFF;">sizeof</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">icmpPtr) </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> payload</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">assert</span><span style="color:#A6ACCD;">(packet </span><span style="color:#89DDFF;">!=</span><span style="color:#A6ACCD;"> nil)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    icmpPtr </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> packet</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">mutableBytes</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    icmpPtr</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;">type </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> type</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    icmpPtr</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;">code </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    icmpPtr</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;">checksum </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    icmpPtr</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;">identifier     </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">OSSwapHostToBigInt16</span><span style="color:#A6ACCD;">(self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">identifier)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    icmpPtr</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;">sequenceNumber </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">OSSwapHostToBigInt16</span><span style="color:#A6ACCD;">(self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">nextSequenceNumber)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">memcpy</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">icmpPtr[</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> [payload bytes]</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> [payload length])</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (requiresChecksum) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// The IP checksum routine returns a 16-bit number that&#39;s already in correct byte order </span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// (due to wacky 1&#39;s complement maths), so we just put it into the packet as a 16-bit unit.</span></span>
<span class="line"><span style="color:#F07178;">        </span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">icmpPtr</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;">checksum</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">in_cksum</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">packet</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">bytes</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">packet</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> packet</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;">)</span><span style="color:#FFCB6B;">sendPingWithData</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(NSData </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)data </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">int</span><span style="color:#F07178;">                     </span><span style="color:#A6ACCD;">err</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">NSData</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">payload</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">NSData</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">packet</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">ssize_t</span><span style="color:#F07178;">                 </span><span style="color:#A6ACCD;">bytesSent</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">SimplePingDelegate</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">strongDelegate</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// data may be nil</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">NSParameterAssert</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hostAddress</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">nil</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;">     </span><span style="color:#676E95;font-style:italic;">// gotta wait for -simplePing:didStartWithAddress:</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// Construct the ping packet.</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">payload</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">payload</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">nil</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">payload</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [[</span><span style="color:#A6ACCD;">NSString</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">stringWithFormat</span><span style="color:#F07178;">:@</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">%28zd bottles of beer on the wall</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">ssize_t</span><span style="color:#F07178;">) </span><span style="color:#F78C6C;">99</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">size_t</span><span style="color:#F07178;">) (</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">nextSequenceNumber</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">%</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">100</span><span style="color:#F07178;">) ] </span><span style="color:#A6ACCD;">dataUsingEncoding</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">NSASCIIStringEncoding</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">assert</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">payload</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">nil</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// Our dummy payload is sized so that the resulting ICMP packet, including the ICMPHeader, is </span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// 64-bytes, which makes it easier to recognise our packets on the wire.</span></span>
<span class="line"><span style="color:#F07178;">        </span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">assert</span><span style="color:#F07178;">([</span><span style="color:#A6ACCD;">payload</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">56</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">switch</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hostAddressFamily</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">AF_INET</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">packet</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">pingPacketWithType</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">ICMPv4TypeEchoRequest</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">payload</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">payload</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">requiresChecksum</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">YES</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">AF_INET6</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">packet</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">pingPacketWithType</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">ICMPv6TypeEchoRequest</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">payload</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">payload</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">requiresChecksum</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">NO</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">assert</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">NO</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">assert</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">packet</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">nil</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// Send the packet.</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">socket</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NULL</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">bytesSent</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">EBADF</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">bytesSent</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">sendto</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">CFSocketGetNative</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">socket</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">packet</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">bytes</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">packet</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hostAddress</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">bytes</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#F07178;">            (</span><span style="color:#A6ACCD;">socklen_t</span><span style="color:#F07178;">) </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hostAddress</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span></span>
<span class="line"><span style="color:#F07178;">        )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">bytesSent</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">errno</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// Handle the results of the send.</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">strongDelegate</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">delegate</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> ( (</span><span style="color:#A6ACCD;">bytesSent</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> (((</span><span style="color:#A6ACCD;">NSUInteger</span><span style="color:#F07178;">) </span><span style="color:#A6ACCD;">bytesSent</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">packet</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;">) ) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// Complete success.  Tell the client.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> ( (</span><span style="color:#A6ACCD;">strongDelegate</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">nil</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">strongDelegate</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">respondsToSelector</span><span style="color:#F07178;">:@</span><span style="color:#82AAFF;">selector</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">simplePing</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">didSendPacket</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">sequenceNumber</span><span style="color:#F07178;">:)] ) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            [</span><span style="color:#A6ACCD;">strongDelegate</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">simplePing</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">didSendPacket</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">packet</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sequenceNumber</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">nextSequenceNumber</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">NSError</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">   </span><span style="color:#A6ACCD;">error</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// Some sort of failure.  Tell the client.</span></span>
<span class="line"><span style="color:#F07178;">        </span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ENOBUFS</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;">          </span><span style="color:#676E95;font-style:italic;">// This is not a hugely descriptor error, alas.</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">error</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">NSError</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">errorWithDomain</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">NSPOSIXErrorDomain</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">code</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">userInfo</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">nil</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> ( (</span><span style="color:#A6ACCD;">strongDelegate</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">nil</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">strongDelegate</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">respondsToSelector</span><span style="color:#F07178;">:@</span><span style="color:#82AAFF;">selector</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">simplePing</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">didFailToSendPacket</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">sequenceNumber</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">error</span><span style="color:#F07178;">:)] ) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            [</span><span style="color:#A6ACCD;">strongDelegate</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">simplePing</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">didFailToSendPacket</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">packet</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sequenceNumber</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">nextSequenceNumber</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">error</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">error</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">nextSequenceNumber</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">nextSequenceNumber</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">nextSequenceNumberHasWrapped</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">YES</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! Calculates the offset of the ICMP header within an IPv4 packet.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \details In the IPv4 case the kernel returns us a buffer that includes the </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      IPv4 header.  We&#39;re not interested in that, so we have to skip over it. </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      This code does a rough check of the IPv4 header and, if it looks OK, </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      returns the offset of the ICMP header.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param packet The IPv4 packet, as returned to us by the kernel.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \returns The offset of the ICMP header, or NSNotFound.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> (NSUInteger)</span><span style="color:#FFCB6B;">icmpHeaderOffsetInIPv4Packet</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(NSData </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)packet </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// Returns the offset of the ICMPv4Header within an IP packet.</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">NSUInteger</span><span style="color:#F07178;">                  </span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">struct</span><span style="color:#F07178;"> IPv4Header *   ipPtr</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">size_t</span><span style="color:#F07178;">                      </span><span style="color:#A6ACCD;">ipHeaderLength</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NSNotFound</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">packet</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&gt;=</span><span style="color:#F07178;"> (</span><span style="color:#82AAFF;">sizeof</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">IPv4Header</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">sizeof</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ICMPHeader</span><span style="color:#F07178;">))) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">ipPtr</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">IPv4Header</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">) </span><span style="color:#A6ACCD;">packet</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">bytes</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> ( ((</span><span style="color:#A6ACCD;">ipPtr</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;">versionAndHeaderLength</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0xF0</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0x40</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;">            </span><span style="color:#676E95;font-style:italic;">// IPv4</span></span>
<span class="line"><span style="color:#F07178;">             ( </span><span style="color:#A6ACCD;">ipPtr</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;">protocol</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">IPPROTO_ICMP</span><span style="color:#F07178;"> ) ) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">ipHeaderLength</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">ipPtr</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;">versionAndHeaderLength</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0x0F</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">sizeof</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">uint32_t</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">packet</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&gt;=</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">ipHeaderLength</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">sizeof</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ICMPHeader</span><span style="color:#F07178;">))) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ipHeaderLength</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! Checks whether the specified sequence number is one we sent.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param sequenceNumber The incoming sequence number.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \returns YES if the sequence number looks like one we sent.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (BOOL)</span><span style="color:#FFCB6B;">validateSequenceNumber</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(uint16_t)sequenceNumber </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">nextSequenceNumberHasWrapped</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// If the sequence numbers have wrapped that we can&#39;t reliably check </span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// whether this is a sequence number we sent.  Rather, we check to see </span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// whether the sequence number is within the last 120 sequence numbers </span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// we sent.  Note that the uint16_t subtraction here does the right </span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// thing regardless of the wrapping.</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// </span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// Why 120?  Well, if we send one ping per second, 120 is 2 minutes, which </span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// is the standard &quot;max time a packet can bounce around the Internet&quot; value.</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> ((</span><span style="color:#A6ACCD;">uint16_t</span><span style="color:#F07178;">) (</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">nextSequenceNumber</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sequenceNumber</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">uint16_t</span><span style="color:#F07178;">) </span><span style="color:#F78C6C;">120</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sequenceNumber</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">nextSequenceNumber</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! Checks whether an incoming IPv4 packet looks like a ping response.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \details This routine modifies this `packet` data!  It does this for two reasons:</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      * It needs to zero out the `checksum` field of the ICMPHeader in order to do </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *          its checksum calculation.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      * It removes the IPv4 header from the front of the packet.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param packet The IPv4 packet, as returned to us by the kernel.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param sequenceNumberPtr A pointer to a place to start the ICMP sequence number.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \returns YES if the packet looks like a reasonable IPv4 ping response.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (BOOL)</span><span style="color:#FFCB6B;">validatePing4ResponsePacket</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(NSMutableData </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)packet </span><span style="color:#FFCB6B;">sequenceNumber</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(uint16_t </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)sequenceNumberPtr </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">BOOL</span><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">NSUInteger</span><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">icmpHeaderOffset</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">ICMPHeader</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">icmpPtr</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">uint16_t</span><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">receivedChecksum</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">uint16_t</span><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">calculatedChecksum</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NO</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">icmpHeaderOffset</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [[</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">class</span><span style="color:#F07178;">] </span><span style="color:#A6ACCD;">icmpHeaderOffsetInIPv4Packet</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">packet</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">icmpHeaderOffset</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NSNotFound</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">icmpPtr</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">struct</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ICMPHeader</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">) (((</span><span style="color:#A6ACCD;">uint8_t</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">) </span><span style="color:#A6ACCD;">packet</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">mutableBytes</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">icmpHeaderOffset</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">receivedChecksum</span><span style="color:#F07178;">   </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">icmpPtr</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;">checksum</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">icmpPtr</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;">checksum</span><span style="color:#F07178;">  </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">calculatedChecksum</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">in_cksum</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">icmpPtr</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">packet</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">icmpHeaderOffset</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">icmpPtr</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;">checksum</span><span style="color:#F07178;">  </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">receivedChecksum</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">receivedChecksum</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">calculatedChecksum</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> ( (</span><span style="color:#A6ACCD;">icmpPtr</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;">type</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ICMPv4TypeEchoReply</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">icmpPtr</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;">code</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">) ) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> ( </span><span style="color:#82AAFF;">OSSwapBigToHostInt16</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">icmpPtr</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;">identifier</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">identifier</span><span style="color:#F07178;"> ) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#A6ACCD;">uint16_t</span><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">sequenceNumber</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                    </span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#A6ACCD;">sequenceNumber</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">OSSwapBigToHostInt16</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">icmpPtr</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;">sequenceNumber</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> ([</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">validateSequenceNumber</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">sequenceNumber</span><span style="color:#F07178;">]) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">                        </span><span style="color:#676E95;font-style:italic;">// Remove the IPv4 header off the front of the data we received, leaving us with </span></span>
<span class="line"><span style="color:#89DDFF;">                        </span><span style="color:#676E95;font-style:italic;">// just the ICMP header and the ping payload.</span></span>
<span class="line"><span style="color:#F07178;">                        [</span><span style="color:#A6ACCD;">packet</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">replaceBytesInRange</span><span style="color:#F07178;">:</span><span style="color:#82AAFF;">NSMakeRange</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">icmpHeaderOffset</span><span style="color:#F07178;">) </span><span style="color:#A6ACCD;">withBytes</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">NULL</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;">:</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">sequenceNumberPtr</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sequenceNumber</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">YES</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! Checks whether an incoming IPv6 packet looks like a ping response.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param packet The IPv6 packet, as returned to us by the kernel; note that this routine</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      could modify this data but does not need to in the IPv6 case.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param sequenceNumberPtr A pointer to a place to start the ICMP sequence number.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \returns YES if the packet looks like a reasonable IPv4 ping response.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (BOOL)</span><span style="color:#FFCB6B;">validatePing6ResponsePacket</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(NSMutableData </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)packet </span><span style="color:#FFCB6B;">sequenceNumber</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(uint16_t </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)sequenceNumberPtr </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">BOOL</span><span style="color:#F07178;">                    </span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ICMPHeader</span><span style="color:#F07178;"> *      icmpPtr</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NO</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">packet</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&gt;=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">sizeof</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">icmpPtr</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">icmpPtr</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">packet</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">bytes</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// In the IPv6 case we don&#39;t check the checksum because that&#39;s hard (we need to </span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// cook up an IPv6 pseudo header and we don&#39;t have the ingredients) and unnecessary </span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// (the kernel has already done this check).</span></span>
<span class="line"><span style="color:#F07178;">        </span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> ( (</span><span style="color:#A6ACCD;">icmpPtr</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;">type</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ICMPv6TypeEchoReply</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">icmpPtr</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;">code</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">) ) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> ( </span><span style="color:#82AAFF;">OSSwapBigToHostInt16</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">icmpPtr</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;">identifier</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">identifier</span><span style="color:#F07178;"> ) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">uint16_t</span><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">sequenceNumber</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                </span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">sequenceNumber</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">OSSwapBigToHostInt16</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">icmpPtr</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;">sequenceNumber</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> ([</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">validateSequenceNumber</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">sequenceNumber</span><span style="color:#F07178;">]) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">sequenceNumberPtr</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sequenceNumber</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">YES</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! Checks whether an incoming packet looks like a ping response.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param packet The packet, as returned to us by the kernel; note that may end up modifying </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      this data.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param sequenceNumberPtr A pointer to a place to start the ICMP sequence number.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \returns YES if the packet looks like a reasonable IPv4 ping response.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (BOOL)</span><span style="color:#FFCB6B;">validatePingResponsePacket</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(NSMutableData </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)packet </span><span style="color:#FFCB6B;">sequenceNumber</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(uint16_t </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)sequenceNumberPtr </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">BOOL</span><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">switch</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hostAddressFamily</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">AF_INET</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">validatePing4ResponsePacket</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">packet</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sequenceNumber</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">sequenceNumberPtr</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">AF_INET6</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">validatePing6ResponsePacket</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">packet</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sequenceNumber</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">sequenceNumberPtr</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">assert</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">NO</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NO</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! Reads data from the ICMP socket.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \details Called by the socket handling code (SocketReadCallback) to process an ICMP </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      message waiting on the socket.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;">)readData </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">int</span><span style="color:#F07178;">                     </span><span style="color:#A6ACCD;">err</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">struct</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sockaddr_storage</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">addr</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">socklen_t</span><span style="color:#F07178;">               </span><span style="color:#A6ACCD;">addrLen</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">ssize_t</span><span style="color:#F07178;">                 </span><span style="color:#A6ACCD;">bytesRead</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">void</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">                  </span><span style="color:#A6ACCD;">buffer</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">enum</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">kBufferSize</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">65535</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 65535 is the maximum IP packet size, which seems like a reasonable bound </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// here (plus it&#39;s what &lt;x-man-page://8/ping&gt; uses).</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">buffer</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">malloc</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">kBufferSize</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">assert</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">buffer</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NULL</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// Actually read the data.  We use recvfrom(), and thus get back the source address, </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// but we don&#39;t actually do anything with it.  It would be trivial to pass it to </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// the delegate but we don&#39;t need it in this example.</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">addrLen</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">sizeof</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">addr</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">bytesRead</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">recvfrom</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">CFSocketGetNative</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">socket</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">buffer</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">kBufferSize</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">struct</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sockaddr</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">addr</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">addrLen</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">bytesRead</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">errno</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// Process the data we read.</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">bytesRead</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">NSMutableData</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">         </span><span style="color:#A6ACCD;">packet</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">SimplePingDelegate</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">strongDelegate</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">uint16_t</span><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">sequenceNumber</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">packet</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">NSMutableData</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">dataWithBytes</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">buffer</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;">:(</span><span style="color:#A6ACCD;">NSUInteger</span><span style="color:#F07178;">) </span><span style="color:#A6ACCD;">bytesRead</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">assert</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">packet</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">nil</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// We got some data, pass it up to our client.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">strongDelegate</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">delegate</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> ( [</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">validatePingResponsePacket</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">packet</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sequenceNumber</span><span style="color:#F07178;">:</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">sequenceNumber</span><span style="color:#F07178;">] ) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> ( (</span><span style="color:#A6ACCD;">strongDelegate</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">nil</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">strongDelegate</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">respondsToSelector</span><span style="color:#F07178;">:@</span><span style="color:#82AAFF;">selector</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">simplePing</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">didReceivePingResponsePacket</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">sequenceNumber</span><span style="color:#F07178;">:)] ) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                [</span><span style="color:#A6ACCD;">strongDelegate</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">simplePing</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">didReceivePingResponsePacket</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">packet</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sequenceNumber</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">sequenceNumber</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> ( (</span><span style="color:#A6ACCD;">strongDelegate</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">nil</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">strongDelegate</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">respondsToSelector</span><span style="color:#F07178;">:@</span><span style="color:#82AAFF;">selector</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">simplePing</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">didReceiveUnexpectedPacket</span><span style="color:#F07178;">:)] ) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                [</span><span style="color:#A6ACCD;">strongDelegate</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">simplePing</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">didReceiveUnexpectedPacket</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">packet</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// We failed to read the data, so shut everything down.</span></span>
<span class="line"><span style="color:#F07178;">        </span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">EPIPE</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        [</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">didFailWithError</span><span style="color:#F07178;">:[</span><span style="color:#A6ACCD;">NSError</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">errorWithDomain</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">NSPOSIXErrorDomain</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">code</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">userInfo</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">nil</span><span style="color:#F07178;">]]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">free</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">buffer</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// Note that we don&#39;t loop back trying to read more data.  Rather, we just </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// let CFSocket call us again.</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! The callback for our CFSocket object.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \details This simply routes the call to our `-readData` method.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param s See the documentation for CFSocketCallBack.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param type See the documentation for CFSocketCallBack.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param address See the documentation for CFSocketCallBack.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param data See the documentation for CFSocketCallBack.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param info See the documentation for CFSocketCallBack; this is actually a pointer to the </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      &#39;owning&#39; object.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">static </span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">SocketReadCallback</span><span style="color:#A6ACCD;">(CFSocketRef s</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> CFSocketCallBackType type</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> CFDataRef address</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> const </span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">info) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// This C routine is called by CFSocket when there&#39;s data waiting on our </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// ICMP socket.  It just redirects the call to Objective-C code.</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">SimplePing</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">obj</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">obj</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">__bridge</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">SimplePing</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">) </span><span style="color:#A6ACCD;">info</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">assert</span><span style="color:#F07178;">([</span><span style="color:#A6ACCD;">obj</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">isKindOfClass</span><span style="color:#F07178;">:[</span><span style="color:#A6ACCD;">SimplePing</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">class</span><span style="color:#F07178;">]])</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    #</span><span style="color:#A6ACCD;">pragma</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">unused</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">s</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">assert</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">s</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">obj</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">socket</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    #</span><span style="color:#A6ACCD;">pragma</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">unused</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">type</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">assert</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">type</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">kCFSocketReadCallBack</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    #</span><span style="color:#A6ACCD;">pragma</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">unused</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">address</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">assert</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">address</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">nil</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    #</span><span style="color:#A6ACCD;">pragma</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">unused</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">assert</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">nil</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    [</span><span style="color:#A6ACCD;">obj</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">readData</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! Starts the send and receive infrastructure.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \details This is called once we&#39;ve successfully resolved `hostName` in to </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      `hostAddress`.  It&#39;s responsible for setting up the socket for sending and </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      receiving pings.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;">)startWithHostAddress </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">int</span><span style="color:#F07178;">                     </span><span style="color:#A6ACCD;">err</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">int</span><span style="color:#F07178;">                     </span><span style="color:#A6ACCD;">fd</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">assert</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hostAddress</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">nil</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// Open the socket.</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">fd</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">switch</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hostAddressFamily</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">AF_INET</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">fd</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">socket</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">AF_INET</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">SOCK_DGRAM</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">IPPROTO_ICMP</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">fd</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">errno</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">AF_INET6</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">fd</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">socket</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">AF_INET6</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">SOCK_DGRAM</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">IPPROTO_ICMPV6</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">fd</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">errno</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">EPROTONOSUPPORT</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        [</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">didFailWithError</span><span style="color:#F07178;">:[</span><span style="color:#A6ACCD;">NSError</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">errorWithDomain</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">NSPOSIXErrorDomain</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">code</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">userInfo</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">nil</span><span style="color:#F07178;">]]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">CFSocketContext</span><span style="color:#F07178;">         </span><span style="color:#A6ACCD;">context</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> (__bridge void *)(self)</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NULL</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NULL</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NULL</span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">CFRunLoopSourceRef</span><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">rls</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">SimplePingDelegate</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">strongDelegate</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// Wrap it in a CFSocket and schedule it on the runloop.</span></span>
<span class="line"><span style="color:#F07178;">        </span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">socket</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">CFSocketRef</span><span style="color:#F07178;">) </span><span style="color:#82AAFF;">CFAutorelease</span><span style="color:#F07178;">( </span><span style="color:#82AAFF;">CFSocketCreateWithNative</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">NULL</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fd</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">kCFSocketReadCallBack</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">SocketReadCallback</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">context</span><span style="color:#F07178;">) )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">assert</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">socket</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NULL</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// The socket will now take care of cleaning up our file descriptor.</span></span>
<span class="line"><span style="color:#F07178;">        </span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">assert</span><span style="color:#F07178;">( </span><span style="color:#82AAFF;">CFSocketGetSocketFlags</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">socket</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">&amp;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">kCFSocketCloseOnInvalidate</span><span style="color:#F07178;"> )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">fd</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">rls</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">CFSocketCreateRunLoopSource</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">NULL</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">socket</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">assert</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">rls</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NULL</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">CFRunLoopAddSource</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">CFRunLoopGetCurrent</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">rls</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">kCFRunLoopDefaultMode</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">CFRelease</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">rls</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">strongDelegate</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">delegate</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> ( (</span><span style="color:#A6ACCD;">strongDelegate</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">nil</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">strongDelegate</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">respondsToSelector</span><span style="color:#F07178;">:@</span><span style="color:#82AAFF;">selector</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">simplePing</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">didStartWithAddress</span><span style="color:#F07178;">:)] ) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            [</span><span style="color:#A6ACCD;">strongDelegate</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">simplePing</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">didStartWithAddress</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hostAddress</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">assert</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">fd</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! Processes the results of our name-to-address resolution.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \details Called by our CFHost resolution callback (HostResolveCallback) when host </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      resolution is complete.  We just latch the first appropriate address and kick </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      off the send and receive infrastructure.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;">)hostResolutionDone </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">Boolean</span><span style="color:#F07178;">     </span><span style="color:#A6ACCD;">resolved</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">NSArray</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">   </span><span style="color:#A6ACCD;">addresses</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// Find the first appropriate address.</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">addresses</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">__bridge</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NSArray</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">) </span><span style="color:#82AAFF;">CFHostGetAddressing</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">host</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">resolved</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> ( </span><span style="color:#A6ACCD;">resolved</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">addresses</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">nil</span><span style="color:#F07178;">) ) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">resolved</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">NSData</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">address</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">in</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">addresses</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">struct</span><span style="color:#F07178;"> sockaddr * addrPtr</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">addrPtr</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">struct</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sockaddr</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">) </span><span style="color:#A6ACCD;">address</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">bytes</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> ( </span><span style="color:#A6ACCD;">address</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&gt;=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">sizeof</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">struct</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sockaddr</span><span style="color:#F07178;">) ) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">char</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">s</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NULL</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;font-style:italic;">switch</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">addrPtr</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;">sa_family</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">AF_INET</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#A6ACCD;">struct</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sockaddr_in</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">addr_in</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">struct</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sockaddr_in</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">)</span><span style="color:#A6ACCD;">addrPtr</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#A6ACCD;">s</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">malloc</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">INET_ADDRSTRLEN</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#82AAFF;">inet_ntop</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">AF_INET</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">addr_in</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;">sin_addr</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">s</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">INET_ADDRSTRLEN</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">IPAddress</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">NSString</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">stringWithFormat</span><span style="color:#F07178;">:@</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">%s</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">s</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">addressStyle</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">SimplePingAddressStyleICMPv6</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                            </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hostAddress</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">address</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                            </span><span style="color:#A6ACCD;">resolved</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">AF_INET6</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#A6ACCD;">struct</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sockaddr_in6</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">addr_in6</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">struct</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sockaddr_in6</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">)</span><span style="color:#A6ACCD;">addrPtr</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#A6ACCD;">s</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">malloc</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">INET6_ADDRSTRLEN</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#82AAFF;">inet_ntop</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">AF_INET6</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">addr_in6</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;">sin6_addr</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">s</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">INET6_ADDRSTRLEN</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">IPAddress</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">NSString</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">stringWithFormat</span><span style="color:#F07178;">:@</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">%s</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">s</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">addressStyle</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">SimplePingAddressStyleICMPv4</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                            </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hostAddress</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">address</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                            </span><span style="color:#A6ACCD;">resolved</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">resolved</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;font-style:italic;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// We&#39;re done resolving, so shut that down.</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    [</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">stopHostResolution</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// If all is OK, start the send and receive infrastructure, otherwise stop.</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">resolved</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        [</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">startWithHostAddress</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        [</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">didFailWithError</span><span style="color:#F07178;">:[</span><span style="color:#A6ACCD;">NSError</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">errorWithDomain</span><span style="color:#F07178;">:(</span><span style="color:#A6ACCD;">NSString</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">)</span><span style="color:#A6ACCD;">kCFErrorDomainCFNetwork</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">code</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">kCFHostErrorHostNotFound</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">userInfo</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">nil</span><span style="color:#F07178;">]]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! The callback for our CFHost object.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \details This simply routes the call to our `-hostResolutionDone` or </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      `-didFailWithHostStreamError:` methods.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param theHost See the documentation for CFHostClientCallBack.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param typeInfo See the documentation for CFHostClientCallBack.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param error See the documentation for CFHostClientCallBack.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *  \param info See the documentation for CFHostClientCallBack; this is actually a pointer to </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *      the &#39;owning&#39; object.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">static </span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">HostResolveCallback</span><span style="color:#A6ACCD;">(CFHostRef theHost</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> CFHostInfoType typeInfo</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> const CFStreamError </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">error</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">info) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// This C routine is called by CFHost when the host resolution is complete. </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// It just redirects the call to the appropriate Objective-C method.</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">SimplePing</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">obj</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">obj</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">__bridge</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">SimplePing</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">) </span><span style="color:#A6ACCD;">info</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">assert</span><span style="color:#F07178;">([</span><span style="color:#A6ACCD;">obj</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">isKindOfClass</span><span style="color:#F07178;">:[</span><span style="color:#A6ACCD;">SimplePing</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">class</span><span style="color:#F07178;">]])</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    #</span><span style="color:#A6ACCD;">pragma</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">unused</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">theHost</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">assert</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">theHost</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">obj</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">host</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    #</span><span style="color:#A6ACCD;">pragma</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">unused</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">typeInfo</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">assert</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">typeInfo</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">kCFHostAddresses</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> ( (</span><span style="color:#A6ACCD;">error</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NULL</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">error</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;">domain</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">) ) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        [</span><span style="color:#A6ACCD;">obj</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">didFailWithHostStreamError</span><span style="color:#F07178;">:</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">error</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        [</span><span style="color:#A6ACCD;">obj</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">hostResolutionDone</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;">)start </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">Boolean</span><span style="color:#F07178;">             </span><span style="color:#A6ACCD;">success</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">CFHostClientContext</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">context</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> (__bridge void *)(self)</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NULL</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NULL</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NULL</span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">CFStreamError</span><span style="color:#F07178;">       </span><span style="color:#A6ACCD;">streamError</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">assert</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">host</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NULL</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">assert</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hostAddress</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">nil</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">host</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">CFHostRef</span><span style="color:#F07178;">) </span><span style="color:#82AAFF;">CFAutorelease</span><span style="color:#F07178;">( </span><span style="color:#82AAFF;">CFHostCreateWithName</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">NULL</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">__bridge</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">CFStringRef</span><span style="color:#F07178;">) </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hostName</span><span style="color:#F07178;">) )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">assert</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">host</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NULL</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">CFHostSetClient</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">host</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">HostResolveCallback</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">context</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">CFHostScheduleWithRunLoop</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">host</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">CFRunLoopGetCurrent</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">kCFRunLoopDefaultMode</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">success</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">CFHostStartInfoResolution</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">host</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">kCFHostAddresses</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">streamError</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> ( </span><span style="color:#89DDFF;">!</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">success</span><span style="color:#F07178;"> ) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        [</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">didFailWithHostStreamError</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">streamError</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! Stops the name-to-address resolution infrastructure.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;">)stopHostResolution </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// Shut down the CFHost.</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">host</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NULL</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">CFHostSetClient</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">host</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NULL</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NULL</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">CFHostUnscheduleFromRunLoop</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">host</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">CFRunLoopGetCurrent</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">kCFRunLoopDefaultMode</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">host</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NULL</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*! Stops the send and receive infrastructure.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;">)stopSocket </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">socket</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NULL</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">CFSocketInvalidate</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">socket</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">socket</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NULL</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;">)stop </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    [</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">stopHostResolution</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    [</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">stopSocket</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// Junk the host address on stop.  If the client calls -start again, we&#39;ll </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// re-resolve the host name.</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">IPAddress</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">nil</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hostAddress</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NULL</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">end</span></span></code></pre></div><h2 id="mzpingservices-h" tabindex="-1">MZPingServices.h <a class="header-anchor" href="#mzpingservices-h" aria-label="Permalink to &quot;MZPingServices.h&quot;">​</a></h2><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">#</span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> &lt;Foundation/Foundation.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">typedef NS_ENUM(NSInteger</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> CYPPingStatus) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">CYPPingStatusDidStart</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">CYPPingStatusDidFailToSendPacket</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">CYPPingStatusDidReceivePacket</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">CYPPingStatusDidReceiveUnexpectedPacket</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">CYPPingStatusDidTimeout</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">CYPPingStatusError</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">CYPPingStatusFinished</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">@interface CYPPingItem : NSObject</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">@property(nonatomic</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> copy) NSString </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">originalAddress; </span><span style="color:#676E95;font-style:italic;">// ping的域名</span></span>
<span class="line"><span style="color:#A6ACCD;">@property(nonatomic</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> copy) NSString </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">IPAddress; </span><span style="color:#676E95;font-style:italic;">// 客户端请求ip</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">@property(nonatomic</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> assign) NSUInteger dateBytesLength; </span><span style="color:#676E95;font-style:italic;">// 数据长度</span></span>
<span class="line"><span style="color:#A6ACCD;">@property(nonatomic</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> assign) double timeMilliseconds;</span></span>
<span class="line"><span style="color:#A6ACCD;">@property(nonatomic</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> assign) NSInteger timeToLive;</span></span>
<span class="line"><span style="color:#A6ACCD;">@property(nonatomic</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> assign) NSInteger ICMPSequence; </span><span style="color:#676E95;font-style:italic;">// icmp</span></span>
<span class="line"><span style="color:#A6ACCD;">@property(nonatomic</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> strong) NSDate </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">sendDate; </span><span style="color:#676E95;font-style:italic;">// 发送数据时间</span></span>
<span class="line"><span style="color:#A6ACCD;">@property(nonatomic</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> strong) NSDate </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">receivedDate; </span><span style="color:#676E95;font-style:italic;">// 接受数据时间</span></span>
<span class="line"><span style="color:#A6ACCD;">@property(nonatomic) CYPPingStatus status; </span><span style="color:#676E95;font-style:italic;">// 请求状态</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 分析统计结果</span></span>
<span class="line"><span style="color:#A6ACCD;">+ (NSString </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)statisticsWithPingItems:(NSArray </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)pingItems;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">@end</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">@interface CYPPingServices : NSObject</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/// 超时时间, default 500ms</span></span>
<span class="line"><span style="color:#A6ACCD;">@property(nonatomic) double timeoutMilliseconds;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/// 最大ping次数</span></span>
<span class="line"><span style="color:#A6ACCD;">@property(nonatomic) NSInteger  maximumPingTimes;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">+ (CYPPingServices </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)startPingAddress:(NSString </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)address</span></span>
<span class="line"><span style="color:#A6ACCD;">                      callbackHandler:(void(^)(CYPPingItem </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> NSArray </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">pingItems))handler;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">@end</span></span></code></pre></div><h2 id="mzpingservices-m" tabindex="-1">MZPingServices.m <a class="header-anchor" href="#mzpingservices-m" aria-label="Permalink to &quot;MZPingServices.m&quot;">​</a></h2><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">#</span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">CYPPingServices.h</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">#</span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">SimplePing.h</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">implementation CYPPingItem</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#pragma mark </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> 分析结果</span></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> (NSString </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)</span><span style="color:#FFCB6B;">statisticsWithPingItems</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(NSArray </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)pingItems </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//    --- ping statistics ---</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//    5 packets transmitted, 5 packets received, 0.0% packet loss</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//    round-trip min/avg/max/stddev = 4.445/9.496/12.210/2.832 ms</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">NSString</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">address</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">pingItems</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">firstObject</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">originalAddress</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">__block</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NSInteger</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">receivedCount</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">allCount</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">__block</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">CGFloat</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">delTime</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0.0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    [</span><span style="color:#A6ACCD;">pingItems</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">enumerateObjectsUsingBlock</span><span style="color:#F07178;">:</span><span style="color:#89DDFF;">^</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">CYPPingItem</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">obj</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NSUInteger</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">idx</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">BOOL</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">stop</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        if </span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">obj.status != </span><span style="color:#A6ACCD;font-style:italic;">CYPPingStatusFinished</span><span style="color:#F07178;"> &amp;&amp; obj.status != </span><span style="color:#A6ACCD;font-style:italic;">CYPPingStatusError</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">allCount</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">++;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">obj</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">CYPPingStatusDidReceivePacket</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">delTime</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+=</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">obj</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">receivedDate</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">timeIntervalSinceDate</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">obj</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">sendDate</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1000</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">receivedCount</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">++;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">NSMutableString</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">description</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">NSMutableString</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">stringWithCapacity</span><span style="color:#F07178;">:</span><span style="color:#F78C6C;">50</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    [</span><span style="color:#A6ACCD;">description</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">appendFormat</span><span style="color:#F07178;">:@</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">--- %@ ping statistics ---</span><span style="color:#A6ACCD;">\n</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">address</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">CGFloat</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">lossPercent</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">CGFloat</span><span style="color:#F07178;">)(</span><span style="color:#A6ACCD;">allCount</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">receivedCount</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">/</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">MAX</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">1.0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">allCount</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">100</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    [</span><span style="color:#A6ACCD;">description</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">appendFormat</span><span style="color:#F07178;">:@</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">%ld packets transmitted, %ld packets received, %.1f%% packet, loss deltime %.3fms </span><span style="color:#A6ACCD;">\n</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">long</span><span style="color:#F07178;">)</span><span style="color:#A6ACCD;">allCount</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">long</span><span style="color:#F07178;">)</span><span style="color:#A6ACCD;">receivedCount</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">lossPercent</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">delTime</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">allCount</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">description</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">stringByReplacingOccurrencesOfString</span><span style="color:#F07178;">:@</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">.0%</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">withString</span><span style="color:#F07178;">:@</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">%</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#pragma mark </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> 生成对应状态描述</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (NSString </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)description </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">switch</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">CYPPingStatusDidStart</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">NSString</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">stringWithFormat</span><span style="color:#F07178;">:@</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">PING %@ (%@): %ld data bytes</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">originalAddress</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">IPAddress</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">long</span><span style="color:#F07178;">)</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">dateBytesLength</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">CYPPingStatusDidReceivePacket</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">NSString</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">stringWithFormat</span><span style="color:#F07178;">:@</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">%ld bytes from %@: icmp_seq=%ld ttl=%ld time=%.3fms deltime=%.3fms</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">long</span><span style="color:#F07178;">)</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">dateBytesLength</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">IPAddress</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">long</span><span style="color:#F07178;">)</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ICMPSequence</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">long</span><span style="color:#F07178;">)</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">timeToLive</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">timeMilliseconds</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;">     [</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">receivedDate</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">timeIntervalSinceDate</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">sendDate</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1000</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">CYPPingStatusDidTimeout</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">NSString</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">stringWithFormat</span><span style="color:#F07178;">:@</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Request timeout for icmp_seq %ld</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">long</span><span style="color:#F07178;">)</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ICMPSequence</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">CYPPingStatusDidFailToSendPacket</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">NSString</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">stringWithFormat</span><span style="color:#F07178;">:@</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Fail to send packet to %@: icmp_seq=%ld</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">IPAddress</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">long</span><span style="color:#F07178;">)</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ICMPSequence</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">CYPPingStatusDidReceiveUnexpectedPacket</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">NSString</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">stringWithFormat</span><span style="color:#F07178;">:@</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Receive unexpected packet from %@: icmp_seq=%ld</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">IPAddress</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">long</span><span style="color:#F07178;">)</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ICMPSequence</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">CYPPingStatusError</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">NSString</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">stringWithFormat</span><span style="color:#F07178;">:@</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Can not ping to %@</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">originalAddress</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">super</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">description</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">interface </span><span style="color:#82AAFF;">CYPPingServices</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">SimplePingDelegate</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    NSMutableArray *_pingItems; </span><span style="color:#676E95;font-style:italic;">// ping处理记录</span></span>
<span class="line"><span style="color:#A6ACCD;">    NSInteger   _repingTimes; </span><span style="color:#676E95;font-style:italic;">// 重新请求次数</span></span>
<span class="line"><span style="color:#A6ACCD;">    BOOL _hasStarted; </span><span style="color:#676E95;font-style:italic;">// 是否已经开始</span></span>
<span class="line"><span style="color:#A6ACCD;">    NSInteger _sequenceNumber;</span></span>
<span class="line"><span style="color:#A6ACCD;">    NSDate *_packetSendDate; </span><span style="color:#676E95;font-style:italic;">// 开始发包时间</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">property</span><span style="color:#A6ACCD;">(nonatomic</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> copy) NSString </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">address</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// ping的地址</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">property</span><span style="color:#A6ACCD;">(nonatomic</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> strong) SimplePing </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">simplePing</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">property</span><span style="color:#A6ACCD;">(nonatomic</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> copy) </span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">^</span><span style="color:#A6ACCD;">callbackHandler)(CYPPingItem </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">item</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> NSArray </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">pingItems)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// cb</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">implementation CYPPingServices</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> (CYPPingServices </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)</span><span style="color:#FFCB6B;">startPingAddress</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(NSString </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)address</span></span>
<span class="line"><span style="color:#A6ACCD;">                      </span><span style="color:#FFCB6B;">callbackHandler</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">^</span><span style="color:#A6ACCD;">)(CYPPingItem </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> NSArray </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">pingItems))handler </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">CYPPingServices</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">services</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [[</span><span style="color:#A6ACCD;">CYPPingServices</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">alloc</span><span style="color:#F07178;">] </span><span style="color:#A6ACCD;">initWithAddress</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">address</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">services</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">callbackHandler</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">handler</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    [</span><span style="color:#A6ACCD;">services</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">startPing</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">services</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (instancetype)</span><span style="color:#FFCB6B;">initWithAddress</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(NSString </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)address </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">super</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">init</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">timeoutMilliseconds</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">500</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">maximumPingTimes</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">100</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">address</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">address</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">simplePing</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [[</span><span style="color:#A6ACCD;">SimplePing</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">alloc</span><span style="color:#F07178;">] </span><span style="color:#A6ACCD;">initWithHostName</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">address</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">simplePing</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">addressStyle</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">SimplePingAddressStyleAny</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">simplePing</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">delegate</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">_pingItems</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">NSMutableArray</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">arrayWithCapacity</span><span style="color:#F07178;">: </span><span style="color:#F78C6C;">10</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;">)startPing </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">_repingTimes</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">_hasStarted</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">NO</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    [</span><span style="color:#A6ACCD;">_pingItems</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">removeAllObjects</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    [</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">simplePing</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">start</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#pragma mark </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> 重新请求</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;">)reping </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    [</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">simplePing</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">stop</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    [</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">simplePing</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">start</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;">)_timeoutActionFired </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">CYPPingItem</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">pingItem</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [[</span><span style="color:#A6ACCD;">CYPPingItem</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">alloc</span><span style="color:#F07178;">] </span><span style="color:#A6ACCD;">init</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ICMPSequence</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">_sequenceNumber</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">originalAddress</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">address</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">CYPPingStatusDidTimeout</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">sendDate</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">_packetSendDate</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">receivedDate</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">NSDate</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">date</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    [</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">simplePing</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">stop</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    [</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">_handlePingItem</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">pingItem</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;">)</span><span style="color:#FFCB6B;">_handlePingItem</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(CYPPingItem </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)pingItem </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">CYPPingStatusDidReceivePacket</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">CYPPingStatusDidTimeout</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        [</span><span style="color:#A6ACCD;">_pingItems</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">addObject</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">pingItem</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">_repingTimes</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">maximumPingTimes</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">callbackHandler</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">callbackHandler</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">_pingItems</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">copy</span><span style="color:#F07178;">])</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">_repingTimes</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">++;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">NSTimer</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">timer</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">NSTimer</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">timerWithTimeInterval</span><span style="color:#F07178;">:</span><span style="color:#F78C6C;">1.0</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">target</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">selector</span><span style="color:#F07178;">:@</span><span style="color:#82AAFF;">selector</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">reping</span><span style="color:#F07178;">) </span><span style="color:#A6ACCD;">userInfo</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">nil</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">repeats</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">NO</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        [[</span><span style="color:#A6ACCD;">NSRunLoop</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">currentRunLoop</span><span style="color:#F07178;">] </span><span style="color:#A6ACCD;">addTimer</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">timer</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">forMode</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">NSRunLoopCommonModes</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">callbackHandler</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">callbackHandler</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">_pingItems</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">copy</span><span style="color:#F07178;">])</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        [</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">cancel</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;">)cancel </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    [[</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">class</span><span style="color:#F07178;">] </span><span style="color:#A6ACCD;">cancelPreviousPerformRequestsWithTarget</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">selector</span><span style="color:#F07178;">:@</span><span style="color:#82AAFF;">selector</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">_timeoutActionFired</span><span style="color:#F07178;">) </span><span style="color:#A6ACCD;">object</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">nil</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    [</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">simplePing</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">stop</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">CYPPingItem</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">pingItem</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [[</span><span style="color:#A6ACCD;">CYPPingItem</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">alloc</span><span style="color:#F07178;">] </span><span style="color:#A6ACCD;">init</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">CYPPingStatusFinished</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    [</span><span style="color:#A6ACCD;">_pingItems</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">addObject</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">pingItem</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">callbackHandler</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">callbackHandler</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">_pingItems</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">copy</span><span style="color:#F07178;">])</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;">)</span><span style="color:#FFCB6B;">simplePing</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(SimplePing </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)pinger </span><span style="color:#FFCB6B;">didStartWithAddress</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(NSData </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)address </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">_packetSendDate</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">NSDate</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">date</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">_hasStarted</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">CYPPingItem</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">pingItem</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [[</span><span style="color:#A6ACCD;">CYPPingItem</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">alloc</span><span style="color:#F07178;">] </span><span style="color:#A6ACCD;">init</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">IPAddress</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">pinger</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">IPAddress</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">originalAddress</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">address</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">CYPPingStatusDidStart</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">callbackHandler</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">callbackHandler</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">nil</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">_hasStarted</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">YES</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    [</span><span style="color:#A6ACCD;">pinger</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sendPingWithData</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">nil</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    [</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">performSelector</span><span style="color:#F07178;">:@</span><span style="color:#82AAFF;">selector</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">_timeoutActionFired</span><span style="color:#F07178;">) </span><span style="color:#A6ACCD;">withObject</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">nil</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">afterDelay</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">timeoutMilliseconds</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">/</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1000.0</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;">)</span><span style="color:#FFCB6B;">simplePing</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(SimplePing </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)pinger </span><span style="color:#FFCB6B;">didSendPacket</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(NSData </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)packet </span><span style="color:#FFCB6B;">sequenceNumber</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(uint16_t)sequenceNumber </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">_sequenceNumber</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sequenceNumber</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#pragma mark </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> 发送包失败</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;">)</span><span style="color:#FFCB6B;">simplePing</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(SimplePing </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)pinger </span><span style="color:#FFCB6B;">didFailToSendPacket</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(NSData </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)packet </span><span style="color:#FFCB6B;">sequenceNumber</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(uint16_t)sequenceNumber </span><span style="color:#FFCB6B;">error</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(NSError </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)error </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    [[</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">class</span><span style="color:#F07178;">] </span><span style="color:#A6ACCD;">cancelPreviousPerformRequestsWithTarget</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">selector</span><span style="color:#F07178;">:@</span><span style="color:#82AAFF;">selector</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">_timeoutActionFired</span><span style="color:#F07178;">) </span><span style="color:#A6ACCD;">object</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">nil</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// _sequenceNumber = sequenceNumber;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">CYPPingItem</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">pingItem</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [[</span><span style="color:#A6ACCD;">CYPPingItem</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">alloc</span><span style="color:#F07178;">] </span><span style="color:#A6ACCD;">init</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ICMPSequence</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sequenceNumber</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">originalAddress</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">address</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">CYPPingStatusDidFailToSendPacket</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    [</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">_handlePingItem</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">pingItem</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#pragma mark </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> 收到异常包数据</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;">)</span><span style="color:#FFCB6B;">simplePing</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(SimplePing </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)pinger </span><span style="color:#FFCB6B;">didReceiveUnexpectedPacket</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(NSData </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)packet </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    [[</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">class</span><span style="color:#F07178;">] </span><span style="color:#A6ACCD;">cancelPreviousPerformRequestsWithTarget</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">selector</span><span style="color:#F07178;">:@</span><span style="color:#82AAFF;">selector</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">_timeoutActionFired</span><span style="color:#F07178;">) </span><span style="color:#A6ACCD;">object</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">nil</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">CYPPingItem</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">pingItem</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [[</span><span style="color:#A6ACCD;">CYPPingItem</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">alloc</span><span style="color:#F07178;">] </span><span style="color:#A6ACCD;">init</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ICMPSequence</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">_sequenceNumber</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">originalAddress</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">address</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">dateBytesLength</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">packet</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">CYPPingStatusDidReceiveUnexpectedPacket</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    [</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">_handlePingItem</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">pingItem</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#pragma mark </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> 收到包数据</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;">)</span><span style="color:#FFCB6B;">simplePing</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(SimplePing </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)pinger </span><span style="color:#FFCB6B;">didReceivePingResponsePacket</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(NSData </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)packet </span><span style="color:#FFCB6B;">sequenceNumber</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(uint16_t)sequenceNumber </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    [[</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">class</span><span style="color:#F07178;">] </span><span style="color:#A6ACCD;">cancelPreviousPerformRequestsWithTarget</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">selector</span><span style="color:#F07178;">:@</span><span style="color:#82AAFF;">selector</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">_timeoutActionFired</span><span style="color:#F07178;">) </span><span style="color:#A6ACCD;">object</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">nil</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">CYPPingItem</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">pingItem</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [[</span><span style="color:#A6ACCD;">CYPPingItem</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">alloc</span><span style="color:#F07178;">] </span><span style="color:#A6ACCD;">init</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">IPAddress</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">pinger</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">IPAddress</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">dateBytesLength</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">packet</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">sendDate</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">_packetSendDate</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">receivedDate</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">NSDate</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">date</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// pingItem.timeToLive = timeToLive;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// pingItem.timeMilliseconds = timeElapsed * 1000;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ICMPSequence</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sequenceNumber</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">originalAddress</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">address</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">CYPPingStatusDidReceivePacket</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    [</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">_handlePingItem</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">pingItem</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#pragma mark </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> 连接</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">发送失败</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;">)</span><span style="color:#FFCB6B;">simplePing</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(SimplePing </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)pinger </span><span style="color:#FFCB6B;">didFailWithError</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(NSError </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)error </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    [[</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">class</span><span style="color:#F07178;">] </span><span style="color:#A6ACCD;">cancelPreviousPerformRequestsWithTarget</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">selector</span><span style="color:#F07178;">:@</span><span style="color:#82AAFF;">selector</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">_timeoutActionFired</span><span style="color:#F07178;">) </span><span style="color:#A6ACCD;">object</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">nil</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    [</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">simplePing</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">stop</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//    CYPPingItem *errorPingItem = [[CYPPingItem alloc] init];</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//    errorPingItem.originalAddress = self.address;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//    errorPingItem.status = CYPPingStatusError;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//    if (self.callbackHandler) {</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//        self.callbackHandler(errorPingItem, [_pingItems copy]);</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//    }</span></span>
<span class="line"><span style="color:#F07178;">      </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">CYPPingItem</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">pingItem</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [[</span><span style="color:#A6ACCD;">CYPPingItem</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">alloc</span><span style="color:#F07178;">] </span><span style="color:#A6ACCD;">init</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">originalAddress</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">address</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">IPAddress</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">pinger</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">IPAddress</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">?:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">pinger</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hostName</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">CYPPingStatusError</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    [</span><span style="color:#A6ACCD;">_pingItems</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">addObject</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">pingItem</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">callbackHandler</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">callbackHandler</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">_pingItems</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">copy</span><span style="color:#F07178;">])</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">end</span></span></code></pre></div><h2 id="使用" tabindex="-1">使用 <a class="header-anchor" href="#使用" aria-label="Permalink to &quot;使用&quot;">​</a></h2><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">pingServices </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [MZPingServices startPingAddress:@</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">www.baidu.com</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> callbackHandler:</span><span style="color:#89DDFF;">^</span><span style="color:#A6ACCD;">(MZPingItem </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> NSArray </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">pingItems) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">pingItem.status != </span><span style="color:#A6ACCD;font-style:italic;">MZPingStatusFinished</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">NSLog</span><span style="color:#F07178;">(@</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">111====%@</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">pingItem</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">description</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;">            </span><span style="color:#676E95;font-style:italic;">// [weakSelf.textView appendText:pingItem.description];</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> else </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">NSString</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">MZPingItem</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">statisticsWithPingItems</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">pingItems</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">NSLog</span><span style="color:#F07178;">(@</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">222====%@</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//      [weakSelf.textView appendText:[STDPingItem statisticsWithPingItems:pingItems]];</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//      [button setTitle:@&quot;Ping&quot; forState:UIControlStateNormal];</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//      button.tag = 10001;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">pingServices</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">nil</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//  self.pingServices.timeoutMilliseconds = 10;</span></span>
<span class="line"><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">pingServices</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">maximumPingTimes </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">20</span><span style="color:#89DDFF;">;</span></span></code></pre></div></div></div></main><footer class="VPDocFooter" data-v-42804bdd data-v-543d3880><!--[--><!--]--><div class="edit-info" data-v-543d3880><!----><div class="last-updated" data-v-543d3880><p class="VPLastUpdated" data-v-543d3880 data-v-a3e2c698>Last updated: <time datetime="2024-01-02T10:25:14.000Z" data-v-a3e2c698></time></p></div></div><nav class="prev-next" data-v-543d3880><div class="pager" data-v-543d3880><a class="pager-link prev" href="/phone/oc/%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7" data-v-543d3880><span class="desc" data-v-543d3880>Previous page</span><span class="title" data-v-543d3880>3、开发实用技巧</span></a></div><div class="pager" data-v-543d3880><a class="pager-link next" href="/phone/swift/" data-v-543d3880><span class="desc" data-v-543d3880>Next page</span><span class="title" data-v-543d3880>Swift</span></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-c6746956 data-v-a21eeca5><div class="container" data-v-a21eeca5><p class="message" data-v-a21eeca5>Released under the MIT License.</p><p class="copyright" data-v-a21eeca5>Copyright © 2023 MZ, All rights reserved.</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"backend_nodejs_实用小工具.md\":\"2b85076d\",\"backend_rust_actix-web.md\":\"c2ff0d35\",\"backend_express_express简介.md\":\"8254e2ae\",\"ai_免费可用ai工具.md\":\"c51aff5d\",\"f2e_css_1px.md\":\"db2bfcb8\",\"ai_ai机器学习.md\":\"543e1462\",\"backend_rust_tauri桌面端应用.md\":\"dcedaed6\",\"f2e_html_index.md\":\"375d20b3\",\"backend_rust_rust进阶.md\":\"2ddf93cc\",\"backend_nodejs_nodejs简介.md\":\"e83fb730\",\"backend_rust_webassembly简介.md\":\"0556757a\",\"backend_nodejs_nodejs_ts.md\":\"e5942a64\",\"tool_efficiency_pnpm-monorepo.md\":\"849329f3\",\"tool_efficiency_pnpm简介.md\":\"a58e0468\",\"tool_site_index.md\":\"3603ffda\",\"tool_vscode_devcontainer容器.md\":\"40ffb0f1\",\"tool_vscode_index.md\":\"e8631bb5\",\"tool_vscode_常用扩展插件.md\":\"cae565cd\",\"backend_rust_常用三方库.md\":\"a9503789\",\"backend_rust_实用工具.md\":\"010d8afa\",\"f2e_vue_nuxt_nuxt3简介.md\":\"932ffe2a\",\"f2e_vue_nuxtjs_nuxtjs简介.md\":\"f88b99b7\",\"serverless_deploy_replit简介.md\":\"a6f662b2\",\"f2e_css_css开发小技巧.md\":\"be4dd777\",\"ai_其他整理.md\":\"817e6db6\",\"backend_rust_开发案例.md\":\"1a65ebf2\",\"backend_nodejs_搭建npm私服.md\":\"5a4f1764\",\"f2e_css_index.md\":\"1efd123c\",\"f2e_bundle_esbuild打包.md\":\"680179b2\",\"f2e_bundle_tsup打包.md\":\"6932f259\",\"f2e_bundle_unbuild打包.md\":\"67223d20\",\"f2e_bundle_vite-plugin简介.md\":\"c7a07a3c\",\"f2e_css_transition和animation动画.md\":\"13724ebb\",\"backend_rust_web框架warp.md\":\"94e213dd\",\"f2e_script_js_xhr简介.md\":\"4b1cc375\",\"f2e_script_js_index.md\":\"ff7dc106\",\"f2e_script_js_开发实用技巧.md\":\"feeb13a9\",\"f2e_script_js_gasp动画库.md\":\"c374fe64\",\"f2e_script_ts_开发实用技巧.md\":\"b3982153\",\"f2e_script_ts_typescript订阅监听.md\":\"84ac7ca4\",\"phone_oc_开发实用技巧.md\":\"f6750367\",\"f2e_script_ts_index.md\":\"31318e79\",\"phone_swift_index.md\":\"9bcfcad9\",\"backend_rust_开发技巧及注意事项.md\":\"7fa92228\",\"serverless_deploy_glitch简介.md\":\"8d90a7fa\",\"f2e_bundle_vite简介.md\":\"42bce718\",\"serverless_deploy_heroku简介.md\":\"a89f83b5\",\"f2e_script_ts_typescript进阶.md\":\"2ab08a0d\",\"serverless_deploy_netlify简介.md\":\"99f94ff3\",\"serverless_deploy_railway简介.md\":\"dc2e0101\",\"serverless_deploy_surge简介.md\":\"e78373b8\",\"serverless_deploy_vercel简介.md\":\"e4b95adb\",\"f2e_bundle_vitest简介.md\":\"0e92b78d\",\"serverless_deploy_zeabur简介.md\":\"0d1dddc5\",\"serverless_deploy_cloudflare简介.md\":\"e3635496\",\"serverless_service_云函数简介.md\":\"8cd0313f\",\"serverless_service_低代码简介.md\":\"64b36ec7\",\"serverless_service_云计算简介.md\":\"5c105eae\",\"serverless_system_docker简介.md\":\"1a7c559d\",\"serverless_system_linux简介.md\":\"b482e26e\",\"serverless_system_linux配置docker环境.md\":\"bea86d32\",\"f2e_vue_petite-vue_简介.md\":\"a41bf15b\",\"f2e_html_webcomponent简介.md\":\"823d2fde\",\"f2e_vue_vue2_vue2基础知识.md\":\"e55ad622\",\"serverless_system_nginx简介.md\":\"aa9c5bf0\",\"serverless_system_nginx配置.md\":\"dd538040\",\"f2e_vue_vue2_vue2高级知识.md\":\"50fd9838\",\"serverless_system_woiden免费vps.md\":\"31d4cce3\",\"f2e_bundle_vite-plugin-mock.md\":\"c5c1bade\",\"f2e_vue_vue2_虚拟列表.md\":\"005cf769\",\"f2e_vue_vue3_mitt事件发布监听.md\":\"ddadd9dc\",\"f2e_bundle_vite-plugin-mini-i18n.md\":\"e23bf23e\",\"f2e_wechat_index.md\":\"c3d60291\",\"tool_efficiency_httpie简介.md\":\"e20df9d1\",\"f2e_vue_vue3_vite-tsx.md\":\"da423a79\",\"f2e_wechat_taro简介.md\":\"314f53da\",\"index.md\":\"96deaf13\",\"phone_oc_index.md\":\"531b2966\",\"tool_efficiency_nvm简介.md\":\"1a6d9b70\",\"f2e_css_选择器.md\":\"953a34e5\",\"tool_efficiency_nrm简介.md\":\"0e64ebe6\",\"phone_oc_wkwebview.md\":\"ef3be742\",\"backend_rust_bracket-lib.md\":\"af8d265b\",\"backend_rust_跨平台框架dioxus.md\":\"a5206c14\",\"backend_express_express_socket.md\":\"e5e8cdca\",\"backend_rust_web框架axum.md\":\"986e1f59\",\"serverless_deploy_render简介.md\":\"0c691a3b\",\"phone_oc_simpleping.md\":\"cf9f3d5e\",\"backend_rust_web框架rocket.md\":\"baa5feac\",\"f2e_vue_vue3_vite.md\":\"0bb2bb83\",\"f2e_vue_vue3_vue3基础知识.md\":\"edabf558\",\"f2e_bundle_vite-postcss插件简介.md\":\"48c62eac\",\"f2e_vue_vue3_vue3_electron简介.md\":\"37753fa5\",\"f2e_vue_vue3_vue3高级知识.md\":\"82b62272\",\"f2e_vue_vue3_vueuse简介.md\":\"be216d04\",\"f2e_harmonyos_index.md\":\"1aa1878f\",\"backend_rust_rust简介.md\":\"a7a449db\",\"f2e_html_简介.md\":\"02b7ab31\",\"f2e_css_media媒体查询.md\":\"b34979e7\",\"serverless_index.md\":\"5ba6f2f2\",\"f2e_bundle_rollup打包.md\":\"50735dc5\",\"f2e_html_canvas简介.md\":\"c5e1f587\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"MZ's 技术指南\",\"description\":\"MZ的技术指南, 记录学习及日常使用\",\"base\":\"/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"siteTitle\":\"MZ's 技术指南\",\"logo\":\"/logo.png\",\"outline\":\"deep\",\"nav\":[{\"text\":\"首页\",\"link\":\"/\"},{\"text\":\"AI\",\"activeMatch\":\"/ai/\",\"items\":[{\"text\":\"免费AI平台\",\"items\":[{\"text\":\"免费可用AI工具\",\"link\":\"/ai/免费可用AI工具\"}]},{\"text\":\"AI机器学习\",\"items\":[{\"text\":\"AI机器学习\",\"link\":\"/ai/AI机器学习\"}]}]},{\"text\":\"移动端\",\"activeMatch\":\"/phone/\",\"items\":[{\"text\":\"Objective-C/C++\",\"items\":[{\"text\":\"Objective-C\",\"link\":\"/phone/oc/\"}]},{\"text\":\"Swift\",\"items\":[{\"text\":\"Swift\",\"link\":\"/phone/swift/\"}]}]},{\"text\":\"前端\",\"activeMatch\":\"/f2e/\",\"items\":[{\"text\":\"前端基础\",\"items\":[{\"text\":\"HTML/HTML5\",\"link\":\"/f2e/html/\"},{\"text\":\"CSS/CSS3\",\"link\":\"/f2e/css/\"},{\"text\":\"JavaScript/TypeScript\",\"link\":\"/f2e/script/js/\"}]},{\"text\":\"前端框架\",\"items\":[{\"text\":\"Vue2/Vue3\",\"link\":\"/f2e/vue/vue3/vue3基础知识.md\"},{\"text\":\"Nuxt3\",\"link\":\"/f2e/vue/nuxt/nuxt3简介.md\"},{\"text\":\"React\",\"link\":\"/f2e/react/\"},{\"text\":\"Svelte\",\"link\":\"/f2e/svelte/\"},{\"text\":\"Solid\",\"link\":\"/f2e/solid/\"},{\"text\":\"微信小程序\",\"link\":\"/f2e/wechat/\"},{\"text\":\"鸿蒙系统\",\"link\":\"/f2e/harmonyOS/\"}]},{\"text\":\"打包工具\",\"items\":[{\"text\":\"unbuild\",\"link\":\"/f2e/bundle/unbuild打包.md\"},{\"text\":\"tsup\",\"link\":\"/f2e/bundle/tsup打包.md\"},{\"text\":\"Vite\",\"link\":\"/f2e/bundle/vite简介.md\"}]}]},{\"text\":\"后端\",\"activeMatch\":\"/backend/\",\"items\":[{\"text\":\"NodeJS\",\"items\":[{\"text\":\"NodeJS\",\"link\":\"/backend/nodejs/nodejs简介.md\"},{\"text\":\"Express\",\"link\":\"/backend/express/express简介.md\"}]},{\"text\":\"Python\",\"items\":[{\"text\":\"Python2/Python3\",\"link\":\"https://gitee.com/geeksdidi\"}]},{\"text\":\"Golang\",\"items\":[{\"text\":\"Gitee\",\"link\":\"https://gitee.com/geeksdidi\"}]},{\"text\":\"Rust\",\"items\":[{\"text\":\"Rust\",\"link\":\"/backend/rust/rust简介.md\"}]}]},{\"text\":\"云服务\",\"activeMatch\":\"/serverless/\",\"items\":[{\"text\":\"云计算\",\"items\":[{\"text\":\"云计算简介\",\"link\":\"/serverless/service/云计算简介\"},{\"text\":\"其他\",\"link\":\"/serverless/service/云函数简介\"}]},{\"text\":\"云部署\",\"items\":[{\"text\":\"Vercel\",\"link\":\"/serverless/deploy/Vercel简介\"},{\"text\":\"Cloudflare\",\"link\":\"/serverless/deploy/cloudflare简介\"},{\"text\":\"其他\",\"link\":\"/serverless/deploy/Replit简介\"}]},{\"text\":\"操作系统|服务器|容器\",\"items\":[{\"text\":\"Linux\",\"link\":\"/serverless/system/linux简介\"},{\"text\":\"Nginx\",\"link\":\"/serverless/system/nginx简介\"}]}]},{\"text\":\"软件工具\",\"activeMatch\":\"/tool/\",\"items\":[{\"text\":\"网站导航\",\"items\":[{\"text\":\"网站导航\",\"link\":\"/tool/site/\"}]},{\"text\":\"编程软件\",\"items\":[{\"text\":\"VSCode\",\"link\":\"/tool/vscode/\"}]},{\"text\":\"效率提升\",\"items\":[{\"text\":\"pnpm\",\"link\":\"/tool/efficiency/pnp简介.md\"},{\"text\":\"nvm\",\"link\":\"/tool/efficiency/nvm简介.md\"},{\"text\":\"nrm\",\"link\":\"/tool/efficiency/nrm简介.md\"}]}]}],\"sidebar\":{\"/ai/\":[{\"text\":\"AI工具\",\"collapsed\":false,\"items\":[{\"text\":\"1、免费可用AI工具整理\",\"link\":\"/ai/免费可用AI工具.md\"},{\"text\":\"2、其他AI整理\",\"link\":\"/ai/其他整理.md\"}]},{\"text\":\"AI机器学习\",\"collapsed\":false,\"items\":[{\"text\":\"1、AI机器学习\",\"link\":\"/ai/AI机器学习.md\"}]}],\"/phone/\":[{\"text\":\"移动端/Objective-C\",\"collapsed\":false,\"items\":[{\"text\":\"1、Objective-C/C++简介\",\"link\":\"/phone/oc/\"},{\"text\":\"2、WKWebView简介\",\"link\":\"/phone/oc/wkwebview.md\"},{\"text\":\"3、开发实用技巧\",\"link\":\"/phone/oc/开发实用技巧.md\"},{\"text\":\"4、SimplePing\",\"link\":\"/phone/oc/simpleping.md\"}]},{\"text\":\"移动端/Swift\",\"collapsed\":false,\"items\":[{\"text\":\"Swift\",\"link\":\"/phone/swift/\"}]}],\"/serverless/service/\":[{\"text\":\"云计算\",\"collapsed\":false,\"items\":[{\"text\":\"1、云计算简介\",\"link\":\"/serverless/service/云计算简介.md\"},{\"text\":\"2、低代码简介\",\"link\":\"/serverless/service/低代码简介.md\"}]},{\"text\":\"云函数\",\"collapsed\":false,\"items\":[{\"text\":\"1、云函数简介\",\"link\":\"/serverless/service/云函数简介.md\"}]}],\"/serverless/system/\":[{\"text\":\"操作系统\",\"collapsed\":false,\"items\":[{\"text\":\"1、Linux简介\",\"link\":\"/serverless/system/linux简介.md\"},{\"text\":\"2、Linux配置Docker环境\",\"link\":\"/serverless/system/linux配置docker环境.md\"}]},{\"text\":\"服务器\",\"collapsed\":false,\"items\":[{\"text\":\"1、Nginx简介\",\"link\":\"/serverless/system/nginx简介.md\"},{\"text\":\"2、Nginx配置.md\",\"link\":\"/serverless/system/nginx配置.md\"},{\"text\":\"3、Woiden免费VPS服务器\",\"link\":\"/serverless/system/woiden免费vps.md\"}]},{\"text\":\"Docker\",\"collapsed\":false,\"items\":[{\"text\":\"1、Docker简介\",\"link\":\"/serverless/system/docker简介.md\"}]}],\"/serverless/deploy/\":[{\"text\":\"三方部署平台\",\"collapsed\":false,\"items\":[{\"text\":\"1、Vercel简介\",\"link\":\"/serverless/deploy/Vercel简介.md\"},{\"text\":\"2、Netlify简介\",\"link\":\"/serverless/deploy/Netlify简介.md\"},{\"text\":\"3、Replit简介\",\"link\":\"/serverless/deploy/Replit简介.md\"},{\"text\":\"4、Surge简介\",\"link\":\"/serverless/deploy/Surge简介.md\"},{\"text\":\"5、Glitch简介\",\"link\":\"/serverless/deploy/Glitch简介.md\"},{\"text\":\"6、Zeabur简介\",\"link\":\"/serverless/deploy/Zeabur简介.md\"},{\"text\":\"7、Render简介\",\"link\":\"/serverless/deploy/Render简介.md\"},{\"text\":\"8、Railway简介\",\"link\":\"/serverless/deploy/Railway简介.md\"},{\"text\":\"9、Heroku简介\",\"link\":\"/serverless/deploy/Heroku简介.md\"}]},{\"text\":\"CDN & DNS\",\"collapsed\":false,\"items\":[{\"text\":\"1、Cloudflare简介\",\"link\":\"/serverless/deploy/cloudflare简介.md\"}]}],\"/f2e/html/\":[{\"text\":\"HTML/HTML5\",\"collapsed\":false,\"items\":[{\"text\":\"1、HTML/HTML5简介\",\"link\":\"/f2e/html/index.md\"},{\"text\":\"2、Canvas简介\",\"link\":\"/f2e/html/canvas简介.md\"},{\"text\":\"3、WebComponent简介\",\"link\":\"/f2e/html/webComponent简介.md\"}]}],\"/f2e/vue/\":[{\"text\":\"Vue3\",\"collapsed\":false,\"items\":[{\"text\":\"1、Vue3基础知识\",\"link\":\"/f2e/vue/vue3/vue3基础知识.md\"},{\"text\":\"2、Vue3高级知识\",\"link\":\"/f2e/vue/vue3/vue3高级知识.md\"},{\"text\":\"3、Vue3+Vite\",\"link\":\"/f2e/vue/vue3/vite.md\"},{\"text\":\"4、Vue3+Vite+TSX\",\"link\":\"/f2e/vue/vue3/vite-tsx.md\"},{\"text\":\"5、Mitt事件发布监听\",\"link\":\"/f2e/vue/vue3/mitt事件发布监听.md\"},{\"text\":\"6、VueUse简介\",\"link\":\"/f2e/vue/vue3/vueUse简介.md\"},{\"text\":\"7、Vue3+Electron简介\",\"link\":\"/f2e/vue/vue3/vue3+electron简介.md\"}]},{\"text\":\"Vue2\",\"collapsed\":false,\"items\":[{\"text\":\"1、Vue2基础知识\",\"link\":\"/f2e/vue/vue2/vue2基础知识.md\"},{\"text\":\"2、Vue2高级知识\",\"link\":\"/f2e/vue/vue2/vue2高级知识.md\"},{\"text\":\"3、虚拟列表\",\"link\":\"/f2e/vue/vue2/虚拟列表.md\"}]},{\"text\":\"Petite-Vue\",\"collapsed\":false,\"items\":[{\"text\":\"1、Petite-Vue简介\",\"link\":\"/f2e/vue/petite-vue/简介.md\"}]},{\"text\":\"Nuxt3\",\"collapsed\":false,\"items\":[{\"text\":\"1、Nuxt简介\",\"link\":\"/f2e/vue/nuxt/nuxt3简介.md\"}]},{\"text\":\"Nuxt.JS\",\"collapsed\":false,\"items\":[{\"text\":\"1、NuxtJS简介\",\"link\":\"/f2e/vue/nuxtjs/nuxtjs简介.md\"}]}],\"/f2e/bundle\":[{\"text\":\"打包工具\",\"collapsed\":false,\"items\":[{\"text\":\"1、unbuild\",\"link\":\"/f2e/bundle/unbuild打包.md\"},{\"text\":\"2、tsup\",\"link\":\"/f2e/bundle/tsup打包.md\"},{\"text\":\"3、rollup\",\"link\":\"/f2e/bundle/rollup打包.md\"},{\"text\":\"4、esbuild\",\"link\":\"/f2e/bundle/esbuild打包.md\"}]},{\"text\":\"Vite\",\"collapsed\":false,\"items\":[{\"text\":\"1、Vite简介\",\"link\":\"/f2e/bundle/vite简介.md\"},{\"text\":\"2、Vite Plugin简介\",\"link\":\"/f2e/bundle/vite-plugin简介.md\"},{\"text\":\"3、Vite-Plugin-Mock简介\",\"link\":\"/f2e/bundle/vite-plugin-mock.md\"},{\"text\":\"4、Vite-Plugin-Mini-I18n简介\",\"link\":\"/f2e/bundle/vite-plugin-mini-i18n.md\"}]},{\"text\":\"Vitest测试框架\",\"collapsed\":false,\"items\":[{\"text\":\"1、Vitest简介\",\"link\":\"/f2e/bundle/vitest简介.md\"}]}],\"/f2e/css/\":[{\"text\":\"CSS/CSS3核心内容\",\"collapsed\":false,\"items\":[{\"text\":\"1、CSS/CSS3简介\",\"link\":\"/f2e/css/index.md\"},{\"text\":\"2、选择器\",\"link\":\"/f2e/css/选择器.md\"},{\"text\":\"3、transition和animation动画\",\"link\":\"/f2e/css/transition和animation动画.md\"},{\"text\":\"4、media媒体查询\",\"link\":\"/f2e/css/media媒体查询.md\"}]},{\"text\":\"CSS/CSS3案例\",\"collapsed\":false,\"items\":[{\"text\":\"1、不同设备展示1px\",\"link\":\"/f2e/css/1px.md\"},{\"text\":\"2、css开发小技巧\",\"link\":\"/f2e/css/css开发小技巧.md\"}]}],\"/f2e/script/\":[{\"text\":\"JavaScript\",\"collapsed\":false,\"items\":[{\"text\":\"1、JavaScript简介\",\"link\":\"/f2e/script/js/index.md\"},{\"text\":\"2、XHR简介\",\"link\":\"/f2e/script/js/xhr简介.md\"},{\"text\":\"3、开发实用技巧\",\"link\":\"/f2e/script/js/开发实用技巧.md\"},{\"text\":\"4、gasp动画库\",\"link\":\"/f2e/script/js/gasp动画库.md\"}]},{\"text\":\"TypeScript\",\"collapsed\":false,\"items\":[{\"text\":\"1、TypeScript简介\",\"link\":\"/f2e/script/ts/index.md\"},{\"text\":\"2、Typescript订阅监听\",\"link\":\"/f2e/script/ts/typescript订阅监听.md\"},{\"text\":\"3、Typescript进阶\",\"link\":\"/f2e/script/ts/typescript进阶.md\"},{\"text\":\"4、Typescript实用开发技巧\",\"link\":\"/f2e/script/ts/开发实用技巧.md\"}]}],\"/f2e/wechat/\":[{\"text\":\"微信小程序\",\"collapsed\":false,\"items\":[{\"text\":\"1、微信小程序简介\",\"link\":\"/f2e/wechat/index.md\"}]},{\"text\":\"Taro\",\"collapsed\":false,\"items\":[{\"text\":\"1、Taro简介\",\"link\":\"/f2e/wechat/taro简介.md\"}]}],\"/f2e/harmonyOS/\":[{\"text\":\"HarmonyOS\",\"collapsed\":false,\"items\":[{\"text\":\"1、鸿蒙OS基础\",\"link\":\"/f2e/harmonyOS/index.md\"}]}],\"/tool/vscode/\":[{\"text\":\"VSCode\",\"collapsed\":false,\"items\":[{\"text\":\"1、VSCode简介\",\"link\":\"/tool/vscode/index.md\"},{\"text\":\"2、常用扩展插件\",\"link\":\"/tool/vscode/常用扩展插件.md\"},{\"text\":\"3、devContainer容器\",\"link\":\"/tool/vscode/devContainer容器.md\"}]}],\"/tool/efficiency/\":[{\"text\":\"终端工具\",\"collapsed\":false,\"items\":[{\"text\":\"1、pnpm简介\",\"link\":\"/tool/efficiency/pnpm简介.md\"},{\"text\":\"2、pnpm monorepo\",\"link\":\"/tool/efficiency/pnpm-monorepo.md\"},{\"text\":\"3、nvm简介\",\"link\":\"/tool/efficiency/nvm简介.md\"},{\"text\":\"4、nrm简介\",\"link\":\"/tool/efficiency/nrm简介.md\"}]}],\"/backend/nodejs/\":[{\"text\":\"NodeJS\",\"collapsed\":false,\"items\":[{\"text\":\"1、NodeJS简介\",\"link\":\"/backend/nodejs/nodejs简介.md\"},{\"text\":\"2、Node + TS简介\",\"link\":\"/backend/nodejs/nodejs+ts.md\"},{\"text\":\"3、搭建npm私服\",\"link\":\"/backend/nodejs/搭建npm私服.md\"},{\"text\":\"4、实用小工具\",\"link\":\"/backend/nodejs/实用小工具.md\"}]}],\"/backend/express/\":[{\"text\":\"Express\",\"collapsed\":false,\"items\":[{\"text\":\"1、Express简介\",\"link\":\"/backend/express/express简介.md\"},{\"text\":\"2、Express+Socket\",\"link\":\"/backend/express/express+socket.md\"}]}],\"/backend/rust/\":[{\"text\":\"Rust\",\"collapsed\":false,\"items\":[{\"text\":\"1、Rust简介\",\"link\":\"/backend/rust/rust简介.md\"},{\"text\":\"2、Rust进阶\",\"link\":\"/backend/rust/rust进阶.md\"},{\"text\":\"3、Rust开发案例\",\"link\":\"/backend/rust/开发案例.md\"},{\"text\":\"4、Rust实用工具\",\"link\":\"/backend/rust/实用工具.md\"},{\"text\":\"5、常用三方库\",\"link\":\"/backend/rust/常用三方库.md\"},{\"text\":\"6、开发技巧及注意事项\",\"link\":\"/backend/rust/开发技巧及注意事项.md\"}]},{\"text\":\"Rust框架\",\"collapsed\":false,\"items\":[{\"text\":\"1、Tauri桌面端应用\",\"link\":\"/backend/rust/tauri桌面端应用.md\"},{\"text\":\"2、web框架actix-web\",\"link\":\"/backend/rust/actix-web.md\"},{\"text\":\"3、web框架rocket\",\"link\":\"/backend/rust/web框架rocket.md\"},{\"text\":\"4、web框架warp\",\"link\":\"/backend/rust/web框架warp.md\"},{\"text\":\"5、web框架axum\",\"link\":\"/backend/rust/web框架axum.md\"},{\"text\":\"6、跨平台框架Dioxus\",\"link\":\"/backend/rust/跨平台框架Dioxus.md\"},{\"text\":\"7、游戏框架bracket-lib\",\"link\":\"/backend/rust/bracket-lib.md\"},{\"text\":\"8、wasm框架\",\"link\":\"/backend/rust/webAssembly简介.md\"}]}]},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/misterZhouZhou\"}],\"footer\":{\"message\":\"Released under the MIT License.\",\"copyright\":\"Copyright © 2023 MZ, All rights reserved.\"},\"search\":{\"provider\":\"local\"}},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":true}");</script>
    
  </body>
</html>