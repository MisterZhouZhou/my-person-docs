<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>常用三方库 | MZ's 技术指南</title>
    <meta name="description" content="MZ的技术指南, 记录学习及日常使用">
    <link rel="preload stylesheet" href="/assets/style.52b03b96.css" as="style">
    
    <script type="module" src="/assets/app.c7ccc2ec.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.28451963.js">
    <link rel="modulepreload" href="/assets/chunks/theme.2cf3bf03.js">
    <link rel="modulepreload" href="/assets/backend_rust_常用三方库.md.a9503789.lean.js">
    <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-c6746956><!--[--><!--]--><!--[--><span tabindex="-1" data-v-70eb73e3></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-70eb73e3> Skip to content </a><!--]--><!----><header class="VPNav" data-v-c6746956 data-v-5de1d602><div class="VPNavBar has-sidebar" data-v-5de1d602 data-v-af9ac95e><div class="container" data-v-af9ac95e><div class="title" data-v-af9ac95e><div class="VPNavBarTitle has-sidebar" data-v-af9ac95e data-v-ab859657><a class="title" href="/" data-v-ab859657><!--[--><!--]--><!--[--><img class="VPImage logo" src="/logo.png" alt data-v-1b586486><!--]--><!--[-->MZ&#39;s 技术指南<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-af9ac95e><div class="curtain" data-v-af9ac95e></div><div class="content-body" data-v-af9ac95e><!--[--><!--]--><div class="VPNavBarSearch search" style="--vp-meta-key:&#39;Meta&#39;;" data-v-af9ac95e><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-af9ac95e data-v-8f5725aa><span id="main-nav-aria-label" class="visually-hidden" data-v-8f5725aa>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-8f5725aa data-v-d8d99116><!--[--><span data-v-d8d99116>首页</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-8f5725aa data-v-6b143405><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6b143405><span class="text" data-v-6b143405><!----><span data-v-6b143405>AI</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6b143405><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6b143405><div class="VPMenu" data-v-6b143405 data-v-3795249a><div class="items" data-v-3795249a><!--[--><!--[--><div class="VPMenuGroup" data-v-3795249a data-v-f066b2dc><p class="title" data-v-f066b2dc>免费AI平台</p><!--[--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/ai/%E5%85%8D%E8%B4%B9%E5%8F%AF%E7%94%A8AI%E5%B7%A5%E5%85%B7" data-v-94ec0290><!--[-->免费可用AI工具<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-3795249a data-v-f066b2dc><p class="title" data-v-f066b2dc>AI机器学习</p><!--[--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/ai/AI%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0" data-v-94ec0290><!--[-->AI机器学习<!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-8f5725aa data-v-6b143405><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6b143405><span class="text" data-v-6b143405><!----><span data-v-6b143405>移动端</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6b143405><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6b143405><div class="VPMenu" data-v-6b143405 data-v-3795249a><div class="items" data-v-3795249a><!--[--><!--[--><div class="VPMenuGroup" data-v-3795249a data-v-f066b2dc><p class="title" data-v-f066b2dc>Objective-C/C++</p><!--[--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/phone/oc/" data-v-94ec0290><!--[-->Objective-C<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-3795249a data-v-f066b2dc><p class="title" data-v-f066b2dc>Swift</p><!--[--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/phone/swift/" data-v-94ec0290><!--[-->Swift<!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-8f5725aa data-v-6b143405><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6b143405><span class="text" data-v-6b143405><!----><span data-v-6b143405>前端</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6b143405><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6b143405><div class="VPMenu" data-v-6b143405 data-v-3795249a><div class="items" data-v-3795249a><!--[--><!--[--><div class="VPMenuGroup" data-v-3795249a data-v-f066b2dc><p class="title" data-v-f066b2dc>前端基础</p><!--[--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/f2e/html/" data-v-94ec0290><!--[-->HTML/HTML5<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/f2e/css/" data-v-94ec0290><!--[-->CSS/CSS3<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/f2e/script/js/" data-v-94ec0290><!--[-->JavaScript/TypeScript<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-3795249a data-v-f066b2dc><p class="title" data-v-f066b2dc>前端框架</p><!--[--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/f2e/vue/vue3/vue3%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86" data-v-94ec0290><!--[-->Vue2/Vue3<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/f2e/vue/nuxt/nuxt3%E7%AE%80%E4%BB%8B" data-v-94ec0290><!--[-->Nuxt3<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/f2e/react/" data-v-94ec0290><!--[-->React<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/f2e/svelte/" data-v-94ec0290><!--[-->Svelte<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/f2e/solid/" data-v-94ec0290><!--[-->Solid<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/f2e/wechat/" data-v-94ec0290><!--[-->微信小程序<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/f2e/harmonyOS/" data-v-94ec0290><!--[-->鸿蒙系统<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-3795249a data-v-f066b2dc><p class="title" data-v-f066b2dc>打包工具</p><!--[--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/f2e/bundle/unbuild%E6%89%93%E5%8C%85" data-v-94ec0290><!--[-->unbuild<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/f2e/bundle/tsup%E6%89%93%E5%8C%85" data-v-94ec0290><!--[-->tsup<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/f2e/bundle/vite%E7%AE%80%E4%BB%8B" data-v-94ec0290><!--[-->Vite<!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup active" data-v-8f5725aa data-v-6b143405><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6b143405><span class="text" data-v-6b143405><!----><span data-v-6b143405>后端</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6b143405><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6b143405><div class="VPMenu" data-v-6b143405 data-v-3795249a><div class="items" data-v-3795249a><!--[--><!--[--><div class="VPMenuGroup" data-v-3795249a data-v-f066b2dc><p class="title" data-v-f066b2dc>NodeJS</p><!--[--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/backend/nodejs/nodejs%E7%AE%80%E4%BB%8B" data-v-94ec0290><!--[-->NodeJS<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/backend/express/express%E7%AE%80%E4%BB%8B" data-v-94ec0290><!--[-->Express<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-3795249a data-v-f066b2dc><p class="title" data-v-f066b2dc>Python</p><!--[--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link vp-external-link-icon" href="https://gitee.com/geeksdidi" target="_blank" rel="noreferrer" data-v-94ec0290><!--[-->Python2/Python3<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-3795249a data-v-f066b2dc><p class="title" data-v-f066b2dc>Golang</p><!--[--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link vp-external-link-icon" href="https://gitee.com/geeksdidi" target="_blank" rel="noreferrer" data-v-94ec0290><!--[-->Gitee<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-3795249a data-v-f066b2dc><p class="title" data-v-f066b2dc>Rust</p><!--[--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/backend/rust/rust%E7%AE%80%E4%BB%8B" data-v-94ec0290><!--[-->Rust<!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-8f5725aa data-v-6b143405><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6b143405><span class="text" data-v-6b143405><!----><span data-v-6b143405>云服务</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6b143405><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6b143405><div class="VPMenu" data-v-6b143405 data-v-3795249a><div class="items" data-v-3795249a><!--[--><!--[--><div class="VPMenuGroup" data-v-3795249a data-v-f066b2dc><p class="title" data-v-f066b2dc>云计算</p><!--[--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/serverless/service/%E4%BA%91%E8%AE%A1%E7%AE%97%E7%AE%80%E4%BB%8B" data-v-94ec0290><!--[-->云计算简介<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/serverless/service/%E4%BA%91%E5%87%BD%E6%95%B0%E7%AE%80%E4%BB%8B" data-v-94ec0290><!--[-->其他<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-3795249a data-v-f066b2dc><p class="title" data-v-f066b2dc>云部署</p><!--[--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/serverless/deploy/Vercel%E7%AE%80%E4%BB%8B" data-v-94ec0290><!--[-->Vercel<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/serverless/deploy/cloudflare%E7%AE%80%E4%BB%8B" data-v-94ec0290><!--[-->Cloudflare<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/serverless/deploy/Replit%E7%AE%80%E4%BB%8B" data-v-94ec0290><!--[-->其他<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-3795249a data-v-f066b2dc><p class="title" data-v-f066b2dc>操作系统|服务器|容器</p><!--[--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/serverless/system/linux%E7%AE%80%E4%BB%8B" data-v-94ec0290><!--[-->Linux<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/serverless/system/nginx%E7%AE%80%E4%BB%8B" data-v-94ec0290><!--[-->Nginx<!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-8f5725aa data-v-6b143405><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6b143405><span class="text" data-v-6b143405><!----><span data-v-6b143405>软件工具</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6b143405><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6b143405><div class="VPMenu" data-v-6b143405 data-v-3795249a><div class="items" data-v-3795249a><!--[--><!--[--><div class="VPMenuGroup" data-v-3795249a data-v-f066b2dc><p class="title" data-v-f066b2dc>网站导航</p><!--[--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/tool/site/" data-v-94ec0290><!--[-->网站导航<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-3795249a data-v-f066b2dc><p class="title" data-v-f066b2dc>编程软件</p><!--[--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/tool/vscode/" data-v-94ec0290><!--[-->VSCode<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-3795249a data-v-f066b2dc><p class="title" data-v-f066b2dc>效率提升</p><!--[--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/tool/efficiency/pnp%E7%AE%80%E4%BB%8B" data-v-94ec0290><!--[-->pnpm<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/tool/efficiency/nvm%E7%AE%80%E4%BB%8B" data-v-94ec0290><!--[-->nvm<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f066b2dc data-v-94ec0290><a class="VPLink link" href="/tool/efficiency/nrm%E7%AE%80%E4%BB%8B" data-v-94ec0290><!--[-->nrm<!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-af9ac95e data-v-7b9909ce><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-7b9909ce data-v-171c4c48 data-v-9b981539><span class="check" data-v-9b981539><span class="icon" data-v-9b981539><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-171c4c48><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-171c4c48><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-af9ac95e data-v-25c50213 data-v-d0e9c8ad><!--[--><a class="VPSocialLink no-icon" href="https://github.com/misterZhouZhou" aria-label="github" target="_blank" rel="noopener" data-v-d0e9c8ad data-v-1ec1e892><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-af9ac95e data-v-e97fd28e data-v-6b143405><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-6b143405><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-6b143405><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-6b143405><div class="VPMenu" data-v-6b143405 data-v-3795249a><!----><!--[--><!--[--><!----><div class="group" data-v-e97fd28e><div class="item appearance" data-v-e97fd28e><p class="label" data-v-e97fd28e>Appearance</p><div class="appearance-action" data-v-e97fd28e><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-e97fd28e data-v-171c4c48 data-v-9b981539><span class="check" data-v-9b981539><span class="icon" data-v-9b981539><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-171c4c48><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-171c4c48><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-e97fd28e><div class="item social-links" data-v-e97fd28e><div class="VPSocialLinks social-links-list" data-v-e97fd28e data-v-d0e9c8ad><!--[--><a class="VPSocialLink no-icon" href="https://github.com/misterZhouZhou" aria-label="github" target="_blank" rel="noopener" data-v-d0e9c8ad data-v-1ec1e892><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-af9ac95e data-v-241ee4cf><span class="container" data-v-241ee4cf><span class="top" data-v-241ee4cf></span><span class="middle" data-v-241ee4cf></span><span class="bottom" data-v-241ee4cf></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav reached-top" data-v-c6746956 data-v-5a57d31a><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-5a57d31a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-5a57d31a><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-5a57d31a>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-5a57d31a data-v-ad7d5a57><button data-v-ad7d5a57>Return to top</button><!----></div></div><aside class="VPSidebar" data-v-c6746956 data-v-aadd12fc><div class="curtain" data-v-aadd12fc></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-aadd12fc><span class="visually-hidden" id="sidebar-aria-label" data-v-aadd12fc> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-aadd12fc><section class="VPSidebarItem level-0 collapsible has-active" data-v-aadd12fc data-v-d3a879f1><div class="item" role="button" tabindex="0" data-v-d3a879f1><div class="indicator" data-v-d3a879f1></div><h2 class="text" data-v-d3a879f1>Rust</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-d3a879f1><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-d3a879f1><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-d3a879f1><!--[--><div class="VPSidebarItem level-1 is-link" data-v-d3a879f1 data-v-d3a879f1><div class="item" data-v-d3a879f1><div class="indicator" data-v-d3a879f1></div><a class="VPLink link link" href="/backend/rust/rust%E7%AE%80%E4%BB%8B" data-v-d3a879f1><!--[--><p class="text" data-v-d3a879f1>1、Rust简介</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d3a879f1 data-v-d3a879f1><div class="item" data-v-d3a879f1><div class="indicator" data-v-d3a879f1></div><a class="VPLink link link" href="/backend/rust/rust%E8%BF%9B%E9%98%B6" data-v-d3a879f1><!--[--><p class="text" data-v-d3a879f1>2、Rust进阶</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d3a879f1 data-v-d3a879f1><div class="item" data-v-d3a879f1><div class="indicator" data-v-d3a879f1></div><a class="VPLink link link" href="/backend/rust/%E5%BC%80%E5%8F%91%E6%A1%88%E4%BE%8B" data-v-d3a879f1><!--[--><p class="text" data-v-d3a879f1>3、Rust开发案例</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d3a879f1 data-v-d3a879f1><div class="item" data-v-d3a879f1><div class="indicator" data-v-d3a879f1></div><a class="VPLink link link" href="/backend/rust/%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7" data-v-d3a879f1><!--[--><p class="text" data-v-d3a879f1>4、Rust实用工具</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d3a879f1 data-v-d3a879f1><div class="item" data-v-d3a879f1><div class="indicator" data-v-d3a879f1></div><a class="VPLink link link" href="/backend/rust/%E5%B8%B8%E7%94%A8%E4%B8%89%E6%96%B9%E5%BA%93" data-v-d3a879f1><!--[--><p class="text" data-v-d3a879f1>5、常用三方库</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d3a879f1 data-v-d3a879f1><div class="item" data-v-d3a879f1><div class="indicator" data-v-d3a879f1></div><a class="VPLink link link" href="/backend/rust/%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7%E5%8F%8A%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9" data-v-d3a879f1><!--[--><p class="text" data-v-d3a879f1>6、开发技巧及注意事项</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-aadd12fc><section class="VPSidebarItem level-0 collapsible" data-v-aadd12fc data-v-d3a879f1><div class="item" role="button" tabindex="0" data-v-d3a879f1><div class="indicator" data-v-d3a879f1></div><h2 class="text" data-v-d3a879f1>Rust框架</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-d3a879f1><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-d3a879f1><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-d3a879f1><!--[--><div class="VPSidebarItem level-1 is-link" data-v-d3a879f1 data-v-d3a879f1><div class="item" data-v-d3a879f1><div class="indicator" data-v-d3a879f1></div><a class="VPLink link link" href="/backend/rust/tauri%E6%A1%8C%E9%9D%A2%E7%AB%AF%E5%BA%94%E7%94%A8" data-v-d3a879f1><!--[--><p class="text" data-v-d3a879f1>1、Tauri桌面端应用</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d3a879f1 data-v-d3a879f1><div class="item" data-v-d3a879f1><div class="indicator" data-v-d3a879f1></div><a class="VPLink link link" href="/backend/rust/actix-web" data-v-d3a879f1><!--[--><p class="text" data-v-d3a879f1>2、web框架actix-web</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d3a879f1 data-v-d3a879f1><div class="item" data-v-d3a879f1><div class="indicator" data-v-d3a879f1></div><a class="VPLink link link" href="/backend/rust/web%E6%A1%86%E6%9E%B6rocket" data-v-d3a879f1><!--[--><p class="text" data-v-d3a879f1>3、web框架rocket</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d3a879f1 data-v-d3a879f1><div class="item" data-v-d3a879f1><div class="indicator" data-v-d3a879f1></div><a class="VPLink link link" href="/backend/rust/web%E6%A1%86%E6%9E%B6warp" data-v-d3a879f1><!--[--><p class="text" data-v-d3a879f1>4、web框架warp</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d3a879f1 data-v-d3a879f1><div class="item" data-v-d3a879f1><div class="indicator" data-v-d3a879f1></div><a class="VPLink link link" href="/backend/rust/web%E6%A1%86%E6%9E%B6axum" data-v-d3a879f1><!--[--><p class="text" data-v-d3a879f1>5、web框架axum</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d3a879f1 data-v-d3a879f1><div class="item" data-v-d3a879f1><div class="indicator" data-v-d3a879f1></div><a class="VPLink link link" href="/backend/rust/%E8%B7%A8%E5%B9%B3%E5%8F%B0%E6%A1%86%E6%9E%B6Dioxus" data-v-d3a879f1><!--[--><p class="text" data-v-d3a879f1>6、跨平台框架Dioxus</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d3a879f1 data-v-d3a879f1><div class="item" data-v-d3a879f1><div class="indicator" data-v-d3a879f1></div><a class="VPLink link link" href="/backend/rust/bracket-lib" data-v-d3a879f1><!--[--><p class="text" data-v-d3a879f1>7、游戏框架bracket-lib</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d3a879f1 data-v-d3a879f1><div class="item" data-v-d3a879f1><div class="indicator" data-v-d3a879f1></div><a class="VPLink link link" href="/backend/rust/webAssembly%E7%AE%80%E4%BB%8B" data-v-d3a879f1><!--[--><p class="text" data-v-d3a879f1>8、wasm框架</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-c6746956 data-v-b368e0f1><div class="VPDoc has-sidebar has-aside" data-v-b368e0f1 data-v-42804bdd><!--[--><!--]--><div class="container" data-v-42804bdd><div class="aside" data-v-42804bdd><div class="aside-curtain" data-v-42804bdd></div><div class="aside-container" data-v-42804bdd><div class="aside-content" data-v-42804bdd><div class="VPDocAside" data-v-42804bdd data-v-a99f0056><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-a99f0056 data-v-82b0686e><div class="content" data-v-82b0686e><div class="outline-marker" data-v-82b0686e></div><div class="outline-title" data-v-82b0686e>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-82b0686e><span class="visually-hidden" id="doc-outline-aria-label" data-v-82b0686e> Table of Contents for current page </span><ul class="root" data-v-82b0686e data-v-6fa36fb1><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-a99f0056></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-42804bdd><div class="content-container" data-v-42804bdd><!--[--><!--]--><!----><main class="main" data-v-42804bdd><div style="position:relative;" class="vp-doc _backend_rust_%E5%B8%B8%E7%94%A8%E4%B8%89%E6%96%B9%E5%BA%93" data-v-42804bdd><div><h1 id="常用三方库" tabindex="-1">常用三方库 <a class="header-anchor" href="#常用三方库" aria-label="Permalink to &quot;常用三方库&quot;">​</a></h1><h2 id="_1、cargo-watch" tabindex="-1">1、cargo-watch <a class="header-anchor" href="#_1、cargo-watch" aria-label="Permalink to &quot;1、cargo-watch&quot;">​</a></h2><h3 id="_1-1、安装" tabindex="-1">1.1、安装 <a class="header-anchor" href="#_1-1、安装" aria-label="Permalink to &quot;1.1、安装&quot;">​</a></h3><p>地址： <a href="https://crates.io/crates/cargo-watch" target="_blank" rel="noreferrer">https://crates.io/crates/cargo-watch</a></p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">cargo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">cargo-watch</span></span></code></pre></div><h3 id="_1-2、使用" tabindex="-1">1.2、使用 <a class="header-anchor" href="#_1-2、使用" aria-label="Permalink to &quot;1.2、使用&quot;">​</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">cargo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">watch</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-q</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-c</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-w</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">src</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-x</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span></span></code></pre></div><h3 id="_1-3、查看帮助" tabindex="-1">1.3、查看帮助 <a class="header-anchor" href="#_1-3、查看帮助" aria-label="Permalink to &quot;1.3、查看帮助&quot;">​</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">cargo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">watch</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--help</span></span></code></pre></div><h2 id="_2、tokio" tabindex="-1">2、tokio <a class="header-anchor" href="#_2、tokio" aria-label="Permalink to &quot;2、tokio&quot;">​</a></h2><h3 id="_2-1、官网" tabindex="-1">2.1、官网 <a class="header-anchor" href="#_2-1、官网" aria-label="Permalink to &quot;2.1、官网&quot;">​</a></h3><p><a href="https://tokio.rs/tokio/tutorial" target="_blank" rel="noreferrer">https://tokio.rs/tokio/tutorial</a></p><h3 id="_2-2、安装" tabindex="-1">2.2、安装 <a class="header-anchor" href="#_2-2、安装" aria-label="Permalink to &quot;2.2、安装&quot;">​</a></h3><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">[dependencies]</span></span>
<span class="line"><span style="color:#A6ACCD;">tokio </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> version </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1.0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> features </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">full</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">] </span><span style="color:#89DDFF;">}</span></span></code></pre></div><h3 id="_2-3、使用" tabindex="-1">2.3、使用 <a class="header-anchor" href="#_2-3、使用" aria-label="Permalink to &quot;2.3、使用&quot;">​</a></h3><h4 id="_2-3-1、async" tabindex="-1">2.3.1、async <a class="header-anchor" href="#_2-3-1、async" aria-label="Permalink to &quot;2.3.1、async&quot;">​</a></h4><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">std</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">future</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:Future</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">time</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:Duration</span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:time</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[tokio::main]</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">h1</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">tokio</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">spawn</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">async</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        println!(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">asnyc1 result: {:?}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> async1</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;">.await);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">        println!(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">asnyc2 result is {}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> async2</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;">.await);</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">_</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">tokio</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">join</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">h1</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">async1</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> String </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">time</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">:</span><span style="color:#82AAFF;">sleep</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">Duration</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">from_secs</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">async1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">to_string</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 与上面写法一致</span></span>
<span class="line"><span style="color:#A6ACCD;">fn </span><span style="color:#82AAFF;">async2</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> impl Future</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">Output </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> String</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    async </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#FFCB6B;">time</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">:</span><span style="color:#82AAFF;">sleep</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">Duration</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">from_secs</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">async2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">to_string</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h4 id="_2-3-2、简单示例" tabindex="-1">2.3.2、简单示例 <a class="header-anchor" href="#_2-3-2、简单示例" aria-label="Permalink to &quot;2.3.2、简单示例&quot;">​</a></h4><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">#[tokio::main]</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">op</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">say_world</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hello world</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">op</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">say_world</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">world</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h4 id="_2-3-3、runtime" tabindex="-1">2.3.3、runtime <a class="header-anchor" href="#_2-3-3、runtime" aria-label="Permalink to &quot;2.3.3、runtime&quot;">​</a></h4><div class="tip custom-block"><p class="custom-block-title">TIP</p><p><code>runtime</code>不能在异步线程中执行</p></div><h5 id="_2-3-3-1、创建runtime" tabindex="-1">2.3.3.1、创建runtime <a class="header-anchor" href="#_2-3-3-1、创建runtime" aria-label="Permalink to &quot;2.3.3.1、创建runtime&quot;">​</a></h5><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:runtime</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">runtime</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">runtime</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">Runtime</span><span style="color:#F07178;">::</span><span style="color:#89DDFF;">new</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">runtime</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">spawn</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">async</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      println!(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">Hello, world!</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">);</span></span>
<span class="line"><span style="color:#F07178;">    });</span></span>
<span class="line"><span style="color:#F07178;">    println!(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">Hello, world!22222</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">);</span></span>
<span class="line"><span style="color:#F07178;">}</span></span></code></pre></div><h5 id="_2-3-2-1、创建带有线程池的runtime" tabindex="-1">2.3.2.1、创建带有线程池的runtime <a class="header-anchor" href="#_2-3-2-1、创建带有线程池的runtime" aria-label="Permalink to &quot;2.3.2.1、创建带有线程池的runtime&quot;">​</a></h5><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:runtime</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">runtime</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">runtime</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">Builder</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">new_multi_thread</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">build</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">for</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">number</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">in</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1..100</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">future</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">async</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">move</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            println!(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">{}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> number);</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">runtime</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">spawn</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">future</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ok</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">runtime</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">spawn</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">async</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">move</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        println!(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">hello</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">);</span></span>
<span class="line"><span style="color:#F07178;">    });</span></span>
<span class="line"><span style="color:#F07178;">}</span></span></code></pre></div><h5 id="_2-3-2-2、future-ready" tabindex="-1">2.3.2.2、future::ready <a class="header-anchor" href="#_2-3-2-2、future-ready" aria-label="Permalink to &quot;2.3.2.2、future::ready&quot;">​</a></h5><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">std</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:future</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:runtime</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">runtime</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">runtime</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">Builder</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">new_multi_thread</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">build</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">join_handle</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">runtime</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">spawn</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">future</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">ready</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">113</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">runtime</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">spawn</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">async</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">move</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        println!(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">{}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> join_handle.await.unwrap());</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h5 id="_2-3-2-3、async-main" tabindex="-1">2.3.2.3、async main <a class="header-anchor" href="#_2-3-2-3、async-main" aria-label="Permalink to &quot;2.3.2.3、async main&quot;">​</a></h5><p>对于main函数，tokio提供了简化的异步运行时创建方式</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">#[tokio::main]</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">{}</span></span></code></pre></div><p>对于注解还有以下方式</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">#[tokio::</span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">(flavor </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">multi_thread</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">] </span><span style="color:#676E95;font-style:italic;">// 等价于#[tokio::main]</span></span>
<span class="line"><span style="color:#A6ACCD;">#[tokio::</span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">(flavor </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">multi_thread</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> worker_threads </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10</span><span style="color:#A6ACCD;">))]</span></span>
<span class="line"><span style="color:#A6ACCD;">#[tokio::</span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">(worker_threads </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10</span><span style="color:#A6ACCD;">))]</span></span></code></pre></div><p>等价于以下代码</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">:</span><span style="color:#FFCB6B;">runtime</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">:</span><span style="color:#FFCB6B;">Builder</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">:</span><span style="color:#82AAFF;">new_multi_thread</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">worker_threads</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">N</span><span style="color:#F07178;">)  </span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">enable_all</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">build</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">block_on</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">async</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">...</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">#[tokio::</span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">(flavor </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">current_thread</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 等价于</span></span>
<span class="line"><span style="color:#A6ACCD;">fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">:</span><span style="color:#FFCB6B;">runtime</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">:</span><span style="color:#FFCB6B;">Builder</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">:</span><span style="color:#82AAFF;">new_current_thread</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">enable_all</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">build</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">block_on</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">async</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">...</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h4 id="_2-3-4、asyncread" tabindex="-1">2.3.4、AsyncRead <a class="header-anchor" href="#_2-3-4、asyncread" aria-label="Permalink to &quot;2.3.4、AsyncRead&quot;">​</a></h4><h5 id="_2-3-4-1、-lines-按行读" tabindex="-1">2.3.4.1、 lines 按行读 <a class="header-anchor" href="#_2-3-4-1、-lines-按行读" aria-label="Permalink to &quot;2.3.4.1、 lines 按行读&quot;">​</a></h5><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">fs</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">io</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> AsyncBufReadExt</span><span style="color:#89DDFF;">}};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[tokio::main]</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> Result</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Box</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">dyn </span><span style="color:#FFCB6B;">std</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#FFCB6B;">error</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:Error</span><span style="color:#89DDFF;">&gt;&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    let file </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> fs::File::</span><span style="color:#82AAFF;">open</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Cargo.toml</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    let mut buf_reader </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> io</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:BufReader::</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;">(file)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">lines</span><span style="color:#A6ACCD;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">    while let </span><span style="color:#F07178;">Some</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">line</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = buf_reader.</span><span style="color:#F07178;">next_line</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">.await? </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">{}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">line</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">Ok</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h5 id="_2-3-4-2、-read-line-按行读" tabindex="-1">2.3.4.2、 read_line 按行读 <a class="header-anchor" href="#_2-3-4-2、-read-line-按行读" aria-label="Permalink to &quot;2.3.4.2、 read_line 按行读&quot;">​</a></h5><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">fs</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">io</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> AsyncBufReadExt</span><span style="color:#89DDFF;">}};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[tokio::main]</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> Result</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Box</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">dyn </span><span style="color:#FFCB6B;">std</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#FFCB6B;">error</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:Error</span><span style="color:#89DDFF;">&gt;&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    let file </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> fs::File::</span><span style="color:#82AAFF;">open</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Cargo.toml</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    let mut buf_reader </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> io</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:BufReader::</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;">(file);</span></span>
<span class="line"><span style="color:#A6ACCD;">    let mut contents </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> String::</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">    while let </span><span style="color:#F07178;">Ok</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">n</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = buf_reader.</span><span style="color:#F07178;">read_line</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">&amp;</span><span style="color:#A6ACCD;font-style:italic;">mut</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">contents</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">.await </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">{}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">contents</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">contents</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">clear</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">Ok</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h5 id="_2-3-4-3、read-按字节覆盖读取" tabindex="-1">2.3.4.3、read 按字节覆盖读取 <a class="header-anchor" href="#_2-3-4-3、read-按字节覆盖读取" aria-label="Permalink to &quot;2.3.4.3、read 按字节覆盖读取&quot;">​</a></h5><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">fs</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:File</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">io</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:AsyncReadExt</span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[tokio::main]</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> f </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">File</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">open</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Cargo.toml</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> buf </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">; </span><span style="color:#F78C6C;">5</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">f</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">read</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">buf</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">str</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">std</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">str</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">from_utf8</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">buf</span><span style="color:#F07178;">[</span><span style="color:#89DDFF;">..</span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;">])</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">{}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">str</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">f</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">read</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">buf</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">str</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">std</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">str</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">from_utf8</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">buf</span><span style="color:#F07178;">[</span><span style="color:#89DDFF;">..</span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;">])</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">{}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">str</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h5 id="_2-3-4-4、read-buf-按字节追加读取" tabindex="-1">2.3.4.4、read_buf 按字节追加读取 <a class="header-anchor" href="#_2-3-4-4、read-buf-按字节追加读取" aria-label="Permalink to &quot;2.3.4.4、read_buf 按字节追加读取&quot;">​</a></h5><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">bytes</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:BytesMut</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">fs</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:File</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">io</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:AsyncReadExt</span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[tokio::main]</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> f </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">File</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">open</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Cargo.toml</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> buf </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">BytesMut</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">with_capacity</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">5</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 第一次读取，读取容量大小的数据，即4字节数据，</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 此时BytesMut内部的位移指针在offset = 3处</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">f</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">read_buf</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">buf</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">str</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">std</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">str</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">from_utf8</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">buf</span><span style="color:#F07178;">[</span><span style="color:#89DDFF;">..</span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;">])</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">{}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">str</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 第二次读取，因buf已满，这次将一次性读取剩余所有数据(只请求一次读系统调用)，</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// BytesMut也将自动扩容以便存放更多数据，且可能会根据所读数据的多少进行多次扩容，</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 所读数据都将从index=4处开始追加保存, 遇到空行会终止</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">f</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">read_buf</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">buf</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">str</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">std</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">str</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">from_utf8</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">buf</span><span style="color:#F07178;">[</span><span style="color:#89DDFF;">..</span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;">])</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">{}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">str</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h5 id="_2-3-4-5、read-exact" tabindex="-1">2.3.4.5、read_exact <a class="header-anchor" href="#_2-3-4-5、read-exact" aria-label="Permalink to &quot;2.3.4.5、read_exact&quot;">​</a></h5><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>读取超出容量会报错</p></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">fs</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:File</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">io</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:AsyncReadExt</span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[tokio::main]</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> f </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">File</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">open</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Cargo.toml</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> buf </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">; </span><span style="color:#F78C6C;">1024</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">f</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">read_exact</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">buf</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">first read {} bytes: {:?}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">n</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">std</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">str</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">from_utf8</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">buf</span><span style="color:#F07178;">[</span><span style="color:#89DDFF;">..</span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;">]))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h5 id="_2-3-4-6、read-to-string" tabindex="-1">2.3.4.6、read_to_string <a class="header-anchor" href="#_2-3-4-6、read-to-string" aria-label="Permalink to &quot;2.3.4.6、read_to_string&quot;">​</a></h5><h5 id="_2-3-4-7、read-to-end" tabindex="-1">2.3.4.7、read_to_end <a class="header-anchor" href="#_2-3-4-7、read-to-end" aria-label="Permalink to &quot;2.3.4.7、read_to_end&quot;">​</a></h5><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">fs</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:File</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">io</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:AsyncReadExt</span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[tokio::main]</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> f </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">File</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">open</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Cargo.toml</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> buf</span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;">Vec</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">u8</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Vec</span><span style="color:#F07178;">::</span><span style="color:#89DDFF;">new</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">f</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">read_to_end</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">buf</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">str</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">std</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">str</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">from_utf8</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">buf</span><span style="color:#F07178;">[</span><span style="color:#89DDFF;">..</span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;">])</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">first read {} bytes: {:?}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">n</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">str</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h5 id="_2-3-4-8、take" tabindex="-1">2.3.4.8、take <a class="header-anchor" href="#_2-3-4-8、take" aria-label="Permalink to &quot;2.3.4.8、take&quot;">​</a></h5><div class="tip custom-block"><p class="custom-block-title">TIP</p><p><code>take</code>限制最多读取的字节数</p></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">fs</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:File</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">io</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:AsyncReadExt</span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[tokio::main]</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">f</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">File</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">open</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Cargo.toml</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> t </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">f</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">take</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">5</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> buf </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">; </span><span style="color:#F78C6C;">2</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">t</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">read</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">buf</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">{:?}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">std</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">str</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">from_utf8</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">buf</span><span style="color:#F07178;">[</span><span style="color:#89DDFF;">..</span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;">]))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> buf </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">; </span><span style="color:#F78C6C;">3</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">t</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">read</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">buf</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">{:?}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">std</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">str</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">from_utf8</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">buf</span><span style="color:#F07178;">[</span><span style="color:#89DDFF;">..</span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;">]))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> buf </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">; </span><span style="color:#F78C6C;">1024</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">t</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">set_limit</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">100</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">t</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">read</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">buf</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">{:?}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">std</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">str</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">from_utf8</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">buf</span><span style="color:#F07178;">[</span><span style="color:#89DDFF;">..</span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;">]))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">t</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">read</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">buf</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">{:?}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">std</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">str</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">from_utf8</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">buf</span><span style="color:#F07178;">[</span><span style="color:#89DDFF;">..</span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;">]))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h5 id="_2-3-4-9、chain" tabindex="-1">2.3.4.9、chain <a class="header-anchor" href="#_2-3-4-9、chain" aria-label="Permalink to &quot;2.3.4.9、chain&quot;">​</a></h5><div class="tip custom-block"><p class="custom-block-title">TIP</p><p><code>chain</code>可将两个<code>Reader</code>串联起来(可多次串联)</p></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">fs</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:File</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">io</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:AsyncReadExt</span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[tokio::main]</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">f</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">File</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">open</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">a.txt</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">f2</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">File</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">open</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">b.txt</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> t </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">f</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">chain</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">f2</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> buf </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">; </span><span style="color:#F78C6C;">20</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">t</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">read</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">buf</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">{:?}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">std</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">str</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">from_utf8</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">buf</span><span style="color:#F07178;">[</span><span style="color:#89DDFF;">..</span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;">]))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">t</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">read</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">buf</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">{:?}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">std</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">str</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">from_utf8</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">buf</span><span style="color:#F07178;">[</span><span style="color:#89DDFF;">..</span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;">]))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h5 id="_2-3-4-10、split-指定分隔符" tabindex="-1">2.3.4.10、split(指定分隔符) <a class="header-anchor" href="#_2-3-4-10、split-指定分隔符" aria-label="Permalink to &quot;2.3.4.10、split(指定分隔符)&quot;">​</a></h5><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">fs</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:File</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">io</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">AsyncBufReadExt</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> self</span><span style="color:#89DDFF;">}};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[tokio::main]</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">f</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">File</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">open</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">a.txt</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> lines </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">io</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">BufReader</span><span style="color:#F07178;">::</span><span style="color:#89DDFF;">new</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">f</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">split</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">b</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">\n</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Some</span><span style="color:#F07178;">(line) </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">lines</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">next_segment</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        println!(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">read line: {}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> String</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">:</span><span style="color:#82AAFF;">from_utf8</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">line</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">());</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h5 id="_2-3-4-11、read-until-读到停止" tabindex="-1">2.3.4.11、read_until(读到停止) <a class="header-anchor" href="#_2-3-4-11、read-until-读到停止" aria-label="Permalink to &quot;2.3.4.11、read_until(读到停止)&quot;">​</a></h5><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">fs</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:File</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">io</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">AsyncBufReadExt</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> self</span><span style="color:#89DDFF;">}};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[tokio::main]</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">f</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">File</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">open</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">a.txt</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> f </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">io</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">BufReader</span><span style="color:#F07178;">::</span><span style="color:#89DDFF;">new</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">f</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> data</span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;">Vec</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">u8</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Vec</span><span style="color:#F07178;">::</span><span style="color:#89DDFF;">new</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">f</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">read_until</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">b</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">\n</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">first line: {}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">String</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">from_utf8</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">())</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h4 id="_2-3-5、asyncwrite" tabindex="-1">2.3.5、AsyncWrite <a class="header-anchor" href="#_2-3-5、asyncwrite" aria-label="Permalink to &quot;2.3.5、AsyncWrite&quot;">​</a></h4><h5 id="_2-3-5-1、write-all" tabindex="-1">2.3.5.1、write_all <a class="header-anchor" href="#_2-3-5-1、write-all" aria-label="Permalink to &quot;2.3.5.1、write_all&quot;">​</a></h5><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#FFCB6B;">fs</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:File</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#FFCB6B;">io</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> AsyncWriteExt</span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[tokio::main]</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">io</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:Result</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    let mut file </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> File::</span><span style="color:#82AAFF;">create</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">test.txt</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    let buffer </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> b</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Hello, world!</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    file</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">write_all</span><span style="color:#A6ACCD;">(buffer)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">Ok</span><span style="color:#A6ACCD;">(())</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre></div><h5 id="_2-3-5-2、write" tabindex="-1">2.3.5.2、write <a class="header-anchor" href="#_2-3-5-2、write" aria-label="Permalink to &quot;2.3.5.2、write&quot;">​</a></h5><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#FFCB6B;">fs</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:File</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#FFCB6B;">io</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> AsyncWriteExt</span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[tokio::main]</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">io</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:Result</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    let mut file </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> File::</span><span style="color:#82AAFF;">create</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">test.txt</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    file</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">write</span><span style="color:#A6ACCD;">(b</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Hello, world!</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">Ok</span><span style="color:#A6ACCD;">(())</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre></div><h4 id="_2-3-6、tokio-spawn" tabindex="-1">2.3.6、tokio::spawn <a class="header-anchor" href="#_2-3-6、tokio-spawn" aria-label="Permalink to &quot;2.3.6、tokio::spawn&quot;">​</a></h4><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">std</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#FFCB6B;">time</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:Duration</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#FFCB6B;">time</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">sleep_until</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Instant</span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[tokio::main]</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#FFCB6B;">io</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:Result</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    let handle </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> tokio::</span><span style="color:#82AAFF;">spawn</span><span style="color:#A6ACCD;">(async </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">sleep_until</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">Instant</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">now</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> + </span><span style="color:#FFCB6B;">Duration</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">from_secs</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">.await;</span></span>
<span class="line"><span style="color:#A6ACCD;">        println!(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">hello</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">);</span></span>
<span class="line"><span style="color:#F07178;">    });</span></span>
<span class="line"><span style="color:#F07178;">    println!(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">----</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">);</span></span>
<span class="line"><span style="color:#F07178;">    let _ = handle.await;</span></span>
<span class="line"><span style="color:#F07178;">}</span></span></code></pre></div><h4 id="_2-3-7、tcplistener" tabindex="-1">2.3.7、TcpListener <a class="header-anchor" href="#_2-3-7、tcplistener" aria-label="Permalink to &quot;2.3.7、TcpListener&quot;">​</a></h4><h5 id="_2-3-7-1、server-client" tabindex="-1">2.3.7.1、Server Client <a class="header-anchor" href="#_2-3-7-1、server-client" aria-label="Permalink to &quot;2.3.7.1、Server Client&quot;">​</a></h5><p>server</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">net</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">TcpListener</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> TcpStream</span><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">io</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">AsyncWriteExt</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> AsyncReadExt</span><span style="color:#89DDFF;">}};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[tokio::main]</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> Result</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Box</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">dyn </span><span style="color:#FFCB6B;">std</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#FFCB6B;">error</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:Error</span><span style="color:#89DDFF;">&gt;&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    let addr </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">127.0.0.1:4000</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    let listener </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> TcpListener::</span><span style="color:#82AAFF;">bind</span><span style="color:#A6ACCD;">(addr)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Listening on: {}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> addr);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    loop </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">let</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">stream</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">_</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = listener.</span><span style="color:#F07178;">accept</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">.await?;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#82AAFF;">spawn</span><span style="color:#A6ACCD;">(async move </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            if let </span><span style="color:#F07178;">Err</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">e</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = </span><span style="color:#F07178;">handle_client</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">stream</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">.await </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#82AAFF;">eprintln</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Error: {}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">e</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">handle_client</span><span style="color:#A6ACCD;">(mut stream: TcpStream) </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> Result</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Box</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">dyn std</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:error::Error</span><span style="color:#89DDFF;">&gt;&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    println!(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">new client connected</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    let mut buf = [0; 1024];</span></span>
<span class="line"><span style="color:#F07178;">    stream.write_all(b</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">Welcome to the PingPong server!</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">).await?;</span></span>
<span class="line"><span style="color:#F07178;">    loop {</span></span>
<span class="line"><span style="color:#F07178;">        let n = stream.read(&amp;mut buf).await?;</span></span>
<span class="line"><span style="color:#F07178;">        if n == 0 {</span></span>
<span class="line"><span style="color:#F07178;">            break;</span></span>
<span class="line"><span style="color:#F07178;">        }</span></span>
<span class="line"><span style="color:#F07178;">        stream.write_all(b</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">Pong</span><span style="color:#A6ACCD;">\n</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">).await?;</span></span>
<span class="line"><span style="color:#F07178;">    }</span></span>
<span class="line"><span style="color:#F07178;">    println!(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">client disconnected</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">);</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    Ok(())</span></span>
<span class="line"><span style="color:#F07178;">}</span></span></code></pre></div><p>client</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">net</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:TcpStream</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">io</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">AsyncWriteExt</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> AsyncReadExt</span><span style="color:#89DDFF;">}};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[tokio::main]</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> Result</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Box</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">dyn </span><span style="color:#FFCB6B;">std</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#FFCB6B;">error</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:Error</span><span style="color:#89DDFF;">&gt;&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">connect</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">.await?;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">Ok</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">connect</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> Result</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Box</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">dyn </span><span style="color:#FFCB6B;">std</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#FFCB6B;">error</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:Error</span><span style="color:#89DDFF;">&gt;&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    let addr </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">127.0.0.1:4000</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    let mut stream </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> TcpStream::</span><span style="color:#82AAFF;">connect</span><span style="color:#A6ACCD;">(addr)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Connected to: {}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> addr);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    let mut buf </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">; </span><span style="color:#F78C6C;">1024</span><span style="color:#A6ACCD;">];</span></span>
<span class="line"><span style="color:#A6ACCD;">    stream</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">write_all</span><span style="color:#A6ACCD;">(b</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Ping</span><span style="color:#A6ACCD;">\n</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// loop {</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//     let n = stream.read(&amp;mut buf).await?;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//     if n == 0 {</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//         break;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//     }</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//     let pong = std::str::from_utf8(&amp;buf[..n])?;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//     println!(&quot;11--client: {}&quot;, pong);</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    let n </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> stream</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">read</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">mut buf)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    let pong </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> std</span><span style="color:#89DDFF;">::</span><span style="color:#A6ACCD;">str</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#82AAFF;">from_utf8</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">buf[</span><span style="color:#89DDFF;">..</span><span style="color:#A6ACCD;">n])</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">--{}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> pong);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">Ok</span><span style="color:#A6ACCD;">(())</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre></div><h5 id="_2-3-7-2、server-mspc-channel" tabindex="-1">2.3.7.2、Server mspc::Channel <a class="header-anchor" href="#_2-3-7-2、server-mspc-channel" aria-label="Permalink to &quot;2.3.7.2、Server mspc::Channel&quot;">​</a></h5><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">net</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">TcpListener</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> TcpStream</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">tcp</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">OwnedReadHalf</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> OwnedWriteHalf</span><span style="color:#89DDFF;">}},</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">sync</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:mpsc</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">io</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> AsyncBufReadExt</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> AsyncWriteExt</span><span style="color:#89DDFF;">}};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[tokio::main]</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> Result</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Box</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">dyn </span><span style="color:#FFCB6B;">std</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#FFCB6B;">error</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:Error</span><span style="color:#89DDFF;">&gt;&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    let server </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> TcpListener::</span><span style="color:#82AAFF;">bind</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">127.0.0.1:4000</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Listening on: {}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> server</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">local_addr</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    while let </span><span style="color:#82AAFF;">Ok</span><span style="color:#A6ACCD;">((stream</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> _)) </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> server</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">accept</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#82AAFF;">spawn</span><span style="color:#A6ACCD;">(async move </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            if let </span><span style="color:#F07178;">Err</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">e</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = </span><span style="color:#F07178;">handle_client</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">stream</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">.await </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#82AAFF;">eprintln</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Error: {}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">e</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">Ok</span><span style="color:#A6ACCD;">(())</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">handle_client</span><span style="color:#A6ACCD;">(client: TcpStream) </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> Result</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Box</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">dyn std</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:error::Error</span><span style="color:#89DDFF;">&gt;&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    println!(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">new client connected</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">);</span></span>
<span class="line"><span style="color:#F07178;">    let (client_reader, client_writer) = client.into_split();</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 创建消息通道</span></span>
<span class="line"><span style="color:#F07178;">    let (msg_tx, msg_rx) = mpsc</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:channel::</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">(100);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    // 从客户端读取异步任务</span></span>
<span class="line"><span style="color:#A6ACCD;">    let mut read_task = tokio::spawn(async move </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">read_from_client</span><span style="color:#A6ACCD;">(client_reader</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> msg_tx)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    // 向客户端写入异步任务</span></span>
<span class="line"><span style="color:#A6ACCD;">    let mut write_task = tokio::spawn(async move </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">write_from_client</span><span style="color:#A6ACCD;">(client_writer</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> msg_rx)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    if tokio::try_join!(&amp;mut read_task, &amp;mut write_task).is_err() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">eprintln</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">read_task/write_task terminated</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        read_task</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">abort</span><span style="color:#A6ACCD;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        write_task</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">abort</span><span style="color:#A6ACCD;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    Ok(())</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">// 从客户端读</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn read_from_client(reader: OwnedReadHalf, msg_tx: mpsc::Sender</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    let mut buf_reader </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> io::BufReader::</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;">(reader);</span></span>
<span class="line"><span style="color:#A6ACCD;">    let mut buf </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> String::</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">    loop </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        match buf_reader.read_line(&amp;mut buf).await </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#82AAFF;">Err</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">_</span><span style="color:#F07178;">) </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#82AAFF;">eprintln</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">read from client error</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;font-style:italic;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#82AAFF;">Ok</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">) </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">client closed</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;font-style:italic;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#82AAFF;">Ok</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;">) </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#A6ACCD;">buf</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">pop</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">content</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">buf</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">drain</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">..</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">as_str</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">to_string</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">read {} bytes from client. content: {}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">n</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">content</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">msg_tx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">content</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">is_err</span><span style="color:#F07178;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                  </span><span style="color:#82AAFF;">eprintln</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">receiver closed</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                  </span><span style="color:#89DDFF;font-style:italic;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">// 給客户端写</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn write_from_client(writer: OwnedWriteHalf, mut msg_rx: mpsc::Receiver</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    let mut buf_writer </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> io::BufWriter::</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;">(writer);</span></span>
<span class="line"><span style="color:#A6ACCD;">    while let </span><span style="color:#82AAFF;">Some</span><span style="color:#A6ACCD;">(mut msg) </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> msg_rx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">recv</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        println!(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">writer to client: {}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> msg);</span></span>
<span class="line"><span style="color:#A6ACCD;">        msg.push(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">\n</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">);</span></span>
<span class="line"><span style="color:#F07178;">        if let Err(e) = buf_writer.write_all(msg.as_bytes()).await {</span></span>
<span class="line"><span style="color:#F07178;">            eprintln!(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">write to client failed: {}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> e);</span></span>
<span class="line"><span style="color:#A6ACCD;">            break;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        if let </span><span style="color:#82AAFF;">Err</span><span style="color:#A6ACCD;">(e) </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> buf_writer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">flush</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            eprintln!(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">flush to client failed: {}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> e);</span></span>
<span class="line"><span style="color:#A6ACCD;">            break;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre></div><h4 id="_2-3-8、timer" tabindex="-1">2.3.8、Timer <a class="header-anchor" href="#_2-3-8、timer" aria-label="Permalink to &quot;2.3.8、Timer&quot;">​</a></h4><h5 id="_2-3-8-1、时间点-time-instant" tabindex="-1">2.3.8.1、时间点 time::Instant <a class="header-anchor" href="#_2-3-8-1、时间点-time-instant" aria-label="Permalink to &quot;2.3.8.1、时间点 time::Instant&quot;">​</a></h5><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> now </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> tokio::time::Instant::</span><span style="color:#82AAFF;">now</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> next_3 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> now </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> tokio::time::Duration::</span><span style="color:#82AAFF;">from_secs</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><h5 id="_2-3-8-2、睡眠-time-sleep" tabindex="-1">2.3.8.2、睡眠 time::Sleep <a class="header-anchor" href="#_2-3-8-2、睡眠-time-sleep" aria-label="Permalink to &quot;2.3.8.2、睡眠 time::Sleep&quot;">​</a></h5><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 睡眠2秒</span></span>
<span class="line"><span style="color:#FFCB6B;">time</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#82AAFF;">sleep</span><span style="color:#A6ACCD;">(time::Duration::</span><span style="color:#82AAFF;">from_secs</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 一直睡眠，睡到2秒后醒来</span></span>
<span class="line"><span style="color:#FFCB6B;">time</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#82AAFF;">sleep_until</span><span style="color:#A6ACCD;">(time::Instant::</span><span style="color:#82AAFF;">now</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> time::Duration::</span><span style="color:#82AAFF;">from_secs</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>获取当前时间</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> start </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> time::Instant::</span><span style="color:#82AAFF;">now</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#FFCB6B;">time</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#82AAFF;">sleep</span><span style="color:#A6ACCD;">(time::Duration::</span><span style="color:#82AAFF;">from_micros</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">10</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">sleep {}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> time::Instant::</span><span style="color:#82AAFF;">now</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">duration_since</span><span style="color:#A6ACCD;">(start)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">as_nanos</span><span style="color:#A6ACCD;">())</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>重置休眠时间</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">start: {}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">now</span><span style="color:#A6ACCD;">())</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> slp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> time::</span><span style="color:#82AAFF;">sleep</span><span style="color:#A6ACCD;">(time::Duration::</span><span style="color:#82AAFF;">from_secs</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#FFCB6B;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#82AAFF;">pin</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">(slp)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">slp</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">as_mut</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">reset</span><span style="color:#A6ACCD;">(time::Instant::</span><span style="color:#82AAFF;">now</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> time::Duration::</span><span style="color:#82AAFF;">from_secs</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">slp</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">end: {}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">now</span><span style="color:#A6ACCD;">())</span><span style="color:#89DDFF;">;</span></span></code></pre></div><h5 id="_2-3-8-3、任务超时-time-timeout" tabindex="-1">2.3.8.3、任务超时 time::Timeout <a class="header-anchor" href="#_2-3-8-3、任务超时-time-timeout" aria-label="Permalink to &quot;2.3.8.3、任务超时 time::Timeout&quot;">​</a></h5><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> res </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> time::</span><span style="color:#82AAFF;">timeout</span><span style="color:#A6ACCD;">(time::Duration::</span><span style="color:#82AAFF;">from_secs</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">5</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> async </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    println!(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">sleeping: {}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">now</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">time</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#82AAFF;">sleep</span><span style="color:#A6ACCD;">(time::Duration::</span><span style="color:#82AAFF;">from_secs</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">6</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">33</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">match res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">Err</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">_</span><span style="color:#F07178;">) </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">task timeout: {}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">now</span><span style="color:#F07178;">())</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">Ok</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">) </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">get the res &#39;{}&#39;: {}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">now</span><span style="color:#F07178;">())</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span></code></pre></div><h5 id="_2-3-8-4、间隔任务-time-interval" tabindex="-1">2.3.8.4、间隔任务 time::Interval <a class="header-anchor" href="#_2-3-8-4、间隔任务-time-interval" aria-label="Permalink to &quot;2.3.8.4、间隔任务 time::Interval&quot;">​</a></h5><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">before: {}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">now</span><span style="color:#A6ACCD;">())</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> start </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> tokio::time::Instant::</span><span style="color:#82AAFF;">now</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> tokio::time::Duration::</span><span style="color:#82AAFF;">from_secs</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">5</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> mut int_v </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> tokio::time::</span><span style="color:#82AAFF;">interval_at</span><span style="color:#A6ACCD;">(start</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> tokio::time::Duration::</span><span style="color:#82AAFF;">from_secs</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 任务阻塞，5秒后被唤醒</span></span>
<span class="line"><span style="color:#A6ACCD;">int_v</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">tick</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">task 1: {}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">now</span><span style="color:#A6ACCD;">())</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 该计时任务&quot;阻塞&quot;，直到1秒后被唤醒</span></span>
<span class="line"><span style="color:#A6ACCD;">int_v</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">tick</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">task 2: {}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">now</span><span style="color:#A6ACCD;">())</span><span style="color:#89DDFF;">;</span></span></code></pre></div><h4 id="_2-3-9、task的通信和同步" tabindex="-1">2.3.9、task的通信和同步 <a class="header-anchor" href="#_2-3-9、task的通信和同步" aria-label="Permalink to &quot;2.3.9、task的通信和同步&quot;">​</a></h4><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>tokio提供几种不同功能的通道：</p><ul><li>oneshot通道: 一对一发送的一次性通道，即该通道只能由一个发送者(Sender)发送最多一个数据，且只有一个接收者(Receiver)接收数据</li><li>mpsc通道: 多对一发送，即该通道可以同时有多个发送者向该通道发数据，但只有一个接收者接收数据</li><li>broadcast通道: 多对多发送，即该通道可以同时有多个发送者向该通道发送数据，也可以有多个接收者接收数据</li><li>watch通道: 一对多发送，即该通道只能有一个发送者向该通道发送数据，但可以有多个接收者接收数据</li></ul></div><h5 id="_2-3-9-1、oneshot" tabindex="-1">2.3.9.1、oneshot <a class="header-anchor" href="#_2-3-9-1、oneshot" aria-label="Permalink to &quot;2.3.9.1、oneshot&quot;">​</a></h5><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 1对1</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> (tx</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> rx) </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> sync::oneshot::</span><span style="color:#82AAFF;">channel</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#FFCB6B;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#82AAFF;">spawn</span><span style="color:#A6ACCD;">(async move </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    if tx.send(</span><span style="color:#F78C6C;">33</span><span style="color:#F07178;">).is_err</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">receiver dropped</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">match rx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">Ok</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;">) </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">received {}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">Err</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">_</span><span style="color:#F07178;">) </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">receiver dropped</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h5 id="_2-3-9-2、mpsc" tabindex="-1">2.3.9.2、mpsc <a class="header-anchor" href="#_2-3-9-2、mpsc" aria-label="Permalink to &quot;2.3.9.2、mpsc&quot;">​</a></h5><p>一个异步</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> (tx</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> mut rx) </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> sync::mpsc::channel::</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">i32</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">(10);</span></span>
<span class="line"><span style="color:#A6ACCD;">tokio::spawn(async move </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    for i </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1.</span><span style="color:#89DDFF;">.=</span><span style="color:#F78C6C;">10</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        if tx.send(i).await.is_err() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">receiver closed</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">while let Some(i) = rx.recv().await </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">received: {}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> i);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>多个异步</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> (tx</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> mut rx) </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> sync::mpsc::channel::</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">i32</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">(10);</span></span>
<span class="line"><span style="color:#A6ACCD;">for i in 1..=10 </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    let tx </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> tx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">clone</span><span style="color:#A6ACCD;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">    tokio::</span><span style="color:#82AAFF;">spawn</span><span style="color:#A6ACCD;">(async move </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        if tx.send(i).await.is_err() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">receiver closed</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">drop(tx);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">while let Some(i) = rx.recv().await </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">received: {}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> i);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h5 id="_2-3-9-3、broadcast" tabindex="-1">2.3.9.3、broadcast <a class="header-anchor" href="#_2-3-9-3、broadcast" aria-label="Permalink to &quot;2.3.9.3、broadcast&quot;">​</a></h5><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 最多存放16个消息</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> (tx</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> mut rx) </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> tokio::sync::broadcast::</span><span style="color:#82AAFF;">channel</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">16</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> mut rx2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> tx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">subscribe</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> handle1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> tokio::</span><span style="color:#82AAFF;">spawn</span><span style="color:#A6ACCD;">(async move </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    loop </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">match</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">rx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">recv</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">Ok</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;">) </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">rx receive: {:?}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">Err</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">e</span><span style="color:#F07178;">) </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">err: {:?}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">e</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;font-style:italic;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> handle2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> tokio::</span><span style="color:#82AAFF;">spawn</span><span style="color:#A6ACCD;">(async move </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  loop </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">match</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">rx2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">recv</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">Ok</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;">) </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">rx2 receive: {:?}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">Err</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">e</span><span style="color:#F07178;">) </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">err: {:?}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">e</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">tx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">10</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">tx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">20</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">handle1</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">handle2</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span></code></pre></div><h5 id="_2-3-9-4、watch" tabindex="-1">2.3.9.4、watch <a class="header-anchor" href="#_2-3-9-4、watch" aria-label="Permalink to &quot;2.3.9.4、watch&quot;">​</a></h5><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 创建watch通道时，需指定一个初始值存放在通道中</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> (tx</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> mut rx) </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> tokio::sync::watch::</span><span style="color:#82AAFF;">channel</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hello</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> mut rx1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> rx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">clone</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#82AAFF;">spawn</span><span style="color:#A6ACCD;">(async move </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    while rx1.changed().await.is_ok() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">changed1: {:?}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">rx1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">borrow</span><span style="color:#F07178;">())</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#82AAFF;">spawn</span><span style="color:#A6ACCD;">(async move </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    while rx.changed().await.is_ok() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">changed2: {:?}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">rx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">borrow</span><span style="color:#F07178;">())</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">tx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">world</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span></code></pre></div><h4 id="_2-3-10、tokio-select" tabindex="-1">2.3.10、tokio::select！ <a class="header-anchor" href="#_2-3-10、tokio-select" aria-label="Permalink to &quot;2.3.10、tokio::select！&quot;">​</a></h4><p>server.rs</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">io</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">AsyncBufReadExt</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> AsyncWriteExt</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> BufReader</span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">net</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:TcpListener</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">sync</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:broadcast</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> SERVER_ADDR</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#FFCB6B;">str</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">127.0.0.1:8888</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[tokio::main]</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> Result</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Box</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">dyn </span><span style="color:#FFCB6B;">std</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#FFCB6B;">error</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:Error</span><span style="color:#89DDFF;">&gt;&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    let listener </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> TcpListener::</span><span style="color:#82AAFF;">bind</span><span style="color:#A6ACCD;">(SERVER_ADDR)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">let</span><span style="color:#A6ACCD;"> (tx</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> _rx) </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> broadcast</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#82AAFF;">channel</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">12</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    loop </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> socket</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">addr</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">listener</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">accept</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">?</span><span style="color:#F07178;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">{} connected</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">addr</span><span style="color:#F07178;">);</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">tx</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">tx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">clone</span><span style="color:#F07178;">();</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">rx</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">tx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">subscribe</span><span style="color:#F07178;">();</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">:</span><span style="color:#82AAFF;">spawn</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">async</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">move</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            let </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">r</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">mut</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">w</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> = socket.split</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;">;</span></span>
<span class="line"><span style="color:#F07178;">            let mut </span><span style="color:#A6ACCD;">reader</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">BufReader</span><span style="color:#F07178;">::</span><span style="color:#89DDFF;">new</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">r</span><span style="color:#F07178;">);</span></span>
<span class="line"><span style="color:#F07178;">            let mut </span><span style="color:#A6ACCD;">msg</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">String</span><span style="color:#F07178;">::</span><span style="color:#89DDFF;">new</span><span style="color:#F07178;">();</span></span>
<span class="line"><span style="color:#F07178;">            loop </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#FFCB6B;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">select</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#A6ACCD;">res</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reader</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">read_line</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">msg</span><span style="color:#F07178;">) </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">() </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                          </span><span style="color:#89DDFF;font-style:italic;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">server received {}: {}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">addr</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">msg</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#A6ACCD;">tx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">((</span><span style="color:#A6ACCD;">msg</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">clone</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">addr</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#A6ACCD;">msg</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">clear</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#A6ACCD;">res</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">rx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">recv</span><span style="color:#F07178;">() </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">msg_str</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">other_addr</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">other_addr</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">addr</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                            </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">server send to {}: {}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">other_addr</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">msg_str</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                            </span><span style="color:#A6ACCD;">w</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">write_all</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">msg_str</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">as_bytes</span><span style="color:#F07178;">())</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>client.rs</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">io</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">AsyncBufReadExt</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> AsyncWriteExt</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> BufReader</span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">net</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:TcpStream</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">sync</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:mpsc</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> SERVER_ADDR</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#FFCB6B;">str</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">127.0.0.1:8888</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[tokio::main]</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> Result</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Box</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">dyn </span><span style="color:#FFCB6B;">std</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#FFCB6B;">error</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:Error</span><span style="color:#89DDFF;">&gt;&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    let client </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> TcpStream::</span><span style="color:#82AAFF;">connect</span><span style="color:#A6ACCD;">(SERVER_ADDR)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Connected to: {}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> SERVER_ADDR);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">let</span><span style="color:#A6ACCD;"> (tx</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> mut rx) </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> mpsc</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:channel::</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">(3);</span></span>
<span class="line"><span style="color:#A6ACCD;">    tokio::spawn(async move </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">let</span><span style="color:#A6ACCD;"> (r</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> mut w) </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> client</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">into_split</span><span style="color:#A6ACCD;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        let mut reader </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> BufReader::</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;">(r);</span></span>
<span class="line"><span style="color:#A6ACCD;">        let mut line </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> String::</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        loop </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#F07178;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:select</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                res </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> reader</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">read_line</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">mut line) </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">() </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#89DDFF;font-style:italic;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">read from server: {}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">line</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#A6ACCD;">line</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">clear</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">                res </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> rx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">recv</span><span style="color:#A6ACCD;">() </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">msg</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">write to server: {}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">msg</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#A6ACCD;">w</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">write_all</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">msg</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">as_bytes</span><span style="color:#F07178;">())</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    println!(&quot;Enter something to send to server&quot;);</span></span>
<span class="line"><span style="color:#A6ACCD;">    loop </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      let mut buf </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> String::</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">      std::io::</span><span style="color:#82AAFF;">stdin</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">read_line</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">mut buf)</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// 不能写成buf.trim().to_string(), 使用tcp发送有问题</span></span>
<span class="line"><span style="color:#A6ACCD;">      tx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#A6ACCD;">(buf</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">clone</span><span style="color:#A6ACCD;">())</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">      buf</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">clear</span><span style="color:#A6ACCD;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre></div><h2 id="_3、hyper" tabindex="-1">3、hyper <a class="header-anchor" href="#_3、hyper" aria-label="Permalink to &quot;3、hyper&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>hyper是一个基于Rust语言的HTTP库, hyper-rustls是一个基于Rust语言的TLS库。</p></div><h3 id="_3-1、官网" tabindex="-1">3.1、官网 <a class="header-anchor" href="#_3-1、官网" aria-label="Permalink to &quot;3.1、官网&quot;">​</a></h3><p><a href="https://hyper.rs/guides/0.14/" target="_blank" rel="noreferrer">https://hyper.rs/guides/0.14/</a></p><h3 id="_3-2、安装" tabindex="-1">3.2、安装 <a class="header-anchor" href="#_3-2、安装" aria-label="Permalink to &quot;3.2、安装&quot;">​</a></h3><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">[dependencies]</span></span>
<span class="line"><span style="color:#A6ACCD;">hyper </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> version </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">0.14</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> features </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">full</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">] </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">hyper</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">rustls </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">0.24.1</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">tokio </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> version </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> features </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">full</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">] </span><span style="color:#89DDFF;">}</span></span></code></pre></div><h3 id="_3-3、server" tabindex="-1">3.3、Server <a class="header-anchor" href="#_3-3、server" aria-label="Permalink to &quot;3.3、Server&quot;">​</a></h3><p><a href="https://github.com/hyperium/hyper/blob/0.14.x/examples" target="_blank" rel="noreferrer">https://github.com/hyperium/hyper/blob/0.14.x/examples</a></p><h4 id="_3-3-1、简单示例" tabindex="-1">3.3.1、简单示例 <a class="header-anchor" href="#_3-3-1、简单示例" aria-label="Permalink to &quot;3.3.1、简单示例&quot;">​</a></h4><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">std</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">net</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:SocketAddr</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">convert</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:Infallible</span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">hyper</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">service</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">make_service_fn</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> service_fn</span><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> Server</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Request</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Response</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Body</span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">hello_world</span><span style="color:#A6ACCD;">(_req: Request</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">Body</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> Result</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">Response</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">Body</span><span style="color:#89DDFF;">&gt;,</span><span style="color:#A6ACCD;"> Infallible</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">Ok</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Response</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Body</span><span style="color:#89DDFF;">&gt;, </span><span style="color:#C792EA;">Infallible</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">(Response::new(&quot;Hello, World&quot;.into()))</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[tokio::main]</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn main() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    let addr </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> SocketAddr::</span><span style="color:#82AAFF;">from</span><span style="color:#A6ACCD;">(([</span><span style="color:#F78C6C;">127</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">5000</span><span style="color:#A6ACCD;">));</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    let make_svc </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">make_service_fn</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">_conn</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> async </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">Ok</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">_</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Infallible&gt;(</span><span style="color:#F07178;">service_fn</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">hello_world</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 创建服务</span></span>
<span class="line"><span style="color:#A6ACCD;">    let server </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Server::</span><span style="color:#82AAFF;">bind</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">addr)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">serve</span><span style="color:#A6ACCD;">(make_svc);</span></span>
<span class="line"><span style="color:#A6ACCD;">    if let </span><span style="color:#82AAFF;">Err</span><span style="color:#A6ACCD;">(e) </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> server</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        eprintln!(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">service error: {}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> e);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h4 id="_3-3-2、https-http请求代理" tabindex="-1">3.3.2、https/http请求代理 <a class="header-anchor" href="#_3-3-2、https-http请求代理" aria-label="Permalink to &quot;3.3.2、https/http请求代理&quot;">​</a></h4><p>Cargo.toml</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">[dependencies]</span></span>
<span class="line"><span style="color:#A6ACCD;">hyper </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">version </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">0.14</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> features </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">full</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">tokio </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">version </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> features </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">full</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">hyper</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">rustls </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">0.22</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">futures</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">util </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">0.3</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">anyhow </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1.0.37</span><span style="color:#89DDFF;">&quot;</span></span></code></pre></div><p>main.rs</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">anyhow</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">*;</span></span>
<span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">std</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#FFCB6B;">sync</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:Arc</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">std</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#FFCB6B;">net</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:SocketAddr</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">hyper</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">Body</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Request</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Server</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Client</span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">hyper</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#FFCB6B;">service</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">make_service_fn</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> service_fn</span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// hyper-rustls = &quot;0.22&quot; 版本过高不行</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[tokio::main]</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> Result</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    let https </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> hyper_rustls::HttpsConnector::</span><span style="color:#82AAFF;">with_native_roots</span><span style="color:#A6ACCD;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">    let client </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Client::</span><span style="color:#82AAFF;">builder</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">build::</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">_</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">hyper</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:Body</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">(https);</span></span>
<span class="line"><span style="color:#A6ACCD;">    let client </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Arc::</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;">(client);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    let addr </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> SocketAddr::</span><span style="color:#82AAFF;">from</span><span style="color:#A6ACCD;">(([</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">7000</span><span style="color:#A6ACCD;">));</span></span>
<span class="line"><span style="color:#A6ACCD;">    let make_svc </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">make_service_fn</span><span style="color:#A6ACCD;">(move </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">_conn</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        let client </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Arc::</span><span style="color:#82AAFF;">clone</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">client);</span></span>
<span class="line"><span style="color:#A6ACCD;">        async move </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">Ok</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">service_fn</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">move</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                    let </span><span style="color:#A6ACCD;">client</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Arc</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">clone</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">client</span><span style="color:#F07178;">);</span></span>
<span class="line"><span style="color:#F07178;">                    async move </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">proxy: {}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">uri</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">path</span><span style="color:#F07178;">())</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#82AAFF;">proxy_crate</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">req</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">?</span><span style="color:#F07178;">;</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#A6ACCD;">client</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">request</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">context</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">proxy request</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">                    }</span></span>
<span class="line"><span style="color:#F07178;">                }</span></span>
<span class="line"><span style="color:#F07178;">            ))</span></span>
<span class="line"><span style="color:#F07178;">        }</span></span>
<span class="line"><span style="color:#F07178;">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">_server</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Server</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">:</span><span style="color:#82AAFF;">bind</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">addr</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">serve</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">make_svc</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">context</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Run server</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">Ok</span><span style="color:#F07178;">(())</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">fn proxy_crate</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#FFCB6B;">mut</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Request</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Body</span><span style="color:#89DDFF;">&gt;)</span><span style="color:#F07178;"> -&gt; Result</span><span style="color:#89DDFF;">&lt;()&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">for</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">in</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#F07178;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">content-length</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">accept-encoding</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">content-encoding</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">transfer-encoding</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">headers_mut</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">remove</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">uri</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">uri</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">uri_string</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">match</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">uri</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">query</span><span style="color:#F07178;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        Some</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">query_item</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">format</span><span style="color:#F07178;">!(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://crates.io{}?{}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">uri</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">path</span><span style="color:#89DDFF;">(),</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">query_item</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;font-style:italic;">None</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">format</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://crates.io{}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">uri</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">path</span><span style="color:#F07178;">())</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">uri_mut</span><span style="color:#F07178;">() </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">uri_string</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">context</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Parsing URI Error</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">?</span><span style="color:#F07178;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">Ok</span><span style="color:#F07178;">(())</span></span>
<span class="line"><span style="color:#F07178;">}</span></span></code></pre></div><h4 id="_3-3-3、api" tabindex="-1">3.3.3、api <a class="header-anchor" href="#_3-3-3、api" aria-label="Permalink to &quot;3.3.3、api&quot;">​</a></h4><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">anyhow</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">Result</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Error</span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">futures_util</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">future</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:ok</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> TryStreamExt</span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">hyper</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">service</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">make_service_fn</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> service_fn</span><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> Request</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Body</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Server</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Response</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> StatusCode</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> body</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Method</span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[tokio::main]</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> Result</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    let addr </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">127.0.0.1:3000</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#A6ACCD;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">    let service </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">make_service_fn</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">_</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> async </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">Ok</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">_</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Error&gt;(</span><span style="color:#F07178;">service_fn</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">echo</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    let server </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Server::</span><span style="color:#82AAFF;">bind</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">addr)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">serve</span><span style="color:#A6ACCD;">(service);</span></span>
<span class="line"><span style="color:#A6ACCD;">    println!(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">Listening on http://{}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> addr);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    server.await?;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">Ok</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;">(req: Request</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">Body</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> Result</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">Response</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">Body</span><span style="color:#89DDFF;">&gt;,</span><span style="color:#A6ACCD;"> Error</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">match</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">req.method(</span><span style="color:#89DDFF;">),</span><span style="color:#A6ACCD;"> req.uri().path()) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      (</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">Method</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">GET</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">) </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Ok</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">Response</span><span style="color:#F07178;">::</span><span style="color:#89DDFF;">new(</span><span style="color:#A6ACCD;font-style:italic;">Body</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">from</span><span style="color:#F07178;">( </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Try POSTing data to /echo such as: `curl localhost:3000/echo -XPOST -d &#39;hello world&#39;`</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;">),</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">&amp;</span><span style="color:#A6ACCD;font-style:italic;">Method</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">POST</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/echo</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#82AAFF;">Ok</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">Response</span><span style="color:#F07178;">::</span><span style="color:#89DDFF;">new</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">into_body</span><span style="color:#F07178;">()))</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">      (</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">Method</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">POST</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/echo/uppercase</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">) </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">chunk_stream</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">into_body</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">map_ok</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">chunk</span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">              chunk.iter().map(|c| c.to_ascii_uppercase()).collect</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">:</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Vec</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">u8</span><span style="color:#89DDFF;">&gt;&gt;</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">          });</span></span>
<span class="line"><span style="color:#A6ACCD;">          Ok(Response::new(Body::wrap_stream(chunk_stream)))</span></span>
<span class="line"><span style="color:#A6ACCD;">      },</span></span>
<span class="line"><span style="color:#A6ACCD;">      (&amp;Method::POST, &quot;/echo/reversed&quot;) =&gt; </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">          let body </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> body::</span><span style="color:#82AAFF;">to_bytes</span><span style="color:#A6ACCD;">(req</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">into_body</span><span style="color:#A6ACCD;">())</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">          let reversed_body </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> body</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">iter</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">rev</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cloned</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">collect</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Vec</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">u8</span><span style="color:#89DDFF;">&gt;&gt;</span><span style="color:#A6ACCD;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">          Ok(Response::new(Body::from(reversed_body)))</span></span>
<span class="line"><span style="color:#A6ACCD;">      },</span></span>
<span class="line"><span style="color:#A6ACCD;">      _ =&gt; </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">          let mut not_found </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Response::</span><span style="color:#82AAFF;">default</span><span style="color:#A6ACCD;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">not_found</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">status_mut</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> StatusCode::NOT_FOUND;</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#82AAFF;">Ok</span><span style="color:#A6ACCD;">(not_found)</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre></div><h4 id="_3-3-4、http代理" tabindex="-1">3.3.4、http代理 <a class="header-anchor" href="#_3-3-4、http代理" aria-label="Permalink to &quot;3.3.4、http代理&quot;">​</a></h4><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">std</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#FFCB6B;">net</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:SocketAddr</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">anyhow</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">Error</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Result</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Context</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Ok</span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">futures_util</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:TryStreamExt</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">hyper</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    body</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">service</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">make_service_fn</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> service_fn</span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">    Body</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Client</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Method</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Request</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Response</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Server</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> StatusCode</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[tokio::main]</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> Result</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    let </span><span style="color:#F07178;">addr</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> SocketAddr </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">127.0.0.1:3000</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    let out_addr</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> SocketAddr </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">127.0.0.1:60244</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    let client </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Client</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    let service </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">make_service_fn</span><span style="color:#A6ACCD;">(move </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">_</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        let client </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> client</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">clone</span><span style="color:#A6ACCD;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        let out_addr_clone </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> out_addr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">clone</span><span style="color:#A6ACCD;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        async move </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">Ok</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">service_fn</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">move</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                let </span><span style="color:#A6ACCD;">uri_string</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">format</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">                  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://{}{}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">                  </span><span style="color:#A6ACCD;">out_addr_clone</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">                  </span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">uri</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">                      </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">path_and_query</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">                      </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">map</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">x</span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">x</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">as_str</span><span style="color:#F07178;">())</span></span>
<span class="line"><span style="color:#F07178;">                      </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap_or</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">                );</span></span>
<span class="line"><span style="color:#F07178;">                let </span><span style="color:#A6ACCD;">uri</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">uri_string</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">();</span></span>
<span class="line"><span style="color:#F07178;">                *req.uri_mut() = uri;</span></span>
<span class="line"><span style="color:#F07178;">                client.request(req)</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    let server </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Server::</span><span style="color:#82AAFF;">bind</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">addr)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">serve</span><span style="color:#A6ACCD;">(service);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Listening on http://{}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> addr);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    server</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">Ok</span><span style="color:#A6ACCD;">(())</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre></div><h3 id="_3-4、client" tabindex="-1">3.4、Client <a class="header-anchor" href="#_3-4、client" aria-label="Permalink to &quot;3.4、Client&quot;">​</a></h3><h4 id="_3-4-1、简单示例" tabindex="-1">3.4.1、简单示例 <a class="header-anchor" href="#_3-4-1、简单示例" aria-label="Permalink to &quot;3.4.1、简单示例&quot;">​</a></h4><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">anyhow</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">*;</span></span>
<span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">hyper</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:Client</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[tokio::main]</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> Result</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  let client </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Client::</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">  let uri </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://httpbin.org/ip</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  let resp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> client</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(uri)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Response: {}--{:?}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> resp</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">status</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> resp</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">body</span><span style="color:#A6ACCD;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">Ok</span><span style="color:#A6ACCD;">(())</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre></div><h4 id="_3-4-2、打印body" tabindex="-1">3.4.2、打印body <a class="header-anchor" href="#_3-4-2、打印body" aria-label="Permalink to &quot;3.4.2、打印body&quot;">​</a></h4><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">anyhow</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:Result</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">hyper</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">Client</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:HttpBody</span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">tokio</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#FFCB6B;">io</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">stdout</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> AsyncWriteExt </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">_</span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[tokio::main]</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> Result</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    let client </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Client::</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">    let uri </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://httpbin.org/ip</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    let mut resp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> client</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(uri)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">{}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> resp</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">status</span><span style="color:#A6ACCD;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    while let </span><span style="color:#82AAFF;">Some</span><span style="color:#A6ACCD;">(chunk) </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> resp</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">body_mut</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">data</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// println!(&quot;{:?}&quot;, chunk?);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">stdout</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">.</span><span style="color:#F07178;">write_all</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">&amp;</span><span style="color:#A6ACCD;font-style:italic;">chunk</span><span style="color:#89DDFF;">?)</span><span style="color:#A6ACCD;">.await?;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">Ok</span><span style="color:#A6ACCD;">(())</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre></div><h4 id="_3-4-3、post" tabindex="-1">3.4.3、post <a class="header-anchor" href="#_3-4-3、post" aria-label="Permalink to &quot;3.4.3、post&quot;">​</a></h4><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">anyhow</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:Result</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">hyper</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">Client</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Request</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Body</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Method</span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[tokio::main]</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> Result</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    let client </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Client::</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    let req </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Request::</span><span style="color:#82AAFF;">builder</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">        .method(</span><span style="color:#F07178;">Method</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:POST)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">uri</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://httpbin.org/post</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">header</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">content-type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">application/json</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">body</span><span style="color:#A6ACCD;">(Body::</span><span style="color:#82AAFF;">from</span><span style="color:#A6ACCD;">(r#</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">{</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">#))</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span></span>
<span class="line"><span style="color:#A6ACCD;">    let resp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> client</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">request</span><span style="color:#A6ACCD;">(req)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// body -&gt; Bytes</span></span>
<span class="line"><span style="color:#A6ACCD;">    let res </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> hyper</span><span style="color:#89DDFF;">::</span><span style="color:#A6ACCD;">body::</span><span style="color:#82AAFF;">to_bytes</span><span style="color:#A6ACCD;">(resp</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">into_body</span><span style="color:#A6ACCD;">())</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// bytes -&gt; String</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">body: {:?}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> String::</span><span style="color:#82AAFF;">from_utf8_lossy</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">res));</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">Ok</span><span style="color:#A6ACCD;">(())</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre></div><h4 id="_3-4-4、body-to-json" tabindex="-1">3.4.4、body to json <a class="header-anchor" href="#_3-4-4、body-to-json" aria-label="Permalink to &quot;3.4.4、body to json&quot;">​</a></h4><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">anyhow</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:Result</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">hyper</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">Client</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:Buf</span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">serde</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:Deserialize</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[</span><span style="color:#82AAFF;">derive</span><span style="color:#A6ACCD;">(Deserialize</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Debug)]</span></span>
<span class="line"><span style="color:#A6ACCD;">struct User </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">id</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">i32</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">String</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[tokio::main]</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> Result</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    let client </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Client::</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">    let uri </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://jsonplaceholder.typicode.com/users</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    let res </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> client</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(uri)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    let body </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> hyper</span><span style="color:#89DDFF;">::</span><span style="color:#A6ACCD;">body::</span><span style="color:#82AAFF;">aggregate</span><span style="color:#A6ACCD;">(res)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    let users</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Vec</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">User</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> serde_json::</span><span style="color:#82AAFF;">from_reader</span><span style="color:#A6ACCD;">(body</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">reader</span><span style="color:#A6ACCD;">())</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    for user </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> users </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        println!(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">id: {}, name: {}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> user.id</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> user.name);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">Ok</span><span style="color:#A6ACCD;">(())</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre></div><h2 id="_4、anyhow-异常捕捉" tabindex="-1">4、anyhow(异常捕捉) <a class="header-anchor" href="#_4、anyhow-异常捕捉" aria-label="Permalink to &quot;4、anyhow(异常捕捉)&quot;">​</a></h2><h3 id="_4-1、安装" tabindex="-1">4.1、安装 <a class="header-anchor" href="#_4-1、安装" aria-label="Permalink to &quot;4.1、安装&quot;">​</a></h3><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">[dependencies]</span></span>
<span class="line"><span style="color:#A6ACCD;">anyhow </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1.0.75</span><span style="color:#89DDFF;">&quot;</span></span></code></pre></div><h3 id="_4-2、使用" tabindex="-1">4.2、使用 <a class="header-anchor" href="#_4-2、使用" aria-label="Permalink to &quot;4.2、使用&quot;">​</a></h3><h4 id="_4-2-1、result" tabindex="-1">4.2.1、Result <a class="header-anchor" href="#_4-2-1、result" aria-label="Permalink to &quot;4.2.1、Result&quot;">​</a></h4><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">std</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#FFCB6B;">fs</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:File</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">anyhow</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:Result</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> Result</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">File</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#82AAFF;">open</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Cargo1.toml</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">Ok</span><span style="color:#A6ACCD;">(())</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre></div><h4 id="_4-2-2、context" tabindex="-1">4.2.2、Context <a class="header-anchor" href="#_4-2-2、context" aria-label="Permalink to &quot;4.2.2、Context&quot;">​</a></h4><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">anyhow</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">Result</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Context</span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">hyper</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:Client</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[tokio::main]</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> Result</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  let client </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Client::</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">  let uri </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http1://httpbin.org/ip</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  let resp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> client</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(uri)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">context</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">context</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Response: {}--{:?}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> resp</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">status</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> resp</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">body</span><span style="color:#A6ACCD;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">Ok</span><span style="color:#A6ACCD;">(())</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre></div><h4 id="_4-2-3、with-context" tabindex="-1">4.2.3、with_context <a class="header-anchor" href="#_4-2-3、with-context" aria-label="Permalink to &quot;4.2.3、with_context&quot;">​</a></h4><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">std</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:fs</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">anyhow</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">Result</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Context</span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> Result</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    let path </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Cargo1.toml</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    let content </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> fs::</span><span style="color:#82AAFF;">read</span><span style="color:#A6ACCD;">(path)        </span></span>
<span class="line"><span style="color:#A6ACCD;">        .with_context(|| format!(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">Failed to read instrs from {}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> path))?;</span></span>
<span class="line"><span style="color:#A6ACCD;">    println!(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">{:?}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> content);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">Ok</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h2 id="_5、reqwest-请求库" tabindex="-1">5、reqwest(请求库) <a class="header-anchor" href="#_5、reqwest-请求库" aria-label="Permalink to &quot;5、reqwest(请求库)&quot;">​</a></h2><h3 id="_5-1、安装" tabindex="-1">5.1、安装 <a class="header-anchor" href="#_5-1、安装" aria-label="Permalink to &quot;5.1、安装&quot;">​</a></h3><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">[dependencies]</span></span>
<span class="line"><span style="color:#A6ACCD;">reqwest </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> version </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">0.11</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> features </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">json</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">] </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">tokio </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> version </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> features </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">full</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">] </span><span style="color:#89DDFF;">}</span></span></code></pre></div><h3 id="_5-2、get请求" tabindex="-1">5.2、get请求 <a class="header-anchor" href="#_5-2、get请求" aria-label="Permalink to &quot;5.2、get请求&quot;">​</a></h3><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">std</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#FFCB6B;">collections</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:HashMap</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[tokio::main]</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> Result</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Box</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">dyn </span><span style="color:#FFCB6B;">std</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#FFCB6B;">error</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:Error</span><span style="color:#89DDFF;">&gt;&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    let resp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> reqwest::</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://httpbin.org/ip</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        .await?</span></span>
<span class="line"><span style="color:#A6ACCD;">        .</span><span style="color:#F07178;">json</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">HashMap</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">, </span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">&gt;&gt;</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">        .await?;</span></span>
<span class="line"><span style="color:#A6ACCD;">    println!(&quot;</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">:#</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">, resp);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">Ok</span><span style="color:#A6ACCD;">(())</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre></div><h3 id="_5-3、post请求" tabindex="-1">5.3、post请求 <a class="header-anchor" href="#_5-3、post请求" aria-label="Permalink to &quot;5.3、post请求&quot;">​</a></h3><p><code>Cargo.toml</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">[dependencies]</span></span>
<span class="line"><span style="color:#A6ACCD;">reqwest </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> version </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">0.11</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> features </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">json</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">] </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">tokio </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> version </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> features </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">full</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">] </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">serde </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> version </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> features </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">derive</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">] </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">serde_json </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1</span><span style="color:#89DDFF;">&quot;</span></span></code></pre></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">serde</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">Serialize</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Deserialize</span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">serde_json</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:json</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[</span><span style="color:#82AAFF;">derive</span><span style="color:#A6ACCD;">(Debug</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Serialize</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Deserialize)]</span></span>
<span class="line"><span style="color:#A6ACCD;">struct User </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">   </span><span style="color:#FFCB6B;">userId</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">u16</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">   </span><span style="color:#FFCB6B;">id</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">u16</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">   </span><span style="color:#FFCB6B;">title</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">String</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">   </span><span style="color:#FFCB6B;">body</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">String</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[tokio::main]</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> Result</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Box</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">dyn </span><span style="color:#FFCB6B;">std</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#FFCB6B;">error</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:Error</span><span style="color:#89DDFF;">&gt;&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    let client </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> reqwest::Client::</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">    let post </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> client</span></span>
<span class="line"><span style="color:#A6ACCD;">        .post(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">http://jsonplaceholder.typicode.com/posts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        .json(&amp;json!({</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">userId</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">foo</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">bar</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">))</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    let resp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> post</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">json</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">User</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">().await?;</span></span>
<span class="line"><span style="color:#A6ACCD;">    println!(&quot;</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">:#</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">, resp);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">Ok</span><span style="color:#A6ACCD;">(())</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre></div><h2 id="_6、structopt-命令行参数转结构体" tabindex="-1">6、structopt(命令行参数转结构体) <a class="header-anchor" href="#_6、structopt-命令行参数转结构体" aria-label="Permalink to &quot;6、structopt(命令行参数转结构体)&quot;">​</a></h2><h3 id="_6-1、安装" tabindex="-1">6.1、安装 <a class="header-anchor" href="#_6-1、安装" aria-label="Permalink to &quot;6.1、安装&quot;">​</a></h3><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">[dependencies]</span></span>
<span class="line"><span style="color:#A6ACCD;">structopt </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">0.3</span><span style="color:#89DDFF;">&quot;</span></span></code></pre></div><h3 id="_6-2、使用" tabindex="-1">6.2、使用 <a class="header-anchor" href="#_6-2、使用" aria-label="Permalink to &quot;6.2、使用&quot;">​</a></h3><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">std</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#FFCB6B;">path</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:PathBuf</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">structopt</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:StructOpt</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/// A basic example</span></span>
<span class="line"><span style="color:#A6ACCD;">#[</span><span style="color:#82AAFF;">derive</span><span style="color:#A6ACCD;">(StructOpt</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Debug)]</span></span>
<span class="line"><span style="color:#A6ACCD;">#[</span><span style="color:#82AAFF;">structopt</span><span style="color:#A6ACCD;">(name </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">basic</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)] </span><span style="color:#676E95;font-style:italic;">// 命令行的名字</span></span>
<span class="line"><span style="color:#A6ACCD;">struct Opt </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">/// Activate debug mode</span></span>
<span class="line"><span style="color:#F07178;">    #[</span><span style="color:#82AAFF;">structopt</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">short</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">long</span><span style="color:#F07178;">)]</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">debug</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">bool</span><span style="color:#89DDFF;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">/// Set speed</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// we don&#39;t want to name it &quot;speed&quot;, need to look smart</span></span>
<span class="line"><span style="color:#F07178;">    #[</span><span style="color:#82AAFF;">structopt</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">short</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">s</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">long</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">speed</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">default_value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">42</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)]</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">speed</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">f64</span><span style="color:#89DDFF;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">/// Input file</span></span>
<span class="line"><span style="color:#F07178;">    #[</span><span style="color:#82AAFF;">structopt</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">parse</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">from_os_str</span><span style="color:#F07178;">))]</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">input</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">PathBuf</span><span style="color:#89DDFF;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">/// Output file, stdout if not present</span></span>
<span class="line"><span style="color:#F07178;">    #[</span><span style="color:#82AAFF;">structopt</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">parse</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">from_os_str</span><span style="color:#F07178;">))]</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">output</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Option</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">PathBuf</span><span style="color:#89DDFF;">&gt;,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">/// Output file, stdout if not present</span></span>
<span class="line"><span style="color:#F07178;">    #[</span><span style="color:#82AAFF;">structopt</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">name</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">file</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">parse</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">from_os_str</span><span style="color:#F07178;">))]</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">output2</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Option</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">PathBuf</span><span style="color:#89DDFF;">&gt;,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">/// Where to write the output: to `stdout` or `file`</span></span>
<span class="line"><span style="color:#F07178;">    #[</span><span style="color:#82AAFF;">structopt</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">short</span><span style="color:#F07178;">)]</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">out_type</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">String</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">opt</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Opt</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">from_args</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">{:#?}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">opt</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h2 id="_7、egui-异步库" tabindex="-1">7、egui(异步库) <a class="header-anchor" href="#_7、egui-异步库" aria-label="Permalink to &quot;7、egui(异步库)&quot;">​</a></h2><h3 id="_7-1、安装" tabindex="-1">7.1、安装 <a class="header-anchor" href="#_7-1、安装" aria-label="Permalink to &quot;7.1、安装&quot;">​</a></h3><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">[dependencies]</span></span>
<span class="line"><span style="color:#A6ACCD;">eframe </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">0.23</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">egui_extras </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> version </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">0.23</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> features </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">all_loaders</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">] </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">image </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> version </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">0.24</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> features </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">jpeg</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">png</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">] </span><span style="color:#89DDFF;">}</span></span></code></pre></div><h3 id="_7-2、使用" tabindex="-1">7.2、使用 <a class="header-anchor" href="#_7-2、使用" aria-label="Permalink to &quot;7.2、使用&quot;">​</a></h3><h4 id="_7-2-1、基础控件" tabindex="-1">7.2.1、基础控件 <a class="header-anchor" href="#_7-2-1、基础控件" aria-label="Permalink to &quot;7.2.1、基础控件&quot;">​</a></h4><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">eframe</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:egui</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[</span><span style="color:#82AAFF;">derive</span><span style="color:#A6ACCD;">(Default)]</span></span>
<span class="line"><span style="color:#A6ACCD;">struct MyApp </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">String</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">age</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">u32</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">impl </span><span style="color:#FFCB6B;">eframe</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:App for MyApp </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">fn</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">update</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ctx</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">egui</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">Context</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">frame</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">eframe</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">Frame</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#FFCB6B;">egui</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">:</span><span style="color:#FFCB6B;">CentralPanel</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">:</span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">show</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">ui</span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          ui.heading(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">My egui Application</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">);</span></span>
<span class="line"><span style="color:#F07178;">          ui.horizontal(|ui| {</span></span>
<span class="line"><span style="color:#F07178;">              let name_label = ui.label(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">Your name: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">);</span></span>
<span class="line"><span style="color:#F07178;">              ui.text_edit_singleline(&amp;mut self.name)</span></span>
<span class="line"><span style="color:#F07178;">                  .labelled_by(name_label.id);</span></span>
<span class="line"><span style="color:#F07178;">          });</span></span>
<span class="line"><span style="color:#F07178;">          ui.add(egui</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">Slider</span><span style="color:#F07178;">::</span><span style="color:#89DDFF;">new</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">age</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0.</span><span style="color:#89DDFF;">.=</span><span style="color:#F78C6C;">120</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">text</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">age</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">));</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">if</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ui</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">button</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Click each year</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">clicked</span><span style="color:#F07178;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">              self.age += </span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">;</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">ui</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">label</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">format</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Hello &#39;{}&#39;, age {}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">age</span><span style="color:#F07178;">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">ui</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">image</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">egui</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">include_image</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">../assets/logo.png</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F07178;">          ));</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> Result</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">eframe</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:Error</span><span style="color:#89DDFF;">&gt;{</span></span>
<span class="line"><span style="color:#A6ACCD;">    let options </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> eframe::NativeOptions </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">initial_window_size</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Some</span><span style="color:#A6ACCD;">(egui::</span><span style="color:#82AAFF;">vec2</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">640.0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">600.0</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        ..</span><span style="color:#F07178;">Default</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#82AAFF;">default</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">eframe</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#82AAFF;">run_native</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">My egui App</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        options</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        Box::</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">cc</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">egui_extras</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#82AAFF;">install_image_loaders</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">cc</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">egui_ctx);</span></span>
<span class="line"><span style="color:#A6ACCD;">          Box::</span><span style="color:#89DDFF;">new(</span><span style="color:#A6ACCD;font-style:italic;">MyApp</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">default</span><span style="color:#89DDFF;">())</span></span>
<span class="line"><span style="color:#A6ACCD;">        }),</span></span>
<span class="line"><span style="color:#A6ACCD;">    )</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre></div><h4 id="_7-2-2、confirm确认框" tabindex="-1">7.2.2、confirm确认框 <a class="header-anchor" href="#_7-2-2、confirm确认框" aria-label="Permalink to &quot;7.2.2、confirm确认框&quot;">​</a></h4><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">eframe</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:egui</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[</span><span style="color:#82AAFF;">derive</span><span style="color:#A6ACCD;">(Default)]</span></span>
<span class="line"><span style="color:#A6ACCD;">struct MyApp </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">allowed_to_close</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">bool</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">show_confirmation_dialog</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">bool</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">impl </span><span style="color:#FFCB6B;">eframe</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:App for MyApp </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">fn</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">on_close_event</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">bool</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">show_confirmation_dialog</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">allowed_to_close</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">fn</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">update</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ctx</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">egui</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">Context</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">frame</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">eframe</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">Frame</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#FFCB6B;">egui</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">:</span><span style="color:#FFCB6B;">CentralPanel</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">:</span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">show</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">ui</span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          ui.heading(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">My egui Application</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">);</span></span>
<span class="line"><span style="color:#F07178;">      });</span></span>
<span class="line"><span style="color:#F07178;">      if self.show_confirmation_dialog {</span></span>
<span class="line"><span style="color:#F07178;">          egui</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">Window</span><span style="color:#F07178;">::</span><span style="color:#89DDFF;">new</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Do you want to quit?</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">collapsible</span><span style="color:#F07178;">(</span><span style="color:#FF9CAC;">false</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resizable</span><span style="color:#F07178;">(</span><span style="color:#FF9CAC;">false</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">show</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">ui</span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                  ui.horizontal(|ui| </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                      </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ui</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">button</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Cancel</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">clicked</span><span style="color:#F07178;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                          </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">show_confirmation_dialog</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">                      </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ui</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">button</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Yes!</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">clicked</span><span style="color:#F07178;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                          </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">allowed_to_close</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                          </span><span style="color:#A6ACCD;">frame</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">close</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">                  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">);</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">);</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    }</span></span>
<span class="line"><span style="color:#F07178;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">fn</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">main</span><span style="color:#F07178;">() </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Result</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">eframe</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">Error</span><span style="color:#89DDFF;">&gt;{</span></span>
<span class="line"><span style="color:#F07178;">    let </span><span style="color:#A6ACCD;">options</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">eframe</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">NativeOptions</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        initial_window_size</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Some</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">egui</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">vec2</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">640.0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">600.0</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        ..Default</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">:</span><span style="color:#82AAFF;">default</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">;</span></span>
<span class="line"><span style="color:#F07178;">    eframe</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">:</span><span style="color:#82AAFF;">run_native</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">My egui App</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">Box</span><span style="color:#F07178;">::</span><span style="color:#89DDFF;">new</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">cc</span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          Box</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">:</span><span style="color:#89DDFF;">new(</span><span style="color:#A6ACCD;font-style:italic;">MyApp</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">default</span><span style="color:#89DDFF;">())</span></span>
<span class="line"><span style="color:#F07178;">        }),</span></span>
<span class="line"><span style="color:#F07178;">    )</span></span>
<span class="line"><span style="color:#F07178;">}</span></span></code></pre></div><h4 id="_7-2-3、键盘事件" tabindex="-1">7.2.3、键盘事件 <a class="header-anchor" href="#_7-2-3、键盘事件" aria-label="Permalink to &quot;7.2.3、键盘事件&quot;">​</a></h4><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">impl </span><span style="color:#FFCB6B;">eframe</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:App for Content </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">fn</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">update</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ctx</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">egui</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">Context</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">_frame</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">eframe</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">Frame</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#FFCB6B;">egui</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">:</span><span style="color:#FFCB6B;">CentralPanel</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">:</span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">show</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">ui</span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          ui.heading(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">Press/Hold/Release example. Press A to test.</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">);</span></span>
<span class="line"><span style="color:#F07178;">          if ui.button(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">Clear</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">).clicked() {</span></span>
<span class="line"><span style="color:#F07178;">              self.text.clear();</span></span>
<span class="line"><span style="color:#F07178;">          }</span></span>
<span class="line"><span style="color:#F07178;">          egui</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">ScrollArea</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">vertical</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">auto_shrink</span><span style="color:#F07178;">([</span><span style="color:#FF9CAC;">false</span><span style="color:#F07178;">; </span><span style="color:#F78C6C;">2</span><span style="color:#F07178;">])</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stick_to_bottom</span><span style="color:#F07178;">(</span><span style="color:#FF9CAC;">true</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">show</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ui</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">ui</span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                  ui.label(&amp;self.text);</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">if</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">input</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">i</span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">i</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">key_pressed</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">egui</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">Key</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">A</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">              self.text.push_str(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">\n</span><span style="color:#F07178;">Pressed</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">);</span></span>
<span class="line"><span style="color:#F07178;">          }</span></span>
<span class="line"><span style="color:#F07178;">          if ctx.input(|i| i.key_down(egui</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">Key</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">A</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">              self.text.push_str(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">\n</span><span style="color:#F07178;">Held</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">);</span></span>
<span class="line"><span style="color:#F07178;">              ui.ctx().request_repaint(); </span><span style="color:#676E95;font-style:italic;">// make sure we note the holding.</span></span>
<span class="line"><span style="color:#F07178;">          }</span></span>
<span class="line"><span style="color:#F07178;">          if ctx.input(|i| i.key_released(egui</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">Key</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">A</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">              self.text.push_str(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">\n</span><span style="color:#F07178;">Released</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">);</span></span>
<span class="line"><span style="color:#F07178;">          }</span></span>
<span class="line"><span style="color:#F07178;">      });</span></span>
<span class="line"><span style="color:#F07178;">  }</span></span>
<span class="line"><span style="color:#F07178;">}</span></span></code></pre></div><h2 id="_8、drive-builder" tabindex="-1">8、drive_builder <a class="header-anchor" href="#_8、drive-builder" aria-label="Permalink to &quot;8、drive_builder&quot;">​</a></h2><h3 id="_8-1、安装" tabindex="-1">8.1、安装 <a class="header-anchor" href="#_8-1、安装" aria-label="Permalink to &quot;8.1、安装&quot;">​</a></h3><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">[dependencies]</span></span>
<span class="line"><span style="color:#A6ACCD;">drive_builder </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">0.1</span><span style="color:#89DDFF;">&quot;</span></span></code></pre></div><h3 id="_8-2、使用" tabindex="-1">8.2、使用 <a class="header-anchor" href="#_8-2、使用" aria-label="Permalink to &quot;8.2、使用&quot;">​</a></h3><h4 id="_8-2-1、基本使用" tabindex="-1">8.2.1、基本使用 <a class="header-anchor" href="#_8-2-1、基本使用" aria-label="Permalink to &quot;8.2.1、基本使用&quot;">​</a></h4><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> mut ch </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> ChannelBuilder::</span><span style="color:#82AAFF;">default</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">ch</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">ipsum</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">world</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> ch </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> ch</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">build</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">{:?}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> ch)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><h4 id="_8-2-2、setter" tabindex="-1">8.2.2、setter <a class="header-anchor" href="#_8-2-2、setter" aria-label="Permalink to &quot;8.2.2、setter&quot;">​</a></h4><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">derive_builder</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:Builder</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[</span><span style="color:#82AAFF;">derive</span><span style="color:#A6ACCD;">(Builder</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Debug)]</span></span>
<span class="line"><span style="color:#A6ACCD;">struct Channel </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    #[</span><span style="color:#82AAFF;">builder</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">setter</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">into</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">strip_option</span><span style="color:#F07178;">))]</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">ipsum</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Option</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">String</span><span style="color:#89DDFF;">&gt;,</span></span>
<span class="line"><span style="color:#F07178;">    #[</span><span style="color:#82AAFF;">builder</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">setter</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">into</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">strip_option</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">default</span><span style="color:#F07178;">)]</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">foo</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Option</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">String</span><span style="color:#89DDFF;">&gt;,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ch</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ChannelBuilder</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">default</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">ipsum</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hello</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">build</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">{:?}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ch</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h4 id="_8-2-3、重命名builder" tabindex="-1">8.2.3、重命名builder <a class="header-anchor" href="#_8-2-3、重命名builder" aria-label="Permalink to &quot;8.2.3、重命名builder&quot;">​</a></h4><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">derive_builder</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:Builder</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[</span><span style="color:#82AAFF;">derive</span><span style="color:#A6ACCD;">(Builder</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Debug)]</span></span>
<span class="line"><span style="color:#A6ACCD;">#[</span><span style="color:#82AAFF;">builder</span><span style="color:#A6ACCD;">(name </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">FooConstructor</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)]</span></span>
<span class="line"><span style="color:#A6ACCD;">struct Channel </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    #[</span><span style="color:#82AAFF;">builder</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">setter</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">into</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">strip_option</span><span style="color:#F07178;">))]</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">ipsum</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Option</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">String</span><span style="color:#89DDFF;">&gt;,</span></span>
<span class="line"><span style="color:#F07178;">    #[</span><span style="color:#82AAFF;">builder</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">setter</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">into</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">strip_option</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">default</span><span style="color:#F07178;">)]</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">foo</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Option</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">String</span><span style="color:#89DDFF;">&gt;,</span></span>
<span class="line"><span style="color:#F07178;">    #[</span><span style="color:#82AAFF;">builder</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">setter</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">skip</span><span style="color:#F07178;">))] </span><span style="color:#676E95;font-style:italic;">// 跳过该属性，会使用默认值</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">setter_skipped</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">String</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> ch </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">FooConstructor</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">default</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">ch</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">ipsum</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">world</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// ch.setter_skipped(&quot;heee&quot;.to_string());</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ch</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ch</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">build</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">{:?}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ch</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div></div></div></main><footer class="VPDocFooter" data-v-42804bdd data-v-543d3880><!--[--><!--]--><div class="edit-info" data-v-543d3880><!----><div class="last-updated" data-v-543d3880><p class="VPLastUpdated" data-v-543d3880 data-v-a3e2c698>Last updated: <time datetime="2024-01-02T10:25:14.000Z" data-v-a3e2c698></time></p></div></div><nav class="prev-next" data-v-543d3880><div class="pager" data-v-543d3880><a class="pager-link prev" href="/backend/rust/%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7" data-v-543d3880><span class="desc" data-v-543d3880>Previous page</span><span class="title" data-v-543d3880>4、Rust实用工具</span></a></div><div class="pager" data-v-543d3880><a class="pager-link next" href="/backend/rust/%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7%E5%8F%8A%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9" data-v-543d3880><span class="desc" data-v-543d3880>Next page</span><span class="title" data-v-543d3880>6、开发技巧及注意事项</span></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-c6746956 data-v-a21eeca5><div class="container" data-v-a21eeca5><p class="message" data-v-a21eeca5>Released under the MIT License.</p><p class="copyright" data-v-a21eeca5>Copyright © 2023 MZ, All rights reserved.</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"backend_nodejs_实用小工具.md\":\"2b85076d\",\"backend_rust_actix-web.md\":\"c2ff0d35\",\"backend_express_express简介.md\":\"8254e2ae\",\"ai_免费可用ai工具.md\":\"c51aff5d\",\"f2e_css_1px.md\":\"db2bfcb8\",\"ai_ai机器学习.md\":\"543e1462\",\"backend_rust_tauri桌面端应用.md\":\"dcedaed6\",\"f2e_html_index.md\":\"375d20b3\",\"backend_rust_rust进阶.md\":\"2ddf93cc\",\"backend_nodejs_nodejs简介.md\":\"e83fb730\",\"backend_rust_webassembly简介.md\":\"0556757a\",\"backend_nodejs_nodejs_ts.md\":\"e5942a64\",\"tool_efficiency_pnpm-monorepo.md\":\"849329f3\",\"tool_efficiency_pnpm简介.md\":\"a58e0468\",\"tool_site_index.md\":\"3603ffda\",\"tool_vscode_devcontainer容器.md\":\"40ffb0f1\",\"tool_vscode_index.md\":\"e8631bb5\",\"tool_vscode_常用扩展插件.md\":\"cae565cd\",\"backend_rust_常用三方库.md\":\"a9503789\",\"backend_rust_实用工具.md\":\"010d8afa\",\"f2e_vue_nuxt_nuxt3简介.md\":\"932ffe2a\",\"f2e_vue_nuxtjs_nuxtjs简介.md\":\"f88b99b7\",\"serverless_deploy_replit简介.md\":\"a6f662b2\",\"f2e_css_css开发小技巧.md\":\"be4dd777\",\"ai_其他整理.md\":\"817e6db6\",\"backend_rust_开发案例.md\":\"1a65ebf2\",\"backend_nodejs_搭建npm私服.md\":\"5a4f1764\",\"f2e_css_index.md\":\"1efd123c\",\"f2e_bundle_esbuild打包.md\":\"680179b2\",\"f2e_bundle_tsup打包.md\":\"6932f259\",\"f2e_bundle_unbuild打包.md\":\"67223d20\",\"f2e_bundle_vite-plugin简介.md\":\"c7a07a3c\",\"f2e_css_transition和animation动画.md\":\"13724ebb\",\"backend_rust_web框架warp.md\":\"94e213dd\",\"f2e_script_js_xhr简介.md\":\"4b1cc375\",\"f2e_script_js_index.md\":\"ff7dc106\",\"f2e_script_js_开发实用技巧.md\":\"feeb13a9\",\"f2e_script_js_gasp动画库.md\":\"c374fe64\",\"f2e_script_ts_开发实用技巧.md\":\"b3982153\",\"f2e_script_ts_typescript订阅监听.md\":\"84ac7ca4\",\"phone_oc_开发实用技巧.md\":\"f6750367\",\"f2e_script_ts_index.md\":\"31318e79\",\"phone_swift_index.md\":\"9bcfcad9\",\"backend_rust_开发技巧及注意事项.md\":\"7fa92228\",\"serverless_deploy_glitch简介.md\":\"8d90a7fa\",\"f2e_bundle_vite简介.md\":\"42bce718\",\"serverless_deploy_heroku简介.md\":\"a89f83b5\",\"f2e_script_ts_typescript进阶.md\":\"2ab08a0d\",\"serverless_deploy_netlify简介.md\":\"99f94ff3\",\"serverless_deploy_railway简介.md\":\"dc2e0101\",\"serverless_deploy_surge简介.md\":\"e78373b8\",\"serverless_deploy_vercel简介.md\":\"e4b95adb\",\"f2e_bundle_vitest简介.md\":\"0e92b78d\",\"serverless_deploy_zeabur简介.md\":\"0d1dddc5\",\"serverless_deploy_cloudflare简介.md\":\"e3635496\",\"serverless_service_云函数简介.md\":\"8cd0313f\",\"serverless_service_低代码简介.md\":\"64b36ec7\",\"serverless_service_云计算简介.md\":\"5c105eae\",\"serverless_system_docker简介.md\":\"1a7c559d\",\"serverless_system_linux简介.md\":\"b482e26e\",\"serverless_system_linux配置docker环境.md\":\"bea86d32\",\"f2e_vue_petite-vue_简介.md\":\"a41bf15b\",\"f2e_html_webcomponent简介.md\":\"823d2fde\",\"f2e_vue_vue2_vue2基础知识.md\":\"e55ad622\",\"serverless_system_nginx简介.md\":\"aa9c5bf0\",\"serverless_system_nginx配置.md\":\"dd538040\",\"f2e_vue_vue2_vue2高级知识.md\":\"50fd9838\",\"serverless_system_woiden免费vps.md\":\"31d4cce3\",\"f2e_bundle_vite-plugin-mock.md\":\"c5c1bade\",\"f2e_vue_vue2_虚拟列表.md\":\"005cf769\",\"f2e_vue_vue3_mitt事件发布监听.md\":\"ddadd9dc\",\"f2e_bundle_vite-plugin-mini-i18n.md\":\"e23bf23e\",\"f2e_wechat_index.md\":\"c3d60291\",\"tool_efficiency_httpie简介.md\":\"e20df9d1\",\"f2e_vue_vue3_vite-tsx.md\":\"da423a79\",\"f2e_wechat_taro简介.md\":\"314f53da\",\"index.md\":\"96deaf13\",\"phone_oc_index.md\":\"531b2966\",\"tool_efficiency_nvm简介.md\":\"1a6d9b70\",\"f2e_css_选择器.md\":\"953a34e5\",\"tool_efficiency_nrm简介.md\":\"0e64ebe6\",\"phone_oc_wkwebview.md\":\"ef3be742\",\"backend_rust_bracket-lib.md\":\"af8d265b\",\"backend_rust_跨平台框架dioxus.md\":\"a5206c14\",\"backend_express_express_socket.md\":\"e5e8cdca\",\"backend_rust_web框架axum.md\":\"986e1f59\",\"serverless_deploy_render简介.md\":\"0c691a3b\",\"phone_oc_simpleping.md\":\"cf9f3d5e\",\"backend_rust_web框架rocket.md\":\"baa5feac\",\"f2e_vue_vue3_vite.md\":\"0bb2bb83\",\"f2e_vue_vue3_vue3基础知识.md\":\"edabf558\",\"f2e_bundle_vite-postcss插件简介.md\":\"48c62eac\",\"f2e_vue_vue3_vue3_electron简介.md\":\"37753fa5\",\"f2e_vue_vue3_vue3高级知识.md\":\"82b62272\",\"f2e_vue_vue3_vueuse简介.md\":\"be216d04\",\"f2e_harmonyos_index.md\":\"1aa1878f\",\"backend_rust_rust简介.md\":\"a7a449db\",\"f2e_html_简介.md\":\"02b7ab31\",\"f2e_css_media媒体查询.md\":\"b34979e7\",\"serverless_index.md\":\"5ba6f2f2\",\"f2e_bundle_rollup打包.md\":\"50735dc5\",\"f2e_html_canvas简介.md\":\"c5e1f587\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"MZ's 技术指南\",\"description\":\"MZ的技术指南, 记录学习及日常使用\",\"base\":\"/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"siteTitle\":\"MZ's 技术指南\",\"logo\":\"/logo.png\",\"outline\":\"deep\",\"nav\":[{\"text\":\"首页\",\"link\":\"/\"},{\"text\":\"AI\",\"activeMatch\":\"/ai/\",\"items\":[{\"text\":\"免费AI平台\",\"items\":[{\"text\":\"免费可用AI工具\",\"link\":\"/ai/免费可用AI工具\"}]},{\"text\":\"AI机器学习\",\"items\":[{\"text\":\"AI机器学习\",\"link\":\"/ai/AI机器学习\"}]}]},{\"text\":\"移动端\",\"activeMatch\":\"/phone/\",\"items\":[{\"text\":\"Objective-C/C++\",\"items\":[{\"text\":\"Objective-C\",\"link\":\"/phone/oc/\"}]},{\"text\":\"Swift\",\"items\":[{\"text\":\"Swift\",\"link\":\"/phone/swift/\"}]}]},{\"text\":\"前端\",\"activeMatch\":\"/f2e/\",\"items\":[{\"text\":\"前端基础\",\"items\":[{\"text\":\"HTML/HTML5\",\"link\":\"/f2e/html/\"},{\"text\":\"CSS/CSS3\",\"link\":\"/f2e/css/\"},{\"text\":\"JavaScript/TypeScript\",\"link\":\"/f2e/script/js/\"}]},{\"text\":\"前端框架\",\"items\":[{\"text\":\"Vue2/Vue3\",\"link\":\"/f2e/vue/vue3/vue3基础知识.md\"},{\"text\":\"Nuxt3\",\"link\":\"/f2e/vue/nuxt/nuxt3简介.md\"},{\"text\":\"React\",\"link\":\"/f2e/react/\"},{\"text\":\"Svelte\",\"link\":\"/f2e/svelte/\"},{\"text\":\"Solid\",\"link\":\"/f2e/solid/\"},{\"text\":\"微信小程序\",\"link\":\"/f2e/wechat/\"},{\"text\":\"鸿蒙系统\",\"link\":\"/f2e/harmonyOS/\"}]},{\"text\":\"打包工具\",\"items\":[{\"text\":\"unbuild\",\"link\":\"/f2e/bundle/unbuild打包.md\"},{\"text\":\"tsup\",\"link\":\"/f2e/bundle/tsup打包.md\"},{\"text\":\"Vite\",\"link\":\"/f2e/bundle/vite简介.md\"}]}]},{\"text\":\"后端\",\"activeMatch\":\"/backend/\",\"items\":[{\"text\":\"NodeJS\",\"items\":[{\"text\":\"NodeJS\",\"link\":\"/backend/nodejs/nodejs简介.md\"},{\"text\":\"Express\",\"link\":\"/backend/express/express简介.md\"}]},{\"text\":\"Python\",\"items\":[{\"text\":\"Python2/Python3\",\"link\":\"https://gitee.com/geeksdidi\"}]},{\"text\":\"Golang\",\"items\":[{\"text\":\"Gitee\",\"link\":\"https://gitee.com/geeksdidi\"}]},{\"text\":\"Rust\",\"items\":[{\"text\":\"Rust\",\"link\":\"/backend/rust/rust简介.md\"}]}]},{\"text\":\"云服务\",\"activeMatch\":\"/serverless/\",\"items\":[{\"text\":\"云计算\",\"items\":[{\"text\":\"云计算简介\",\"link\":\"/serverless/service/云计算简介\"},{\"text\":\"其他\",\"link\":\"/serverless/service/云函数简介\"}]},{\"text\":\"云部署\",\"items\":[{\"text\":\"Vercel\",\"link\":\"/serverless/deploy/Vercel简介\"},{\"text\":\"Cloudflare\",\"link\":\"/serverless/deploy/cloudflare简介\"},{\"text\":\"其他\",\"link\":\"/serverless/deploy/Replit简介\"}]},{\"text\":\"操作系统|服务器|容器\",\"items\":[{\"text\":\"Linux\",\"link\":\"/serverless/system/linux简介\"},{\"text\":\"Nginx\",\"link\":\"/serverless/system/nginx简介\"}]}]},{\"text\":\"软件工具\",\"activeMatch\":\"/tool/\",\"items\":[{\"text\":\"网站导航\",\"items\":[{\"text\":\"网站导航\",\"link\":\"/tool/site/\"}]},{\"text\":\"编程软件\",\"items\":[{\"text\":\"VSCode\",\"link\":\"/tool/vscode/\"}]},{\"text\":\"效率提升\",\"items\":[{\"text\":\"pnpm\",\"link\":\"/tool/efficiency/pnp简介.md\"},{\"text\":\"nvm\",\"link\":\"/tool/efficiency/nvm简介.md\"},{\"text\":\"nrm\",\"link\":\"/tool/efficiency/nrm简介.md\"}]}]}],\"sidebar\":{\"/ai/\":[{\"text\":\"AI工具\",\"collapsed\":false,\"items\":[{\"text\":\"1、免费可用AI工具整理\",\"link\":\"/ai/免费可用AI工具.md\"},{\"text\":\"2、其他AI整理\",\"link\":\"/ai/其他整理.md\"}]},{\"text\":\"AI机器学习\",\"collapsed\":false,\"items\":[{\"text\":\"1、AI机器学习\",\"link\":\"/ai/AI机器学习.md\"}]}],\"/phone/\":[{\"text\":\"移动端/Objective-C\",\"collapsed\":false,\"items\":[{\"text\":\"1、Objective-C/C++简介\",\"link\":\"/phone/oc/\"},{\"text\":\"2、WKWebView简介\",\"link\":\"/phone/oc/wkwebview.md\"},{\"text\":\"3、开发实用技巧\",\"link\":\"/phone/oc/开发实用技巧.md\"},{\"text\":\"4、SimplePing\",\"link\":\"/phone/oc/simpleping.md\"}]},{\"text\":\"移动端/Swift\",\"collapsed\":false,\"items\":[{\"text\":\"Swift\",\"link\":\"/phone/swift/\"}]}],\"/serverless/service/\":[{\"text\":\"云计算\",\"collapsed\":false,\"items\":[{\"text\":\"1、云计算简介\",\"link\":\"/serverless/service/云计算简介.md\"},{\"text\":\"2、低代码简介\",\"link\":\"/serverless/service/低代码简介.md\"}]},{\"text\":\"云函数\",\"collapsed\":false,\"items\":[{\"text\":\"1、云函数简介\",\"link\":\"/serverless/service/云函数简介.md\"}]}],\"/serverless/system/\":[{\"text\":\"操作系统\",\"collapsed\":false,\"items\":[{\"text\":\"1、Linux简介\",\"link\":\"/serverless/system/linux简介.md\"},{\"text\":\"2、Linux配置Docker环境\",\"link\":\"/serverless/system/linux配置docker环境.md\"}]},{\"text\":\"服务器\",\"collapsed\":false,\"items\":[{\"text\":\"1、Nginx简介\",\"link\":\"/serverless/system/nginx简介.md\"},{\"text\":\"2、Nginx配置.md\",\"link\":\"/serverless/system/nginx配置.md\"},{\"text\":\"3、Woiden免费VPS服务器\",\"link\":\"/serverless/system/woiden免费vps.md\"}]},{\"text\":\"Docker\",\"collapsed\":false,\"items\":[{\"text\":\"1、Docker简介\",\"link\":\"/serverless/system/docker简介.md\"}]}],\"/serverless/deploy/\":[{\"text\":\"三方部署平台\",\"collapsed\":false,\"items\":[{\"text\":\"1、Vercel简介\",\"link\":\"/serverless/deploy/Vercel简介.md\"},{\"text\":\"2、Netlify简介\",\"link\":\"/serverless/deploy/Netlify简介.md\"},{\"text\":\"3、Replit简介\",\"link\":\"/serverless/deploy/Replit简介.md\"},{\"text\":\"4、Surge简介\",\"link\":\"/serverless/deploy/Surge简介.md\"},{\"text\":\"5、Glitch简介\",\"link\":\"/serverless/deploy/Glitch简介.md\"},{\"text\":\"6、Zeabur简介\",\"link\":\"/serverless/deploy/Zeabur简介.md\"},{\"text\":\"7、Render简介\",\"link\":\"/serverless/deploy/Render简介.md\"},{\"text\":\"8、Railway简介\",\"link\":\"/serverless/deploy/Railway简介.md\"},{\"text\":\"9、Heroku简介\",\"link\":\"/serverless/deploy/Heroku简介.md\"}]},{\"text\":\"CDN & DNS\",\"collapsed\":false,\"items\":[{\"text\":\"1、Cloudflare简介\",\"link\":\"/serverless/deploy/cloudflare简介.md\"}]}],\"/f2e/html/\":[{\"text\":\"HTML/HTML5\",\"collapsed\":false,\"items\":[{\"text\":\"1、HTML/HTML5简介\",\"link\":\"/f2e/html/index.md\"},{\"text\":\"2、Canvas简介\",\"link\":\"/f2e/html/canvas简介.md\"},{\"text\":\"3、WebComponent简介\",\"link\":\"/f2e/html/webComponent简介.md\"}]}],\"/f2e/vue/\":[{\"text\":\"Vue3\",\"collapsed\":false,\"items\":[{\"text\":\"1、Vue3基础知识\",\"link\":\"/f2e/vue/vue3/vue3基础知识.md\"},{\"text\":\"2、Vue3高级知识\",\"link\":\"/f2e/vue/vue3/vue3高级知识.md\"},{\"text\":\"3、Vue3+Vite\",\"link\":\"/f2e/vue/vue3/vite.md\"},{\"text\":\"4、Vue3+Vite+TSX\",\"link\":\"/f2e/vue/vue3/vite-tsx.md\"},{\"text\":\"5、Mitt事件发布监听\",\"link\":\"/f2e/vue/vue3/mitt事件发布监听.md\"},{\"text\":\"6、VueUse简介\",\"link\":\"/f2e/vue/vue3/vueUse简介.md\"},{\"text\":\"7、Vue3+Electron简介\",\"link\":\"/f2e/vue/vue3/vue3+electron简介.md\"}]},{\"text\":\"Vue2\",\"collapsed\":false,\"items\":[{\"text\":\"1、Vue2基础知识\",\"link\":\"/f2e/vue/vue2/vue2基础知识.md\"},{\"text\":\"2、Vue2高级知识\",\"link\":\"/f2e/vue/vue2/vue2高级知识.md\"},{\"text\":\"3、虚拟列表\",\"link\":\"/f2e/vue/vue2/虚拟列表.md\"}]},{\"text\":\"Petite-Vue\",\"collapsed\":false,\"items\":[{\"text\":\"1、Petite-Vue简介\",\"link\":\"/f2e/vue/petite-vue/简介.md\"}]},{\"text\":\"Nuxt3\",\"collapsed\":false,\"items\":[{\"text\":\"1、Nuxt简介\",\"link\":\"/f2e/vue/nuxt/nuxt3简介.md\"}]},{\"text\":\"Nuxt.JS\",\"collapsed\":false,\"items\":[{\"text\":\"1、NuxtJS简介\",\"link\":\"/f2e/vue/nuxtjs/nuxtjs简介.md\"}]}],\"/f2e/bundle\":[{\"text\":\"打包工具\",\"collapsed\":false,\"items\":[{\"text\":\"1、unbuild\",\"link\":\"/f2e/bundle/unbuild打包.md\"},{\"text\":\"2、tsup\",\"link\":\"/f2e/bundle/tsup打包.md\"},{\"text\":\"3、rollup\",\"link\":\"/f2e/bundle/rollup打包.md\"},{\"text\":\"4、esbuild\",\"link\":\"/f2e/bundle/esbuild打包.md\"}]},{\"text\":\"Vite\",\"collapsed\":false,\"items\":[{\"text\":\"1、Vite简介\",\"link\":\"/f2e/bundle/vite简介.md\"},{\"text\":\"2、Vite Plugin简介\",\"link\":\"/f2e/bundle/vite-plugin简介.md\"},{\"text\":\"3、Vite-Plugin-Mock简介\",\"link\":\"/f2e/bundle/vite-plugin-mock.md\"},{\"text\":\"4、Vite-Plugin-Mini-I18n简介\",\"link\":\"/f2e/bundle/vite-plugin-mini-i18n.md\"}]},{\"text\":\"Vitest测试框架\",\"collapsed\":false,\"items\":[{\"text\":\"1、Vitest简介\",\"link\":\"/f2e/bundle/vitest简介.md\"}]}],\"/f2e/css/\":[{\"text\":\"CSS/CSS3核心内容\",\"collapsed\":false,\"items\":[{\"text\":\"1、CSS/CSS3简介\",\"link\":\"/f2e/css/index.md\"},{\"text\":\"2、选择器\",\"link\":\"/f2e/css/选择器.md\"},{\"text\":\"3、transition和animation动画\",\"link\":\"/f2e/css/transition和animation动画.md\"},{\"text\":\"4、media媒体查询\",\"link\":\"/f2e/css/media媒体查询.md\"}]},{\"text\":\"CSS/CSS3案例\",\"collapsed\":false,\"items\":[{\"text\":\"1、不同设备展示1px\",\"link\":\"/f2e/css/1px.md\"},{\"text\":\"2、css开发小技巧\",\"link\":\"/f2e/css/css开发小技巧.md\"}]}],\"/f2e/script/\":[{\"text\":\"JavaScript\",\"collapsed\":false,\"items\":[{\"text\":\"1、JavaScript简介\",\"link\":\"/f2e/script/js/index.md\"},{\"text\":\"2、XHR简介\",\"link\":\"/f2e/script/js/xhr简介.md\"},{\"text\":\"3、开发实用技巧\",\"link\":\"/f2e/script/js/开发实用技巧.md\"},{\"text\":\"4、gasp动画库\",\"link\":\"/f2e/script/js/gasp动画库.md\"}]},{\"text\":\"TypeScript\",\"collapsed\":false,\"items\":[{\"text\":\"1、TypeScript简介\",\"link\":\"/f2e/script/ts/index.md\"},{\"text\":\"2、Typescript订阅监听\",\"link\":\"/f2e/script/ts/typescript订阅监听.md\"},{\"text\":\"3、Typescript进阶\",\"link\":\"/f2e/script/ts/typescript进阶.md\"},{\"text\":\"4、Typescript实用开发技巧\",\"link\":\"/f2e/script/ts/开发实用技巧.md\"}]}],\"/f2e/wechat/\":[{\"text\":\"微信小程序\",\"collapsed\":false,\"items\":[{\"text\":\"1、微信小程序简介\",\"link\":\"/f2e/wechat/index.md\"}]},{\"text\":\"Taro\",\"collapsed\":false,\"items\":[{\"text\":\"1、Taro简介\",\"link\":\"/f2e/wechat/taro简介.md\"}]}],\"/f2e/harmonyOS/\":[{\"text\":\"HarmonyOS\",\"collapsed\":false,\"items\":[{\"text\":\"1、鸿蒙OS基础\",\"link\":\"/f2e/harmonyOS/index.md\"}]}],\"/tool/vscode/\":[{\"text\":\"VSCode\",\"collapsed\":false,\"items\":[{\"text\":\"1、VSCode简介\",\"link\":\"/tool/vscode/index.md\"},{\"text\":\"2、常用扩展插件\",\"link\":\"/tool/vscode/常用扩展插件.md\"},{\"text\":\"3、devContainer容器\",\"link\":\"/tool/vscode/devContainer容器.md\"}]}],\"/tool/efficiency/\":[{\"text\":\"终端工具\",\"collapsed\":false,\"items\":[{\"text\":\"1、pnpm简介\",\"link\":\"/tool/efficiency/pnpm简介.md\"},{\"text\":\"2、pnpm monorepo\",\"link\":\"/tool/efficiency/pnpm-monorepo.md\"},{\"text\":\"3、nvm简介\",\"link\":\"/tool/efficiency/nvm简介.md\"},{\"text\":\"4、nrm简介\",\"link\":\"/tool/efficiency/nrm简介.md\"}]}],\"/backend/nodejs/\":[{\"text\":\"NodeJS\",\"collapsed\":false,\"items\":[{\"text\":\"1、NodeJS简介\",\"link\":\"/backend/nodejs/nodejs简介.md\"},{\"text\":\"2、Node + TS简介\",\"link\":\"/backend/nodejs/nodejs+ts.md\"},{\"text\":\"3、搭建npm私服\",\"link\":\"/backend/nodejs/搭建npm私服.md\"},{\"text\":\"4、实用小工具\",\"link\":\"/backend/nodejs/实用小工具.md\"}]}],\"/backend/express/\":[{\"text\":\"Express\",\"collapsed\":false,\"items\":[{\"text\":\"1、Express简介\",\"link\":\"/backend/express/express简介.md\"},{\"text\":\"2、Express+Socket\",\"link\":\"/backend/express/express+socket.md\"}]}],\"/backend/rust/\":[{\"text\":\"Rust\",\"collapsed\":false,\"items\":[{\"text\":\"1、Rust简介\",\"link\":\"/backend/rust/rust简介.md\"},{\"text\":\"2、Rust进阶\",\"link\":\"/backend/rust/rust进阶.md\"},{\"text\":\"3、Rust开发案例\",\"link\":\"/backend/rust/开发案例.md\"},{\"text\":\"4、Rust实用工具\",\"link\":\"/backend/rust/实用工具.md\"},{\"text\":\"5、常用三方库\",\"link\":\"/backend/rust/常用三方库.md\"},{\"text\":\"6、开发技巧及注意事项\",\"link\":\"/backend/rust/开发技巧及注意事项.md\"}]},{\"text\":\"Rust框架\",\"collapsed\":false,\"items\":[{\"text\":\"1、Tauri桌面端应用\",\"link\":\"/backend/rust/tauri桌面端应用.md\"},{\"text\":\"2、web框架actix-web\",\"link\":\"/backend/rust/actix-web.md\"},{\"text\":\"3、web框架rocket\",\"link\":\"/backend/rust/web框架rocket.md\"},{\"text\":\"4、web框架warp\",\"link\":\"/backend/rust/web框架warp.md\"},{\"text\":\"5、web框架axum\",\"link\":\"/backend/rust/web框架axum.md\"},{\"text\":\"6、跨平台框架Dioxus\",\"link\":\"/backend/rust/跨平台框架Dioxus.md\"},{\"text\":\"7、游戏框架bracket-lib\",\"link\":\"/backend/rust/bracket-lib.md\"},{\"text\":\"8、wasm框架\",\"link\":\"/backend/rust/webAssembly简介.md\"}]}]},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/misterZhouZhou\"}],\"footer\":{\"message\":\"Released under the MIT License.\",\"copyright\":\"Copyright © 2023 MZ, All rights reserved.\"},\"search\":{\"provider\":\"local\"}},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":true}");</script>
    
  </body>
</html>