import{_ as s,o as a,c as n,X as l}from"./chunks/framework.28451963.js";const i=JSON.parse('{"title":"开发实用技巧","description":"","frontmatter":{},"headers":[],"relativePath":"phone/oc/开发实用技巧.md","filePath":"phone/oc/开发实用技巧.md","lastUpdated":1704191114000}'),p={name:"phone/oc/开发实用技巧.md"},o=l(`<h1 id="开发实用技巧" tabindex="-1">开发实用技巧 <a class="header-anchor" href="#开发实用技巧" aria-label="Permalink to &quot;开发实用技巧&quot;">​</a></h1><h2 id="_1、label展示两行超出" tabindex="-1">1、label展示两行超出... <a class="header-anchor" href="#_1、label展示两行超出" aria-label="Permalink to &quot;1、label展示两行超出...&quot;">​</a></h2><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">UILabel</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span><span style="color:#C3E88D;">titleLab</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> [[UILabel </span><span style="color:#C3E88D;">alloc]</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">initWithFrame:CGRectMake</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">0,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">100</span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200</span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">40</span><span style="color:#89DDFF;">)</span><span style="color:#C3E88D;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#FFCB6B;">titleLab.numberOfLines</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#FFCB6B;">titleLab.lineBreakMode</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">NSLineBreakByTruncatingTail</span><span style="color:#89DDFF;">;</span></span></code></pre></div><h2 id="_2、tableview滚动到顶部生效" tabindex="-1">2、tableView滚动到顶部生效 <a class="header-anchor" href="#_2、tableview滚动到顶部生效" aria-label="Permalink to &quot;2、tableView滚动到顶部生效&quot;">​</a></h2><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">self.tableView reloadData</span><span style="color:#89DDFF;">];</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">self.tableView layoutIfNeeded</span><span style="color:#89DDFF;">];</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">//这句是关键</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">self.tableView setContentOffset:CGPointMake(</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">,0) animated:NO</span><span style="color:#89DDFF;">];</span></span></code></pre></div><h2 id="_3、静音状态下播放音频" tabindex="-1">3、静音状态下播放音频 <a class="header-anchor" href="#_3、静音状态下播放音频" aria-label="Permalink to &quot;3、静音状态下播放音频&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><ul><li>静音状态下播放音频需要开启权限</li><li>使用<code>AVAudioPlayer</code>播放， 使用<code>AudioServicesPlaySystemSound</code>播放无声音</li></ul></div><p>开启静音播放</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">#pragma mark - app保持后台静音播放声音</span></span>
<span class="line"><span style="color:#FFCB6B;">-</span><span style="color:#A6ACCD;"> (void)appKeepAVAudioActive </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">[[</span><span style="color:#A6ACCD;">AVAudioSession sharedInstance</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> setCategory:AVAudioSessionCategoryPlayback withOptions:AVAudioSessionCategoryOptionAllowBluetooth error:nil</span><span style="color:#89DDFF;">];</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">[[</span><span style="color:#A6ACCD;">AVAudioSession sharedInstance</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> setActive:YES error:nil</span><span style="color:#89DDFF;">];</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>播放声音</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">NSString</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span><span style="color:#C3E88D;">bundlePath</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> [[ </span><span style="color:#C3E88D;">NSBundle</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mainBundle]</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pathForResource:@</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">bundleName</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ofType</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">:@</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">bundle</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#FFCB6B;">NSBundle</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span><span style="color:#C3E88D;">bundle</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> [NSBundle </span><span style="color:#C3E88D;">bundleWithPath:bundlePath]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#FFCB6B;">NSString</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span><span style="color:#C3E88D;">voicePath</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> [bundle </span><span style="color:#C3E88D;">pathForResource:[NSString</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">stringWithFormat:@</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">mp3/%@</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">,name]</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ofType:@</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">mp3</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#FFCB6B;">NSURL</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span><span style="color:#C3E88D;">filePath</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> [NSURL </span><span style="color:#C3E88D;">fileURLWithPath:voicePath</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">isDirectory:NO]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#FFCB6B;">NSError</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span><span style="color:#C3E88D;">error</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#FFCB6B;">AVAudioPlayer</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span><span style="color:#C3E88D;">audioPlayer</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> [[AVAudioPlayer </span><span style="color:#C3E88D;">alloc]initWithContentsOfURL:filePath</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">error:</span><span style="color:#89DDFF;">&amp;</span><span style="color:#FFCB6B;">error]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">error</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">audioPlayer prepareToPlay</span><span style="color:#89DDFF;">];</span></span>
<span class="line"><span style="color:#FFCB6B;">//获取系统音量</span></span>
<span class="line"><span style="color:#FFCB6B;">AVAudioSession</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span><span style="color:#C3E88D;">audioSession</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> [AVAudioSession </span><span style="color:#C3E88D;">sharedInstance]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#FFCB6B;">CGFloat</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">volume</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">audioSession.outputVolume</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#FFCB6B;">audioPlayer.volume</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">volume</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">audioPlayer play</span><span style="color:#89DDFF;">];</span></span></code></pre></div><p>退出取消</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[[</span><span style="color:#A6ACCD;">UIApplication sharedApplication] endReceivingRemoteControlEvents]</span><span style="color:#89DDFF;">;</span></span></code></pre></div><h2 id="_4、app保持常亮" tabindex="-1">4、app保持常亮 <a class="header-anchor" href="#_4、app保持常亮" aria-label="Permalink to &quot;4、app保持常亮&quot;">​</a></h2><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">#pragma mark - app保持常亮</span></span>
<span class="line"><span style="color:#FFCB6B;">-</span><span style="color:#A6ACCD;"> (void)appKeepLight </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">[[</span><span style="color:#A6ACCD;">UIApplication sharedApplication</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> setIdleTimerDisabled:YES</span><span style="color:#89DDFF;">];</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">[[</span><span style="color:#A6ACCD;">UIScreen mainScreen</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> setBrightness:0.5</span><span style="color:#89DDFF;">];</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">#pragma mark - app退出</span></span>
<span class="line"><span style="color:#FFCB6B;">-(void</span><span style="color:#A6ACCD;">)appTerminate </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">[[</span><span style="color:#A6ACCD;">UIApplication sharedApplication</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> setIdleTimerDisabled:NO</span><span style="color:#89DDFF;">];</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h2 id="_5、app保持后台" tabindex="-1">5、app保持后台 <a class="header-anchor" href="#_5、app保持后台" aria-label="Permalink to &quot;5、app保持后台&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>setMinimumBackgroundFetchInterval()是iOS中设置App在后台最小获取新数据时间间隔的方法。</p></div><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">#pragma mark - app保持后台</span></span>
<span class="line"><span style="color:#FFCB6B;">-</span><span style="color:#A6ACCD;"> (void)appKeepBackground </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">[[</span><span style="color:#A6ACCD;">UIApplication sharedApplication</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> setMinimumBackgroundFetchInterval:UIApplicationBackgroundFetchIntervalMinimum</span><span style="color:#89DDFF;">];</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h2 id="_6、设置屏幕亮度" tabindex="-1">6、设置屏幕亮度 <a class="header-anchor" href="#_6、设置屏幕亮度" aria-label="Permalink to &quot;6、设置屏幕亮度&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>参数范围<code>0-1.0</code></p></div><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[[</span><span style="color:#A6ACCD;">UIScreen mainScreen] setBrightness:0.5]</span><span style="color:#89DDFF;">;</span></span></code></pre></div><h2 id="_7、极光推送" tabindex="-1">7、极光推送 <a class="header-anchor" href="#_7、极光推送" aria-label="Permalink to &quot;7、极光推送&quot;">​</a></h2><h3 id="_7-1、极光推送自定义提示音" tabindex="-1">7.1、极光推送自定义提示音 <a class="header-anchor" href="#_7-1、极光推送自定义提示音" aria-label="Permalink to &quot;7.1、极光推送自定义提示音&quot;">​</a></h3><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>系统静音状态下，极光推送声音无法播放声音</p></div><p>1、在项目根目录下新建<code>push_sound.caf</code>文件</p><p>2、在极光发送推送通知时，只需配置<code>sound</code>字段的值为导入到工程中的音频文件名，这里即就是 <code>push_sound.caf</code></p><h2 id="_8、webview白屏检测" tabindex="-1">8、webview白屏检测 <a class="header-anchor" href="#_8、webview白屏检测" aria-label="Permalink to &quot;8、webview白屏检测&quot;">​</a></h2><p><a href="https://www.cnblogs.com/qfww/p/13863789.html" target="_blank" rel="noreferrer">https://www.cnblogs.com/qfww/p/13863789.html</a></p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">typedef</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">NS_ENUM</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">NSUInteger,webviewLoadingStatus</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">WebViewNormalStatus</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">//正常</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">WebViewErrorStatus,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">//白屏</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">WebViewPendStatus,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">//待决</span></span>
<span class="line"><span style="color:#A6ACCD;">};</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">//</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">判断是否白屏</span></span>
<span class="line"><span style="color:#FFCB6B;">-</span><span style="color:#A6ACCD;"> (void)judgeLoadingStatus:</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">WKWebview</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">webview  withBlock:</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">void</span><span style="color:#A6ACCD;"> (^</span><span style="color:#89DDFF;">)(</span><span style="color:#FFCB6B;">webviewLoadingStatus</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">status</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">)completionBlock{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">webviewLoadingStatus</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">__block</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">status</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">WebViewPendStatus</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">@available(iOS</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">11.0</span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">webview</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">webview isKindOfClass:</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">WKWebView class</span><span style="color:#89DDFF;">]])</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#FFCB6B;">CGFloat</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">statusBarHeight</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;">  [[UIApplication </span><span style="color:#C3E88D;">sharedApplication]</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">statusBarFrame].size.height</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">//状态栏高度</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#FFCB6B;">CGFloat</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">navigationHeight</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">webview.viewController.navigationController.navigationBar.frame.size.height</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">//导航栏高度</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#FFCB6B;">WKSnapshotConfiguration</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span><span style="color:#C3E88D;">shotConfiguration</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> [[WKSnapshotConfiguration </span><span style="color:#C3E88D;">alloc]</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">init]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#FFCB6B;">shotConfiguration.rect</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">CGRectMake</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">0,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">statusBarHeight</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">navigationHeight,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">webview.bounds.size.width,</span><span style="color:#A6ACCD;"> (webview.bounds.size.height </span><span style="color:#C3E88D;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">navigationHeight</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">statusBarHeight</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">//仅截图检测导航栏以下部分内容</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">webview takeSnapshotWithConfiguration:shotConfiguration completionHandler:^(UIImage </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> _Nullable snapshotImage, NSError </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> _Nullable error) {</span></span>
<span class="line"><span style="color:#A6ACCD;">                dispatch_async(dispatch_get_global_queue(</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">), ^{</span></span>
<span class="line"><span style="color:#A6ACCD;">                  if (snapshotImage) {</span></span>
<span class="line"><span style="color:#A6ACCD;">                      // 对图片进行缩放</span></span>
<span class="line"><span style="color:#A6ACCD;">                      UIImage </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">scaleImage </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">self scaleImage:snapshotImage</span><span style="color:#89DDFF;">];</span></span>
<span class="line"><span style="color:#A6ACCD;">                      // 白屏检测, 在主线程会卡线程</span></span>
<span class="line"><span style="color:#A6ACCD;">                      BOOL isWhiteScreen </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">self searchEveryPixel:scaleImage rgb:rgb proportion:proportion</span><span style="color:#89DDFF;">];</span></span>
<span class="line"><span style="color:#A6ACCD;">                      if (isWhiteScreen) { // 白屏</span></span>
<span class="line"><span style="color:#A6ACCD;">                          status </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> WKWebViewErrorStatus</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                      }else{</span></span>
<span class="line"><span style="color:#A6ACCD;">                          status </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> WKWebViewNormalStatus</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                      }</span></span>
<span class="line"><span style="color:#A6ACCD;">                  }</span></span>
<span class="line"><span style="color:#A6ACCD;">                  dispatch_async(dispatch_get_main_queue(), ^{</span></span>
<span class="line"><span style="color:#A6ACCD;">                      //回到主线程，执行UI刷新操作</span></span>
<span class="line"><span style="color:#A6ACCD;">                      if (completionBlock) {</span></span>
<span class="line"><span style="color:#A6ACCD;">                        completionBlock(status)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                      }</span></span>
<span class="line"><span style="color:#A6ACCD;">                  })</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">              })</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">            }</span><span style="color:#89DDFF;">];</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">//</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">遍历像素点</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">白色像素占比大于95%认定为白屏</span></span>
<span class="line"><span style="color:#FFCB6B;">-</span><span style="color:#A6ACCD;"> (BOOL)searchEveryPixel:</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">UIImage</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">image </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">CGImageRef</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">cgImage</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> [image </span><span style="color:#C3E88D;">CGImage]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">size_t</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">width</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">CGImageGetWidth</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">cgImage</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">size_t</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">height</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">CGImageGetHeight</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">cgImage</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">size_t</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">bytesPerRow</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">CGImageGetBytesPerRow</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">cgImage</span><span style="color:#89DDFF;">);</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">//每个像素点包含r</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">g</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">b</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">四个字节</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">size_t</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">bitsPerPixel</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">CGImageGetBitsPerPixel</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">cgImage</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">CGDataProviderRef</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">dataProvider</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">CGImageGetDataProvider</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">cgImage</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">CFDataRef</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">data</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">CGDataProviderCopyData</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">dataProvider</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">UInt8</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">buffer</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> (UInt8*)CFDataGetBytePtr</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">data</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">whiteCount</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">totalCount</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">j</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">j</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">height</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">j</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">++</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">i</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">width</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">++</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#FFCB6B;">UInt8</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pt</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">buffer</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">j</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">bytesPerRow</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">i</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span><span style="color:#A6ACCD;"> (bitsPerPixel </span><span style="color:#C3E88D;">/</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">8</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#FFCB6B;">UInt8</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">red</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pt</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#FFCB6B;">UInt8</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">green</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">pt</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#FFCB6B;">UInt8</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">blue</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">pt</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#FFCB6B;">//</span><span style="color:#A6ACCD;">            </span><span style="color:#C3E88D;">UInt8</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">alpha</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">pt</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#FFCB6B;">totalCount</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">++</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">red</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">255</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">green</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">255</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">blue</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">255</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#FFCB6B;">whiteCount</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">++</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">float</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">proportion</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> (float)whiteCount / totalCount </span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">NSLog(@</span><span style="color:#FFCB6B;">&quot;当前像素点数：%d,白色像素点数:%d , 占比: %f&quot;</span><span style="color:#FFCB6B;">,totalCount</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">whiteCount</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">proportion</span><span style="color:#A6ACCD;"> )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">proportion</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.95</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">YES</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">else{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">NO</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">//缩放图片</span></span>
<span class="line"><span style="color:#FFCB6B;">-</span><span style="color:#A6ACCD;"> (UIImage </span><span style="color:#A6ACCD;">*</span><span style="color:#A6ACCD;">)scaleImage: </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">UIImage</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">image </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">CGFloat</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">scale</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.2</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">CGSize</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">newsize</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">newsize.width</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">floor</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">image.size.width</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">scale</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">newsize.height</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">floor</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">image.size.height</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">scale</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">@available(iOS</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10.0</span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">UIGraphicsImageRenderer</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">renderer</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> [[UIGraphicsImageRenderer </span><span style="color:#C3E88D;">alloc]</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">initWithSize:newsize]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> [renderer </span><span style="color:#C3E88D;">imageWithActions:^</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">UIGraphicsImageRendererContext</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">_Nonnull</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rendererContext</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">image drawInRect:CGRectMake(</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">, newsize.width, newsize.height)</span><span style="color:#89DDFF;">];</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    }else{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">image</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre></div><h2 id="_9、多线程" tabindex="-1">9、多线程 <a class="header-anchor" href="#_9、多线程" aria-label="Permalink to &quot;9、多线程&quot;">​</a></h2><h3 id="_9-1、异步处理主线程刷新" tabindex="-1">9.1、异步处理主线程刷新 <a class="header-anchor" href="#_9-1、异步处理主线程刷新" aria-label="Permalink to &quot;9.1、异步处理主线程刷新&quot;">​</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">dispatch_async(dispatch_get_global_queue(0,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">), ^{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">//执行耗时的异步操作..</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">dispatch_async(dispatch_get_main_queue(</span><span style="color:#A6ACCD;">), ^{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">//回到主线程，执行UI刷新操作</span></span>
<span class="line"><span style="color:#A6ACCD;">    })</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">});</span></span></code></pre></div><h3 id="_9-2、" tabindex="-1">9.2、 <a class="header-anchor" href="#_9-2、" aria-label="Permalink to &quot;9.2、&quot;">​</a></h3><h2 id="_10、加载离线包" tabindex="-1">10、加载离线包 <a class="header-anchor" href="#_10、加载离线包" aria-label="Permalink to &quot;10、加载离线包&quot;">​</a></h2><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">NSString</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span><span style="color:#C3E88D;">basePath</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> [NSString </span><span style="color:#C3E88D;">stringWithFormat:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">@</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">%@/%@</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> [[NSBundle </span><span style="color:#C3E88D;">mainBundle]</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">bundlePath],</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">@</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">2.2.13</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#FFCB6B;">NSURL</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span><span style="color:#C3E88D;">baseUrl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> [NSURL </span><span style="color:#C3E88D;">fileURLWithPath:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">basePath</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">isDirectory:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">YES]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#FFCB6B;">NSString</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span><span style="color:#C3E88D;">filePath</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> [NSString </span><span style="color:#C3E88D;">stringWithFormat:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">@</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">file://%@/index.html#/page</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">basePath]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#FFCB6B;">NSURL</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span><span style="color:#C3E88D;">fileUrl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> [NSURL </span><span style="color:#C3E88D;">URLWithString:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">filePath]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">self.webview loadFileURL: fileUrl allowingReadAccessToURL: baseUrl</span><span style="color:#89DDFF;">];</span></span></code></pre></div>`,36),e=[o];function t(c,r,C,D,y,A){return a(),n("div",null,e)}const h=s(p,[["render",t]]);export{i as __pageData,h as default};
