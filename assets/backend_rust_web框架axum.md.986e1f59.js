import{_ as s,o as n,c as a,X as l}from"./chunks/framework.28451963.js";const i=JSON.parse('{"title":"Axum简介","description":"","frontmatter":{},"headers":[],"relativePath":"backend/rust/web框架axum.md","filePath":"backend/rust/web框架axum.md","lastUpdated":1704191114000}'),p={name:"backend/rust/web框架axum.md"},o=l(`<h1 id="axum简介" tabindex="-1">Axum简介 <a class="header-anchor" href="#axum简介" aria-label="Permalink to &quot;Axum简介&quot;">​</a></h1><h2 id="_1、简介" tabindex="-1">1、简介 <a class="header-anchor" href="#_1、简介" aria-label="Permalink to &quot;1、简介&quot;">​</a></h2><p><code>Axum</code>是<code>tokio</code>官方出品的一个非常优秀的<code>web开发框架</code>, 以<code>tower</code>库的<code>Service trait</code>为基石, 它支持异步操作、消息传递、并行循环等，并且提供了一组丰富的库来处理常见的并发任务。Axum提供了一套机制来监视和管理系统的状态，并在出现错误或故障时采取适当的措施。</p><h2 id="_2、安装" tabindex="-1">2、安装 <a class="header-anchor" href="#_2、安装" aria-label="Permalink to &quot;2、安装&quot;">​</a></h2><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">cargo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">add</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">axum</span></span></code></pre></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">[dependencies]</span></span>
<span class="line"><span style="color:#A6ACCD;">axum </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">0.6.1</span><span style="color:#89DDFF;">&quot;</span></span></code></pre></div><h2 id="_3、使用" tabindex="-1">3、使用 <a class="header-anchor" href="#_3、使用" aria-label="Permalink to &quot;3、使用&quot;">​</a></h2><h3 id="_3-1、服务配置" tabindex="-1">3.1、服务配置 <a class="header-anchor" href="#_3-1、服务配置" aria-label="Permalink to &quot;3.1、服务配置&quot;">​</a></h3><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">std</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#FFCB6B;">net</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:SocketAddr</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">axum</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">Router</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">routing</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:get</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Server</span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[tokio::main]</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">addr</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">SocketAddr</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">from</span><span style="color:#F07178;">(([</span><span style="color:#F78C6C;">127</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">3000</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">app</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Router</span><span style="color:#F07178;">::</span><span style="color:#89DDFF;">new</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">route</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">async</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">Hello, World!</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">listening on {}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">addr</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">Server</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">:</span><span style="color:#82AAFF;">bind</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">addr</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">serve</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">into_make_service</span><span style="color:#F07178;">())</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h3 id="_3-2、请求方式" tabindex="-1">3.2、请求方式 <a class="header-anchor" href="#_3-2、请求方式" aria-label="Permalink to &quot;3.2、请求方式&quot;">​</a></h3><h4 id="_3-2-1、get" tabindex="-1">3.2.1、GET <a class="header-anchor" href="#_3-2-1、get" aria-label="Permalink to &quot;3.2.1、GET&quot;">​</a></h4><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> app </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Router::</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">route</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> async </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">Hello, index!</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">))</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">route</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/hello</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(hello_handler))</span></span></code></pre></div><h4 id="_3-2-2、post" tabindex="-1">3.2.2、POST <a class="header-anchor" href="#_3-2-2、post" aria-label="Permalink to &quot;3.2.2、POST&quot;">​</a></h4><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">#[</span><span style="color:#82AAFF;">derive</span><span style="color:#A6ACCD;">(Debug</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Serialize</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Deserialize)]</span></span>
<span class="line"><span style="color:#A6ACCD;">struct Todo </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">id</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">i32</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">title</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">String</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">completed</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">bool</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[</span><span style="color:#82AAFF;">derive</span><span style="color:#A6ACCD;">(Debug</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Serialize</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Deserialize)]</span></span>
<span class="line"><span style="color:#A6ACCD;">struct CrateTodo </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">title</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">String</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> app </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Router::</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">route</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/todos</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(todos_handler)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">post</span><span style="color:#A6ACCD;">(create_todos_handler))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// get /todos list</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">todos_handler</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> Json</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">Vec</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">Todo</span><span style="color:#89DDFF;">&gt;&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">Json</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">vec</span><span style="color:#A6ACCD;">!</span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#A6ACCD;font-style:italic;">Todo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#F07178;">id</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Todo 1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">.</span><span style="color:#A6ACCD;font-style:italic;">into</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#F07178;">completed</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">false</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">])</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// post /todos json</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">create_todos_handler</span><span style="color:#A6ACCD;">(create_todo: Json</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">CrateTodo</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> StatusCode </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">{:?}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">create_todo</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">StatusCode</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">CREATED</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h3 id="_3-3、路由" tabindex="-1">3.3、路由 <a class="header-anchor" href="#_3-3、路由" aria-label="Permalink to &quot;3.3、路由&quot;">​</a></h3><h4 id="_3-3-1、route" tabindex="-1">3.3.1、route <a class="header-anchor" href="#_3-3-1、route" aria-label="Permalink to &quot;3.3.1、route&quot;">​</a></h4><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">#[tokio::main]</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">...</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">app</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Router</span><span style="color:#F07178;">::</span><span style="color:#89DDFF;">new</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">route</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">async</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">Hello, index!</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">route</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/hello</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">hello_handler</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">...</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">hello_handler</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> Html</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">String</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">Html</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">&lt;h1&gt;Hello, World!&lt;/h1&gt;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">.into(</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h3 id="_3-4、中间件" tabindex="-1">3.4、中间件 <a class="header-anchor" href="#_3-4、中间件" aria-label="Permalink to &quot;3.4、中间件&quot;">​</a></h3><h4 id="_3-4-1、登录授权" tabindex="-1">3.4.1、登录授权 <a class="header-anchor" href="#_3-4-1、登录授权" aria-label="Permalink to &quot;3.4.1、登录授权&quot;">​</a></h4><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// secret key</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> SECRET_KEY</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">[</span><span style="color:#FFCB6B;">u8</span><span style="color:#A6ACCD;">] </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> b</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">deadbeer</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[</span><span style="color:#82AAFF;">derive</span><span style="color:#A6ACCD;">(Debug</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Serialize</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Deserialize)]</span></span>
<span class="line"><span style="color:#A6ACCD;">struct Claims </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">id</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">usize</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">String</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">exp</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">usize</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[async_trait]</span></span>
<span class="line"><span style="color:#A6ACCD;">impl</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">S</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> FromRequestParts</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">S</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> for Claims</span></span>
<span class="line"><span style="color:#A6ACCD;">where</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">S</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Send </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> Sync</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">type</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Rejection</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">HttpError</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">async</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fn</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">from_request_parts</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">parts</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Parts</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">state</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">S</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Result</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">Self</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Self</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">Rejection</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        let TypedHeader</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">Authorization</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;font-style:italic;">bearer</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;">) =</span></span>
<span class="line"><span style="color:#F07178;">            TypedHeader::</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Authorization</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Bearer</span><span style="color:#89DDFF;">&gt;&gt;</span><span style="color:#F07178;">::from_request_parts</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">parts</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">state</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#F07178;">                .await</span></span>
<span class="line"><span style="color:#F07178;">                .map_err</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">|</span><span style="color:#A6ACCD;font-style:italic;">_</span><span style="color:#F07178;">| </span><span style="color:#A6ACCD;font-style:italic;">HttpError</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">UnAuthorized</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;">?;</span></span>
<span class="line"><span style="color:#F07178;">        let </span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">jwt</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">DecodingKey</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">from_secret</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">SECRET_KEY</span><span style="color:#F07178;">);</span></span>
<span class="line"><span style="color:#F07178;">        let </span><span style="color:#A6ACCD;">token</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">jwt</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">decode</span><span style="color:#F07178;">::</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Claims</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">(bearer.token(), &amp;key, &amp;jwt::Validation::default())</span></span>
<span class="line"><span style="color:#A6ACCD;">            .map_err(|_| HttpError::UnAuthorized)?;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        Ok(token.claims)</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[derive(Debug)]</span></span>
<span class="line"><span style="color:#A6ACCD;">enum HttpError </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    UnAuthorized</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    InternalServerError</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">impl IntoResponse for HttpError </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    fn </span><span style="color:#82AAFF;">into_response</span><span style="color:#A6ACCD;">(self) </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> axum::response::Response </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">let</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">code</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">msg</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> = match self </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#FFCB6B;">HttpError</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;font-style:italic;">UnAuthorized</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">StatusCode</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">UNAUTHORIZED</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">unauthorized</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;">,</span></span>
<span class="line"><span style="color:#F07178;">            HttpError::InternalServerError </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">StatusCode</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">INTERNAL_SERVER_ERROR</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">internal server error</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#F07178;">            }</span></span>
<span class="line"><span style="color:#F07178;">        };</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">code</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">msg</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;">.into_response</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#F07178;">    }</span></span>
<span class="line"><span style="color:#F07178;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">app</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Router</span><span style="color:#F07178;">::</span><span style="color:#89DDFF;">new</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">route</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/login</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">post</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">login_handler</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">route</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/todos</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">todos_handler</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">post</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">create_todos_handler</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// post login json</span></span>
<span class="line"><span style="color:#A6ACCD;">async</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fn</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">login_handler</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">login</span><span style="color:#F07178;">: </span><span style="color:#A6ACCD;">Json</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">LoginRequest</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Json</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">LoginResponse</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    let </span><span style="color:#A6ACCD;">claims</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Claims</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        id</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">login</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">email</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">clone</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">;</span></span>
<span class="line"><span style="color:#F07178;">    let </span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">jwt</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">EncodingKey</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">from_secret</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">SECRET_KEY</span><span style="color:#F07178;">);</span></span>
<span class="line"><span style="color:#F07178;">    let token</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">String</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">jwt</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">encode</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">jwt</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">Header</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">default</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">claims</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">();</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">Json</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">LoginResponse</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">token</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// get /todos list</span></span>
<span class="line"><span style="color:#A6ACCD;">async</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fn</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">todos_handler</span><span style="color:#F07178;">() </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Json</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">Vec</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">Todo</span><span style="color:#89DDFF;">&gt;&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    Json</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">vec</span><span style="color:#F07178;">!</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;font-style:italic;">Todo</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        id</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        title</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Todo 1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">.</span><span style="color:#A6ACCD;font-style:italic;">into</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        completed</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}])</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// post /todos json</span></span>
<span class="line"><span style="color:#A6ACCD;">async</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fn</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">create_todos_handler</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">claims</span><span style="color:#F07178;">: </span><span style="color:#A6ACCD;">Claims</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">_create_todo</span><span style="color:#F07178;">: </span><span style="color:#A6ACCD;">Json</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">CrateTodo</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">StatusCode</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">claims{:?}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">claims</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">StatusCode</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">:</span><span style="color:#A6ACCD;">CREATED</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h3 id="_3-5、状态管理" tabindex="-1">3.5、状态管理 <a class="header-anchor" href="#_3-5、状态管理" aria-label="Permalink to &quot;3.5、状态管理&quot;">​</a></h3><h4 id="_3-5-1、状态管理" tabindex="-1">3.5.1、状态管理 <a class="header-anchor" href="#_3-5-1、状态管理" aria-label="Permalink to &quot;3.5.1、状态管理&quot;">​</a></h4><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">#[</span><span style="color:#82AAFF;">derive</span><span style="color:#A6ACCD;">(Debug</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Default</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Clone)]</span></span>
<span class="line"><span style="color:#A6ACCD;">struct TodoStore </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">items</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Arc</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">RwLock</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">Vec</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">Todo</span><span style="color:#89DDFF;">&gt;&gt;&gt;,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> store </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> TodoStore::</span><span style="color:#82AAFF;">default</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> app </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Router::</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">route</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/todos</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(todos_handler)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">post</span><span style="color:#A6ACCD;">(create_todos_handler)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">layer</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">Extension</span><span style="color:#A6ACCD;">(store))</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// get /todos list</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">todos_handler</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">    store: Extension</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">TodoStore</span><span style="color:#89DDFF;">&gt;,</span></span>
<span class="line"><span style="color:#A6ACCD;">    claims: Claims</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> Result</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">Json</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">Vec</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">Todo</span><span style="color:#89DDFF;">&gt;&gt;,</span><span style="color:#A6ACCD;"> HttpError</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    let user_id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> claims</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">id;</span></span>
<span class="line"><span style="color:#A6ACCD;">    match store.items.read() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">Ok</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">items</span><span style="color:#F07178;">) </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Ok</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">Json</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">items</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">iter</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">filter</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">todo</span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">todo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">user_id</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">user_id</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cloned</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">collect</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        ))</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">Err</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">_</span><span style="color:#F07178;">) </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Err</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">HttpError</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">InternalServerError</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// post /todos json</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">create_todos_handler</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">    store: Extension</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">TodoStore</span><span style="color:#89DDFF;">&gt;,</span></span>
<span class="line"><span style="color:#A6ACCD;">    claims: Claims</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    create_todo: Json</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">CrateTodo</span><span style="color:#89DDFF;">&gt;,</span></span>
<span class="line"><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> Result</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">StatusCode</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> HttpError</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    println!(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">claims: {:?}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> claims);</span></span>
<span class="line"><span style="color:#A6ACCD;">    match store.items.write() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">Ok</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">mut</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">guard</span><span style="color:#F07178;">) </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">todo</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Todo</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                id</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">get_next_id</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">                user_id</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">claims</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">                title</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">create_todo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">title</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">clone</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">                completed</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">guard</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">todo</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">Ok</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">StatusCode</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">CREATED</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">Err</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">_</span><span style="color:#F07178;">) </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Err</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">HttpError</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">InternalServerError</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h3 id="_3-6、响应数据" tabindex="-1">3.6、响应数据 <a class="header-anchor" href="#_3-6、响应数据" aria-label="Permalink to &quot;3.6、响应数据&quot;">​</a></h3><h4 id="_3-6-1、html" tabindex="-1">3.6.1、Html <a class="header-anchor" href="#_3-6-1、html" aria-label="Permalink to &quot;3.6.1、Html&quot;">​</a></h4><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">hello_handler</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> Html</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">String</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">Html</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">&lt;h1&gt;Hello, World!&lt;/h1&gt;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">.into(</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h4 id="_3-6-2、json" tabindex="-1">3.6.2、Json <a class="header-anchor" href="#_3-6-2、json" aria-label="Permalink to &quot;3.6.2、Json&quot;">​</a></h4><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">hello_handler</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> Json</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">Todo</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">Json</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">Todo</span><span style="color:#89DDFF;">{})</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h3 id="_3-7、请求参数" tabindex="-1">3.7、请求参数 <a class="header-anchor" href="#_3-7、请求参数" aria-label="Permalink to &quot;3.7、请求参数&quot;">​</a></h3><h4 id="_3-7-1、json" tabindex="-1">3.7.1、Json <a class="header-anchor" href="#_3-7-1、json" aria-label="Permalink to &quot;3.7.1、Json&quot;">​</a></h4><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">login_handler</span><span style="color:#A6ACCD;">(login: Json</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">LoginRequest</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> Json</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">LoginResponse</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h2 id="_4、示例" tabindex="-1">4、示例 <a class="header-anchor" href="#_4、示例" aria-label="Permalink to &quot;4、示例&quot;">​</a></h2><h3 id="_4-1、打包静态资源" tabindex="-1">4.1、打包静态资源 <a class="header-anchor" href="#_4-1、打包静态资源" aria-label="Permalink to &quot;4.1、打包静态资源&quot;">​</a></h3><p>[dependencies]</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">rust</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">embed </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">8.0.0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// 打包静态资源到二进制文件</span></span>
<span class="line"><span style="color:#A6ACCD;">mime_guess </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">2.0.4</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// 获取资源mime type</span></span></code></pre></div><p>main.rs</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">use </span><span style="color:#FFCB6B;">axum</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    async_trait</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">extract</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">FromRequestParts</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Query</span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">headers</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">authorization</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:Bearer</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Authorization</span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">http</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">request</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:Parts</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> StatusCode</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> header</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Uri</span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">response</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">IntoResponse</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Response</span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">routing</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">get</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> post</span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">    Extension</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Json</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Router</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Server</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> TypedHeader</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">Full</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> boxed</span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[</span><span style="color:#82AAFF;">derive</span><span style="color:#A6ACCD;">(RustEmbed)]</span></span>
<span class="line"><span style="color:#A6ACCD;">#[folder </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">example/public/</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">struct Assets</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">struct </span><span style="color:#82AAFF;">StaticFile</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">(T)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">impl </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">T</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> IntoResponse for StaticFile</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">T</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">where</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">T</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Into</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">String</span><span style="color:#89DDFF;">&gt;,</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">fn</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">into_response</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">self</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Response</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">path</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">0</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">into</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">match</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Assets</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">:</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">as_str</span><span style="color:#F07178;">()) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">Some</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">content</span><span style="color:#F07178;">) </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">body</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">boxed</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">Full</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">from</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">content</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mine</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mime_guess</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">from_path</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">as_str</span><span style="color:#F07178;">())</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">first_or_octet_stream</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#FFCB6B;">Response</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">:</span><span style="color:#82AAFF;">builder</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">header</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">header</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">CONTENT_TYPE</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mine</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">as_ref</span><span style="color:#F07178;">())</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">body</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">body</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;font-style:italic;">None</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#FFCB6B;">Response</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">:</span><span style="color:#82AAFF;">builder</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">status</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">StatusCode</span><span style="color:#F07178;">::</span><span style="color:#A6ACCD;">NOT_FOUND</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">body</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">boxed</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">Full</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">from</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">format</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">File {} not found</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">path</span><span style="color:#F07178;">))))</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">#[tokio::main]</span></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">addr</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">SocketAddr</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">from</span><span style="color:#F07178;">(([</span><span style="color:#F78C6C;">127</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">3000</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">store</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">TodoStore</span><span style="color:#F07178;">::</span><span style="color:#82AAFF;">default</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">app</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Router</span><span style="color:#F07178;">::</span><span style="color:#89DDFF;">new</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">route</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/hello</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">hello_handler</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">fallback</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">static_handler</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">listening on {}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">addr</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">Server</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">:</span><span style="color:#82AAFF;">bind</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">addr</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">serve</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">into_make_service</span><span style="color:#F07178;">())</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">await</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unwrap</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">hello_handler</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> impl IntoResponse </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">StaticFile</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">index.html</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">async fn </span><span style="color:#82AAFF;">static_handler</span><span style="color:#A6ACCD;">(url: Uri) </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> impl IntoResponse </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">path</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">url</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">path</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">trim_start_matches</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">to_string</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">StaticFile</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">path</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div>`,37),e=[o];function t(c,r,F,y,D,A){return n(),a("div",null,e)}const d=s(p,[["render",t]]);export{i as __pageData,d as default};
