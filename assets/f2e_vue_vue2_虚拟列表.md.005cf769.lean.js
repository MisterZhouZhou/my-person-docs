import{_ as y,o as c,c as r,k as F,L as i,M as C,r as A,W as h,a5 as u,O as d,w as f,t as D,a as m,X as g}from"./chunks/framework.28451963.js";const E={name:"VirtualList",props:{listData:{type:Array,default:()=>[]},estimatedItemSize:{type:Number,required:!0},bufferScale:{type:Number,default:1},height:{type:String,default:"100%"}},computed:{_listData(){return this.listData.map((n,s)=>({_index:`_${s}`,item:n}))},visibleCount(){return Math.ceil(this.screenHeight/this.estimatedItemSize)},aboveCount(){return Math.min(this.start,this.bufferScale*this.visibleCount)},belowCount(){return Math.min(this.listData.length-this.end,this.bufferScale*this.visibleCount)},visibleData(){let n=this.start-this.aboveCount,s=this.end+this.belowCount;return this._listData.slice(n,s)}},created(){this.initPositions()},mounted(){this.screenHeight=this.$el.clientHeight,this.start=0,this.end=this.start+this.visibleCount},updated(){this.$nextTick(function(){if(!this.$refs.items||!this.$refs.items.length)return;this.updateItemsSize();let n=this.positions[this.positions.length-1].bottom;this.$refs.phantom.style.height=n+"px",this.setStartOffset()})},data(){return{screenHeight:0,start:0,end:0}},methods:{initPositions(){this.positions=this.listData.map((n,s)=>({index:s,height:this.estimatedItemSize,top:s*this.estimatedItemSize,bottom:(s+1)*this.estimatedItemSize}))},getStartIndex(n=0){return this.binarySearch(this.positions,n)},binarySearch(n,s){let p=0,o=n.length-1,a=null;for(;p<=o;){let t=parseInt((p+o)/2),l=n[t].bottom;if(l===s)return t+1;l<s?p=t+1:l>s&&((a===null||a>t)&&(a=t),o=o-1)}return a},updateItemsSize(){this.$refs.items.forEach(s=>{let o=s.getBoundingClientRect().height,a=+s.id.slice(1),l=this.positions[a].height-o;if(l){this.positions[a].bottom=this.positions[a].bottom-l,this.positions[a].height=o;for(let e=a+1;e<this.positions.length;e++)this.positions[e].top=this.positions[e-1].bottom,this.positions[e].bottom=this.positions[e].bottom-l}})},setStartOffset(){let n;if(this.start>=1){let s=this.positions[this.start].top-(this.positions[this.start-this.aboveCount]?this.positions[this.start-this.aboveCount].top:0);n=this.positions[this.start-1].bottom-s}else n=0;this.$refs.content.style.transform=`translate3d(0,${n}px,0)`},scrollEvent(){let n=this.$refs.list.scrollTop;this.start=this.getStartIndex(n),this.end=this.start+this.visibleCount,this.setStartOffset()}}},v={ref:"phantom",class:"infinite-list-phantom"},b={ref:"content",class:"infinite-list"},_=["id"];function x(n,s,p,o,a,t){return c(),r("div",{ref:"list",style:h({height:p.height}),class:"infinite-list-container",onScroll:s[0]||(s[0]=l=>t.scrollEvent(l))},[F("div",v,null,512),F("div",b,[(c(!0),r(i,null,C(t.visibleData,l=>(c(),r("div",{class:"infinite-list-item",ref_for:!0,ref:"items",id:l._index,key:l._index},[A(n.$slots,"default",{ref_for:!0,ref:"slot",item:l.item},void 0,!0)],8,_))),128))],512)],36)}const q=y(E,[["render",x],["__scopeId","data-v-3792f447"]]),S=g("",12),I={style:{color:"red"}},V=JSON.parse('{"title":"虚拟列表","description":"","frontmatter":{},"headers":[],"relativePath":"f2e/vue/vue2/虚拟列表.md","filePath":"f2e/vue/vue2/虚拟列表.md","lastUpdated":1704191114000}'),k={name:"f2e/vue/vue2/虚拟列表.md"},$=Object.assign(k,{setup(n){const s=u([]);for(let p=0;p<1e3;p++)s.push({id:p,value:"长文本长文本长文本长文本长文本长文本长文本长文本长文本长文本长文本长文本长文本长文本长文本长文本长文本长文本长文本长文本长文本长文本"});return console.log(s),(p,o)=>(c(),r("div",null,[S,d(q,{listData:s,estimatedItemSize:100,height:"200px"},{default:f(a=>[F("p",null,[F("span",I,D(a.item.id),1),m(" "+D(a.item.value),1)])]),_:1},8,["listData"])]))}});export{V as __pageData,$ as default};
